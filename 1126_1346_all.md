---
C:\tealim-be\src\main\java\com\codehows\taelimbe\TaelimBeApplication.java
---
package com.codehows.taelimbe;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class TaelimBeApplication {

    public static void main(String[] args) {
        SpringApplication.run(TaelimBeApplication.class, args);
    }

}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\client\PuduAPIClient.java
---
package com.codehows.taelimbe.client;

import lombok.Getter;
import org.apache.http.client.methods.CloseableHttpResponse;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.impl.client.CloseableHttpClient;
import org.apache.http.impl.client.HttpClients;
import org.apache.http.util.EntityUtils;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Component;

import javax.crypto.Mac;
import javax.crypto.SecretKey;
import javax.crypto.spec.SecretKeySpec;
import java.net.URL;
import java.text.SimpleDateFormat;
import java.util.*;

@Component
public class PuduAPIClient {

    private static final String MAC_NAME = "HmacSHA1";
    private static final String ENCODING = "UTF-8";


    @Value("${api.app.key}")
    private String apiAppKey;

    @Value("${api.app.secret}")
    private String apiAppSecret;

    @Value("${api.host}")
    private String host;

    @Getter
    @Value("${api.base.url}")
    private String baseUrl;

    public ResponseEntity<String> callPuduAPI(String url, String httpMethod) throws Exception {
        String acceptHeader = "application/json";
        String contentType = "";
        String contentMD5 = "";

        // URL parsing
        URL parsedUrl = new URL(url);
        String pathAndParams = parsedUrl.getPath();
        if (parsedUrl.getQuery() != null) {
            pathAndParams += "?" + sortQueryParams(parsedUrl.getQuery());
        }

        String xDate = getGMTTime();
        System.out.println("x-date: " + xDate);

        // ?쒕쾭媛 湲곕??섎뒗 HMAC 臾몄옄??洹몃?濡??ъ슜
        String stringToSign = String.format("x-date: %s\n%s\n%s\n%s\n%s\n%s",
                xDate, httpMethod, acceptHeader, contentType, contentMD5, pathAndParams);

        System.out.println("stringToSign:");
        System.out.println(stringToSign);

        // HMAC ?앹꽦
        byte[] hmacStr = HmacSHA1Encrypt(stringToSign, apiAppSecret);
        String signature = Base64.getEncoder().encodeToString(hmacStr);
        System.out.println("Signature: " + signature);

        // Authorization header ?앹꽦 (怨듬갚 ?쒓굅)
        String authHeader = String.format(
                "hmac id=\"%s\", algorithm=\"hmac-sha1\", headers=\"x-date\", signature=\"%s\"",
                apiAppKey.trim(), signature.trim()
        );
        System.out.println("Authorization: " + authHeader);

        // HTTP ?붿껌
        CloseableHttpClient httpClient = HttpClients.createDefault();
        HttpGet httpGet = new HttpGet(url);
        httpGet.setHeader("Accept", acceptHeader);
        httpGet.setHeader("Host", host);
        httpGet.setHeader("x-date", xDate);
        httpGet.setHeader("Authorization", authHeader);

        CloseableHttpResponse response = httpClient.execute(httpGet);
        int statusCode = response.getStatusLine().getStatusCode();
        String responseBody = EntityUtils.toString(response.getEntity());

        System.out.println("Response Status: " + statusCode);
        System.out.println("Response Body: " + responseBody);
        System.out.println("====== ?꾨즺 ======\n");

        httpClient.close();

        return ResponseEntity.status(statusCode)
                .contentType(MediaType.APPLICATION_JSON)
                .body(responseBody);
    }

    public String getGMTTime() {
        Calendar cd = Calendar.getInstance();
        SimpleDateFormat sdf = new SimpleDateFormat("EEE, dd MMM yyyy HH:mm:ss 'GMT'", Locale.US);
        sdf.setTimeZone(TimeZone.getTimeZone("GMT"));
        return sdf.format(cd.getTime());
    }

    public String sortQueryParams(String queryParam) {
        if (queryParam == null || queryParam.isEmpty()) return "";

        String[] queryParams = queryParam.split("&");
        Map<String, String> queryPairs = new TreeMap<>();
        for (String query : queryParams) {
            String[] kv = query.split("=", 2);
            String key = kv[0];
            String value = kv.length > 1 ? kv[1] : "";
            queryPairs.put(key, value);
        }

        StringBuilder sb = new StringBuilder();
        for (Map.Entry<String, String> entry : queryPairs.entrySet()) {
            if (sb.length() > 0) sb.append("&");
            sb.append(entry.getKey()).append("=").append(entry.getValue());
        }

        return sb.toString();
    }

    public byte[] HmacSHA1Encrypt(String text, String key) throws Exception {
        SecretKey secretKey = new SecretKeySpec(key.getBytes(ENCODING), MAC_NAME);
        Mac mac = Mac.getInstance(MAC_NAME);
        mac.init(secretKey);
        return mac.doFinal(text.getBytes(ENCODING));
    }
}
---
C:\tealim-be\src\main\java\com\codehows\taelimbe\config\AsyncConfig.java
---
package com.codehows.taelimbe.config;

import org.jetbrains.annotations.NotNull;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.task.TaskDecorator;
import org.springframework.core.task.TaskExecutor;
import org.springframework.scheduling.annotation.EnableAsync;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;

import java.util.concurrent.ThreadPoolExecutor;

/**
 * ?좏뵆由ъ??댁뀡??鍮꾨룞湲??묒뾽???꾪븳 以묒븰 ?ㅻ젅??????ㅼ젙?섎뒗 ?대옒?ㅼ엯?덈떎.
 * `@Configuration` ?대끂?뚯씠?섏? ???대옒?ㅺ? Spring???ㅼ젙 ?대옒?ㅼ엫???섑??대ŉ,
 * Spring 而⑦뀒?대꼫媛 ???대옒?ㅼ뿉???뺤쓽??`@Bean` 硫붿꽌?쒕? ?듯빐 鍮덉쓣 ?앹꽦?섎룄濡?吏?쒗빀?덈떎.
 */
@Configuration
@EnableAsync
public class AsyncConfig {

    /**
     * 鍮꾨룞湲??묒뾽??泥섎━?섍린 ?꾪븳 `TaskExecutor` Bean???앹꽦?⑸땲??
     * ??`TaskExecutor`??`@Async` ?대끂?뚯씠?섏씠 遺숈? 硫붿꽌?쒕? ?ㅽ뻾?섎뒗 ???ъ슜?????덉뒿?덈떎.
     * `TaskDecorator`瑜??ъ슜?섏뿬 `UserContextHolder`??而⑦뀓?ㅽ듃瑜?鍮꾨룞湲??ㅻ젅?쒕줈 ?꾪뙆?⑸땲??
     *
     * @return ?ㅼ젙???꾨즺??`ThreadPoolTaskExecutor` ?몄뒪?댁뒪
     */
    @Bean("taskExecutor")
    public TaskExecutor taskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        // 肄붿뼱 ?ㅻ젅??????ш린瑜??ㅼ젙?⑸땲?? ???섎쭔?쇱쓽 ?ㅻ젅?쒓? ??긽 ?좎??⑸땲??
        executor.setCorePoolSize(10);
        // 理쒕? ?ㅻ젅??????ш린瑜??ㅼ젙?⑸땲?? 肄붿뼱 ???媛??李④퀬 ?먮룄 媛??李쇱쓣 ???앹꽦?????덈뒗 理쒕? ?ㅻ젅???섏엯?덈떎.
        executor.setMaxPoolSize(20);
        // ?묒뾽 ?먯쓽 ?⑸웾???ㅼ젙?⑸땲?? 肄붿뼱 ????ㅻ젅?쒓? 紐⑤몢 ?ъ슜 以묒씪 ???묒뾽???湲고븯??怨듦컙?낅땲??
        executor.setQueueCapacity(50);
        // 嫄곕? ?뺤콉???ㅼ젙?⑸땲?? ?먭퉴吏 媛??李쇱쓣 ???덈줈???묒뾽???ㅼ뼱?ㅻ㈃ ?몄텧???ㅻ젅?쒓? 吏곸젒 ?묒뾽???ㅽ뻾?⑸땲??
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
        // ?앹꽦?섎뒗 ?ㅻ젅?쒖쓽 ?대쫫 ?묐몢?щ? ?ㅼ젙?섏뿬 濡쒓렇?먯꽌 ?ㅻ젅?쒕? ?쎄쾶 ?앸퀎?????덈룄濡??⑸땲??
        executor.setThreadNamePrefix("async-task-");
        // Executor瑜?珥덇린?뷀빀?덈떎.
        executor.initialize();

        // TaskDecorator瑜??ㅼ젙?섏뿬 遺紐??ㅻ젅?쒖쓽 UserContextHolder 而⑦뀓?ㅽ듃瑜??먯떇 ?ㅻ젅?쒕줈 ?꾪뙆?⑸땲??
        executor.setTaskDecorator(new TaskDecorator() {
            @NotNull
            @Override
            public Runnable decorate(@NotNull Runnable runnable) {
                // 遺紐??ㅻ젅?쒖쓽 ?ъ슜???대쫫??罹≪쿂?⑸땲??
                String userName = UserContextHolder.getUserName();
                return () -> {
                    try {
                        // ?먯떇 ?ㅻ젅?쒖뿉???ъ슜???대쫫???ㅼ젙?⑸땲??
                        UserContextHolder.setUserName(userName);
                        runnable.run();
                    } finally {
                        // ?묒뾽 ?꾨즺 ???ъ슜???대쫫???대━?댄빀?덈떎.
                        UserContextHolder.clear();
                    }
                };
            }
        });

        //TODO Spring Security ?ㅽ럺 異붽? ???꾨옒 諛⑹떇?쇰줈 Security Context ?꾪뙆
        // return new DelegatingSecurityContextExecutor(executor);
        return executor;
    }
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\config\SecurityConfig.java
---
//package com.codehows.taelimbe.config;
//import org.springframework.context.annotation.Bean;
//import org.springframework.context.annotation.Configuration;
//import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
//import org.springframework.security.crypto.password.PasswordEncoder;
//
//@Configuration
//public class SecurityConfig {
//
//    @Bean
//    public PasswordEncoder passwordEncoder() {
//        return new BCryptPasswordEncoder();
//    }
//}
---
C:\tealim-be\src\main\java\com\codehows\taelimbe\config\UserContextHolder.java
---
package com.codehows.taelimbe.config;

/**
 * ?꾩옱 ?ㅻ젅?쒖쓽 ?ъ슜??而⑦뀓?ㅽ듃(?? ?ъ슜???대쫫)瑜???ν븯怨?寃?됲븯湲??꾪븳 ?좏떥由ы떚 ?대옒?ㅼ엯?덈떎.
 * `ThreadLocal`???ъ슜?섏뿬 媛??ㅻ젅?쒕쭏???낅┰?곸씤 ?ъ슜???뺣낫瑜??좎??????덈룄濡??⑸땲??
 * ?대뒗 ???붿껌怨?媛숈씠 ?щ윭 ?ㅻ젅?쒓? ?숈떆???묒뾽??泥섎━????媛??붿껌???ъ슜???뺣낫瑜?遺꾨━?섏뿬 愿由ы븯?????좎슜?⑸땲??
 */
// TODO Spring Security ?ㅽ럺 異붽? ???대떦 ?대옒????젣
public class UserContextHolder {
    // ThreadLocal 蹂?섎? ?좎뼵?섏뿬 媛??ㅻ젅?쒖뿉 String ??낆쓽 ?ъ슜???대쫫????ν븷 ???덈룄濡??⑸땲??
    private static final ThreadLocal<String> currentUser = new ThreadLocal<>();

    /**
     * ?꾩옱 ?ㅻ젅?쒖쓽 ?ъ슜???대쫫???ㅼ젙?⑸땲??
     *
     * @param userName ?ㅼ젙???ъ슜???대쫫 臾몄옄??
     */
    public static void setUserName(String userName) {
        currentUser.set(userName);
    }

    /**
     * ?꾩옱 ?ㅻ젅?쒖뿉 ??λ맂 ?ъ슜???대쫫??媛?몄샃?덈떎.
     *
     * @return ?꾩옱 ?ㅻ젅?쒖쓽 ?ъ슜???대쫫 臾몄옄?? ?ㅼ젙?섏? ?딆븯?ㅻ㈃ null??諛섑솚?⑸땲??
     */
    public static String getUserName() {
        return currentUser.get();
    }

    /**
     * ?꾩옱 ?ㅻ젅?쒖뿉 ??λ맂 ?ъ슜???대쫫???쒓굅?⑸땲??
     * ?대뒗 ?ㅻ젅?쒓? ?ъ궗?⑸맆 ???댁쟾 ?붿껌???ъ슜???뺣낫媛 ?⑥븘?덉? ?딅룄濡??섏뿬
     * ?곗씠???꾩텧?대굹 ?섎せ???뺣낫 ?ъ슜??諛⑹??섎뒗 ??以묒슂?⑸땲??
     */
    public static void clear() {
        currentUser.remove();
    }
}
---
C:\tealim-be\src\main\java\com\codehows\taelimbe\constant\Role.java
---
package com.codehows.taelimbe.constant;

public enum Role { ADMIN, MANAGER, EMPLOYEE
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\controller\AgentController.java
---
package com.codehows.taelimbe.controller;

import com.codehows.taelimbe.dto.ChatPromptRequest;
import com.codehows.taelimbe.dto.EmbeddingRequest;
import com.codehows.taelimbe.service.AgentService;
import com.codehows.taelimbe.service.EmbeddingService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.servlet.mvc.method.annotation.SseEmitter;

import java.util.concurrent.CompletableFuture;

/**
 * AI ?먯씠?꾪듃??????諛??꾨쿋??愿由щ? 泥섎━?섎뒗 API 而⑦듃濡ㅻ윭?낅땲??
 * `@RestController`?????대옒?ㅺ? RESTful ???쒕퉬?ㅼ쓽 而⑦듃濡ㅻ윭?꾩쓣 ?섑??대ŉ,
 * 紐⑤뱺 硫붿꽌?쒖쓽 諛섑솚 媛믪씠 HTTP ?묐떟 蹂몃Ц?쇰줈 吏곸젒 吏곷젹?붾맖???섎??⑸땲??
 * `@RequestMapping("/api")`????而⑦듃濡ㅻ윭??紐⑤뱺 ?몃뱾??硫붿꽌?쒓? "/api" 寃쎈줈 ?꾨옒??留ㅽ븨?⑥쓣 吏?뺥빀?덈떎.
 * `@RequiredArgsConstructor`??Lombok ?대끂?뚯씠?섏쑝濡? final ?꾨뱶??????앹꽦?먮? ?먮룞?쇰줈 ?앹꽦?섏뿬 ?섏〈??二쇱엯???⑹씠?섍쾶 ?⑸땲??
 * `@Slf4j`??Lombok ?대끂?뚯씠?섏쑝濡? 濡쒓퉭???꾪븳 `log` 媛앹껜瑜??먮룞?쇰줈 ?앹꽦?⑸땲??
 */
@RestController
@RequestMapping("/api")
@RequiredArgsConstructor
@Slf4j
public class AgentController {

    // ConversationService瑜?二쇱엯諛쏆븘 梨꾪똿 愿??鍮꾩쫰?덉뒪 濡쒖쭅???꾩엫?⑸땲??
    private final AgentService agentService;
    // ?꾨쿋??愿??鍮꾩쫰?덉뒪 濡쒖쭅??泥섎━?섎뒗 ?쒕퉬?ㅻ? 二쇱엯諛쏆뒿?덈떎.
    private final EmbeddingService embeddingService;

    /**
     * ?ъ슜?먯쓽 硫붿떆吏瑜?諛쏆븘 AI? ??뷀븯怨? ?묐떟???ㅽ듃由щ컢?쇰줈 諛섑솚?⑸땲??
     * `/agent/chat`? ?쇰컲?곸씤 ??붾?, `/agent/report`??蹂닿퀬???앹꽦???꾪븳 ?뱀젙 ?꾨＼?꾪듃 泥섎━瑜??대떦?⑸땲??
     * ??硫붿꽌?쒕뒗 ?ㅼ젣 梨꾪똿 濡쒖쭅??`conversationService`濡??꾩엫?⑸땲??
     *
     * @param chatPromptRequest ?ъ슜??硫붿떆吏? ???ID瑜??ы븿?섎뒗 ?붿껌 DTO
     * @return Server-Sent Events (SSE)瑜??듯빐 AI???묐떟???ㅽ듃由щ컢?섎뒗 SseEmitter
     */
    @PostMapping(value = "/agent/chat", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
    public SseEmitter chat(
            @RequestBody ChatPromptRequest chatPromptRequest
    ) {
        //TODO 異뷀썑 ?몄쬆 ?꾪꽣 泥섎━ ??Spring Security Context ?먯꽌 爰쇰궡 ?⑥빞 ??
        String username = "testUser";
        // 梨꾪똿 ?붿껌 泥섎━瑜?ConversationService濡??꾩엫?⑸땲??
        return agentService.chat(chatPromptRequest, username);
    }

    @PostMapping(value = "/agent/report", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
    public SseEmitter report(
            @RequestBody ChatPromptRequest chatPromptRequest
    ) {
        //TODO 異뷀썑 ?몄쬆 ?꾪꽣 泥섎━ ??Spring Security Context ?먯꽌 爰쇰궡 ?⑥빞 ??
        String username = "testUser";
        // 梨꾪똿 ?붿껌 泥섎━瑜?ConversationService濡??꾩엫?⑸땲??
        return agentService.report(chatPromptRequest, username);
    }

    /**
     * 二쇱뼱吏??띿뒪?몃? 鍮꾨룞湲곗쟻?쇰줈 ?꾨쿋?⑺븯??踰≫꽣 ??μ냼????ν빀?덈떎.
     * ??硫붿꽌?쒕뒗 ?붿껌??利됱떆 ?섎씫?섍퀬 諛깃렇?쇱슫?쒖뿉???묒뾽??泥섎━?⑸땲??
     *
     * @param request ?꾨쿋?⑺븷 ?띿뒪?몃? ?ы븿?섎뒗 ?붿껌 DTO
     * @return ?묒뾽??鍮꾨룞湲??ㅽ뻾 寃곌낵瑜??댁? CompletableFuture<ResponseEntity>
     */
    @PostMapping("/embeddings")
    public CompletableFuture<ResponseEntity<String>> embed(@RequestBody EmbeddingRequest request) { // @Valid 異붽?
        return embeddingService.embedAndStore(request.getText())
                // ?꾨쿋??諛?????묒뾽???깃났?곸쑝濡??쒖옉?섎㈃ 200 OK ?묐떟??諛섑솚?⑸땲??
                .thenApply(v -> ResponseEntity.ok("Text embedding and storing process started successfully."))
                // ?묒뾽 以??덉쇅 諛쒖깮 ??500 Internal Server Error ?묐떟??諛섑솚?⑸땲??
                .exceptionally(ex -> {
                    log.error("embedAndStore ?묒뾽 ?ㅽ뻾 ?ㅽ뙣", ex);
                    Throwable cause = ex.getCause();
                    String errorMessage = (cause != null) ? cause.getMessage() : ex.getMessage();
                    return ResponseEntity.internalServerError().body("Failed to start embedding process: " + errorMessage);
                });
    }

    /**
     * 湲곗〈 ?꾨쿋?⑹쓣 紐⑤몢 ??젣?섍퀬, 二쇱뼱吏??띿뒪?몃줈 踰≫꽣 ??μ냼瑜?鍮꾨룞湲곗쟻?쇰줈 ?ъ꽕?뺥빀?덈떎.
     * ??硫붿꽌?쒕뒗 ?붿껌??利됱떆 ?섎씫?섍퀬 諛깃렇?쇱슫?쒖뿉???묒뾽??泥섎━?⑸땲??
     *
     * @param request ?ъ꽕?뺤뿉 ?ъ슜???덈줈???띿뒪?몃? ?ы븿?섎뒗 ?붿껌 DTO
     * @return ?묒뾽??鍮꾨룞湲??ㅽ뻾 寃곌낵瑜??댁? CompletableFuture<ResponseEntity>
     */
    @PostMapping("/embeddings/reset")
    public CompletableFuture<ResponseEntity<String>> resetAndEmbed(@RequestBody EmbeddingRequest request) { // @Valid 異붽?
        return embeddingService.resetAndEmbed(request.getText())
                // ??μ냼 ?ъ꽕??諛??꾨쿋???묒뾽???깃났?곸쑝濡??쒖옉?섎㈃ 200 OK ?묐떟??諛섑솚?⑸땲??
                .thenApply(v -> ResponseEntity.ok("Embedding store reset and new text embedding process started successfully."))
                // ?묒뾽 以??덉쇅 諛쒖깮 ??500 Internal Server Error ?묐떟??諛섑솚?⑸땲??
                .exceptionally(ex -> {
                    log.error("resetAndEmbed ?묒뾽 ?ㅽ뻾 ?ㅽ뙣", ex);
                    Throwable cause = ex.getCause();
                    String errorMessage = (cause != null) ? cause.getMessage() : ex.getMessage();
                    return ResponseEntity.internalServerError().body("Failed to start reset and embedding process: " + errorMessage);
                });
    }
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\controller\GeneralShopController.java
---
package com.codehows.taelimbe.controller;

import com.codehows.taelimbe.service.GeneralShopService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/shop")
public class GeneralShopController {

    private final GeneralShopService generalShopService;

    @GetMapping("/list")
    public ResponseEntity<String> getShopList(
            @RequestParam(defaultValue = "20") int limit,
            @RequestParam(defaultValue = "0") int offset) {
        return generalShopService.getShopList(limit, offset);
    }

    @GetMapping("/robot/list")
    public ResponseEntity<String> getRobotList(
            @RequestParam(defaultValue = "20") int limit,
            @RequestParam(defaultValue = "0") int offset,
            @RequestParam(required = false) Long shop_id,
            @RequestParam(required = false) String[] product_code) {
        return generalShopService.getRobotList(limit, offset, shop_id, product_code);
    }
}
---
C:\tealim-be\src\main\java\com\codehows\taelimbe\controller\ReportController.java
---
package com.codehows.taelimbe.controller;

import com.codehows.taelimbe.service.ReportService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;


// ?놁뼱吏?
@RestController
@RequestMapping("/api/robot")
public class ReportController {

    @Autowired
    private ReportService reportService;

    @GetMapping("/test")
    public ResponseEntity<String> test() {
        return ResponseEntity.ok("Server running. Cleaning Report API Ready.");
    }

    @GetMapping("/report/list")
    public ResponseEntity<String> getCleanReportList(
            @RequestParam long start_time,
            @RequestParam long end_time,
            @RequestParam(defaultValue = "0") int offset,
            @RequestParam(defaultValue = "20") int limit,
            @RequestParam(defaultValue = "0") int timezone_offset,
            @RequestParam Long shop_id) {
        return reportService.getCleanReportList(start_time, end_time, offset, limit, timezone_offset, shop_id);
    }

    @GetMapping("/report/detail")
    public ResponseEntity<String> getCleanReportDetail(
            @RequestParam String sn,
            @RequestParam String report_id,
            @RequestParam long start_time,
            @RequestParam long end_time,
            @RequestParam(defaultValue = "0") int timezone_offset,
            @RequestParam(required = false) Long shop_id) {
        return reportService.getCleanReportDetail(sn, report_id, start_time, end_time, timezone_offset, shop_id);
    }
}
---
C:\tealim-be\src\main\java\com\codehows\taelimbe\controller\RobotRobotController.java
---
package com.codehows.taelimbe.controller;

import com.codehows.taelimbe.service.RobotRobotService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping("/api/robot")
public class RobotRobotController {

    @Autowired
    private RobotRobotService robotRobotService;

    @GetMapping("/detail")
    public ResponseEntity<String> getRobotDetail(@RequestParam String sn) {
        return robotRobotService.getRobotDetail(sn);
    }

    @GetMapping("/full-info")
    public ResponseEntity<?> getRobotFullInfo(
            @RequestParam String sn,
            @RequestParam long shop_id,
            @RequestParam(required = false) Long start_time,
            @RequestParam(required = false) Long end_time,
            @RequestParam(defaultValue = "0") int timezone_offset,
            @RequestParam(defaultValue = "20") int limit) {

        // Service??6媛??뚮씪誘명꽣 紐⑤몢 ?꾨떖
        // null 媛믪? Service?먯꽌 泥섎━ (湲곕낯媛??ㅼ젙)
        return robotRobotService.getRobotFullInfo(sn, shop_id, start_time, end_time, timezone_offset, limit);
    }
}
---
C:\tealim-be\src\main\java\com\codehows\taelimbe\controller\StatisticalLogController.java
---
package com.codehows.taelimbe.controller;

import com.codehows.taelimbe.service.StatisticalLogService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping("/api/robot")
public class StatisticalLogController {

    @Autowired
    private StatisticalLogService statisticalLogService;

    @GetMapping("/charging/list")
    public ResponseEntity<String> getChargingRecordList(
            @RequestParam long start_time,
            @RequestParam long end_time,
            @RequestParam(defaultValue = "0") int offset,
            @RequestParam(defaultValue = "20") int limit,
            @RequestParam(defaultValue = "0") int timezone_offset,
            @RequestParam(required = false) Long shop_id) {
        return statisticalLogService.getChargingRecordList(start_time, end_time, offset, limit, timezone_offset, shop_id);
    }

    // =============================
    // ?뵅 Battery Health Status
    // =============================
    @GetMapping("/battery/list")
    public ResponseEntity<String> getBatteryHealthList(
            @RequestParam long start_time,
            @RequestParam long end_time,
            @RequestParam(defaultValue = "0") int offset,
            @RequestParam(defaultValue = "20") int limit,
            @RequestParam(defaultValue = "0") int timezone_offset,
            @RequestParam(required = false) Long shop_id,
            @RequestParam(required = false) String sn,
            @RequestParam(required = false) Integer min_cycle,
            @RequestParam(required = false) Integer max_cycle,
            @RequestParam(required = false) Integer min_full_capacity,
            @RequestParam(required = false) Integer max_full_capacity
    ) {
        return statisticalLogService.getBatteryHealthList(
                start_time, end_time, offset, limit, timezone_offset,
                shop_id, sn,
                min_cycle, max_cycle,
                min_full_capacity, max_full_capacity
        );
    }
}
---
C:\tealim-be\src\main\java\com\codehows\taelimbe\dto\ChatPromptRequest.java
---
package com.codehows.taelimbe.dto;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

/**
 * 梨꾪똿 ?꾨＼?꾪듃 ?붿껌???꾪븳 ?곗씠???꾩넚 媛앹껜(DTO)?낅땲??
 * ?대씪?댁뼵?몃줈遺??AI ?먯씠?꾪듃?먭쾶 ?꾨떖??硫붿떆吏? ???ID瑜?罹≪뒓?뷀빀?덈떎.
 *
 * `@Data`??Lombok ?대끂?뚯씠?섏쑝濡? `@Getter`, `@Setter`, `@EqualsAndHashCode`, `@ToString`???먮룞?쇰줈 ?앹꽦?⑸땲??
 * `@NoArgsConstructor`???몄옄 ?녿뒗 湲곕낯 ?앹꽦?먮? ?먮룞?쇰줈 ?앹꽦?⑸땲??
 * `@AllArgsConstructor`??紐⑤뱺 ?꾨뱶瑜??몄옄濡?諛쏅뒗 ?앹꽦?먮? ?먮룞?쇰줈 ?앹꽦?⑸땲??
 */
@Data
@NoArgsConstructor
@AllArgsConstructor
public class ChatPromptRequest {
    /**
     * ?ъ슜?먮줈遺??AI ?먯씠?꾪듃?먭쾶 ?꾨떖??硫붿떆吏?낅땲??
     */
    private String message;
    /**
     * ?꾩옱 ??붿쓽 怨좎쑀 ID?낅땲??
     * ??ID瑜??듯빐 AI ?먯씠?꾪듃媛 ?댁쟾 ??붿쓽 而⑦뀓?ㅽ듃瑜??좎??????덉뒿?덈떎.
     */
    private String conversationId;
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\dto\CleaningDataDTO.java
---
package com.codehows.taelimbe.dto;

import com.codehows.taelimbe.entity.CleaningData;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;

/**
 * 泥?냼 ?곗씠???꾩넚 媛앹껜(DTO)?낅땲??
 * ?대씪?댁뼵?몄? ?쒕퉬??怨꾩링 媛꾩뿉 泥?냼 ?곗씠?곕? 二쇨퀬諛쏆쓣 ???ъ슜?⑸땲??
 * ?뷀떚?곗? 遺꾨━?섏뿬 API 怨꾩빟??紐낇솗???섍퀬, 遺덊븘?뷀븳 ?곗씠???몄텧??諛⑹??⑸땲??
 *
 * `@Data`??Lombok ?대끂?뚯씠?섏쑝濡? `@Getter`, `@Setter`, `@EqualsAndHashCode`, `@ToString`???먮룞?쇰줈 ?앹꽦?⑸땲??
 * `@NoArgsConstructor`???몄옄 ?녿뒗 湲곕낯 ?앹꽦?먮? ?먮룞?쇰줈 ?앹꽦?⑸땲??
 * `@AllArgsConstructor`??紐⑤뱺 ?꾨뱶瑜??몄옄濡?諛쏅뒗 ?앹꽦?먮? ?먮룞?쇰줈 ?앹꽦?⑸땲??
 */
@Data
@NoArgsConstructor
@AllArgsConstructor
public class CleaningDataDTO {

    private Long cleaningId;

    private LocalDateTime startTime;

    private LocalDateTime endTime;

    private String location;

    private Long duration;

    private Double areaCleaned;

    private Double waterUsage;

    private Double powerUsage;

    public static CleaningDataDTO create(CleaningData cleaningData) {
        CleaningDataDTO dto = new CleaningDataDTO();
        dto.setCleaningId(cleaningData.getCleaningId());
        dto.setStartTime(cleaningData.getStartTime());
        dto.setEndTime(cleaningData.getEndTime());
        dto.setLocation(cleaningData.getLocation());
        dto.setDuration(cleaningData.getDuration());
        dto.setAreaCleaned(cleaningData.getAreaCleaned());
        dto.setWaterUsage(cleaningData.getWaterUsage());
        dto.setPowerUsage(cleaningData.getPowerUsage());
        return dto;
    }
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\dto\EmbeddingRequest.java
---
package com.codehows.taelimbe.dto;

import lombok.Data;

/**
 * ?꾨쿋???앹꽦???꾪븳 ?붿껌 ?곗씠???꾩넚 媛앹껜(DTO)?낅땲??
 * ?꾨쿋?⑹쓣 ?앹꽦???띿뒪???곗씠?곕? 罹≪뒓?뷀빀?덈떎.
 *
 * `@Data`??Lombok ?대끂?뚯씠?섏쑝濡? `@Getter`, `@Setter`, `@EqualsAndHashCode`, `@ToString`???먮룞?쇰줈 ?앹꽦?⑸땲??
 */
@Data
public class EmbeddingRequest {
    /**
     * ?꾨쿋?⑹쓣 ?앹꽦???먮낯 ?띿뒪?몄엯?덈떎.
     */
    private String text;
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\dto\LoginDTO.java
---
//package com.codehows.taelimbe.dto;
//
//import jakarta.validation.constraints.NotBlank;
//import lombok.Data;
//
//@Data
//public class LoginDTO
//{
//    @NotBlank(message = "?꾩씠?붾? ?낅젰?섏꽭??")
//    private  String id;
//
//    @NotBlank(message = "鍮꾨?踰덊샇瑜??낅젰?섏꽭??")
//    private String pw ;
//}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\dto\LoginResponseDTO.java
---
package com.codehows.taelimbe.dto;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;

@Getter
@Builder
@AllArgsConstructor
public class LoginResponseDTO
{
    private String jwtToken;

    private boolean isAdmin;
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\dto\RobotFullInfoDTO.java
---
package com.codehows.taelimbe.dto;

public class RobotFullInfoDTO {
    private String sn;
    private String mac;
    private String nickname;
    private int online;
    private int battery;
    private int robotStatus;
    private String modelName;
    private String softwareVersion;

    // Getters and Setters
    public String getSn() { return sn; }
    public void setSn(String sn) { this.sn = sn; }

    public String getMac() { return mac; }
    public void setMac(String mac) { this.mac = mac; }

    public String getNickname() { return nickname; }
    public void setNickname(String nickname) { this.nickname = nickname; }

    public int getOnline() { return online; }
    public void setOnline(int online) { this.online = online; }

    public int getBattery() { return battery; }
    public void setBattery(int battery) { this.battery = battery; }

    public int getRobotStatus() { return robotStatus; }
    public void setRobotStatus(int robotStatus) { this.robotStatus = robotStatus; }

    public String getModelName() { return modelName; }
    public void setModelName(String modelName) { this.modelName = modelName; }

    public String getSoftwareVersion() { return softwareVersion; }
    public void setSoftwareVersion(String softwareVersion) { this.softwareVersion = softwareVersion; }
}
---
C:\tealim-be\src\main\java\com\codehows\taelimbe\dto\UserDTO.java
---
//package com.codehows.taelimbe.dto;
//
//import com.codehows.taelimbe.constant.Role;
//import com.codehows.taelimbe.entity.User;
//import jakarta.validation.constraints.Email;
//import jakarta.validation.constraints.NotBlank;
//import jakarta.validation.constraints.NotEmpty;
//import jakarta.validation.constraints.NotNull;
//import lombok.Getter;
//import lombok.Setter;
//import org.hibernate.validator.constraints.Length;
//
//import java.util.Base64;
//
//@Getter
//@Setter
//public class UserDTO {
//
//    private Long userId;
//    @NotBlank(message = "ID???꾩닔 ?낅젰 媛믪엯?덈떎.")
//    private String id;
//
//    @NotEmpty(message = "鍮꾨?踰덊샇???꾩닔 ?낅젰 媛믪엯?덈떎.")
//    @Length(min=8, max=16, message = "鍮꾨?踰덊샇??8???댁긽,  16???댄븯濡??낅젰?댁＜?몄슂.")
//    private String pw;
//
//    @NotBlank(message = "?대쫫? ?꾩닔 ?낅젰 媛믪엯?덈떎.")
//    private String name;
//
//    @NotEmpty(message = "?대찓?쇱? ?꾩닔 ?낅젰 媛믪엯?덈떎.")
//    @Email(message = "?대찓???뺤떇?쇰줈 ?낅젰?댁＜?몄슂.")
//    private String email;
//
//    @NotNull(message = "沅뚰븳? ?꾩닔 ?좏깮 媛믪엯?덈떎.")
//    private Role role;
//
//    @NotNull(message = "?낆껜 ?좏깮? ?꾩닔 ?좏깮 媛믪엯?덈떎.")
//    private Long storeId;
//
//    public static UserDTO from(User user) {
//        UserDTO dto = new UserDTO();
//        dto.setUserId(user.getUserId());
//        dto.setId(user.getId());
//        dto.setName(user.getName());
//        dto.setEmail(user.getEmail());
//        dto.setRole(user.getRole());
//        dto.setStoreId(user.getStore().getStoreId());
//
//        // 鍮꾨?踰덊샇??蹂듯샇??????蹂댁븞???됰Ц 諛섑솚 湲덉?)
//        dto.setPw(user.getPw());
//
//        return dto;
//    }
//
//    private static String decode(String encoded) {
//        if (encoded == null) return null;
//        return new String(Base64.getDecoder().decode(encoded));
//    }
//
//}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\entity\AiChat.java
---
//package com.codehows.taelimbe.entity;
//
//import jakarta.persistence.*;
//import lombok.*;
//
//import java.time.LocalDateTime;
//
//@Entity
//@Table(name = "ai_chat")
//@NoArgsConstructor
//@AllArgsConstructor
//@Getter
//@Setter
//@Builder
//public class AiChat {
//
//    @Id
//    @GeneratedValue(strategy = GenerationType.IDENTITY)
//    @Column(name = "chat_history_id")
//    private Long chatHistoryId;
//
//    @Column(name = "conversation_id", length = 10)
//    private String conversationId;
//
//    @Column(name = "sender_type", length = 10)
//    private String senderType;
//
//    @Column(name = "raw_message", columnDefinition = "TEXT")
//    private String rawMessage;
//
//    @Column(name = "created_at")
//    private LocalDateTime createdAt;
//
//    @Column(name = "message_index")
//    private Long messageIndex;
//
//    @ManyToOne
//    @JoinColumn(name = "user_id")
//    private User user;
//
//}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\entity\AiReport.java
---
//package com.codehows.taelimbe.entity;
//
//import jakarta.persistence.*;
//import lombok.*;
//
//import java.time.LocalDateTime;
//
//@Entity
//@Table(name = "ai_report")
//@NoArgsConstructor
//@AllArgsConstructor
//@Getter
//@Setter
//@Builder
//public class AiReport {
//
//    @Id
//    @GeneratedValue(strategy = GenerationType.IDENTITY)
//    @Column(name = "report_history_id")
//    private Long reportHistoryId;
//
//    @Column(name = "conversation_id", length = 10)
//    private String conversationId;
//
//    @Column(name = "start_time")
//    private LocalDateTime startTime;
//
//    @Column(name = "end_time")
//    private LocalDateTime endTime;
//
//    @Column(name = "created_at")
//    private LocalDateTime createdAt;
//
//    @Column(name = "raw_message", columnDefinition = "TEXT")
//    private String rawMessage;
//
//    @Column(name = "raw_report", columnDefinition = "TEXT")
//    private String rawReport;
//
//    @ManyToOne
//    @JoinColumn(name = "user_id")
//    private User user;
//
//}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\entity\CleaningData.java
---
package com.codehows.taelimbe.entity;

import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import lombok.Data;

import java.time.LocalDateTime;

/**
 * 'cleaning_data' ?뚯씠釉붽낵 留ㅽ븨?섎뒗 JPA ?뷀떚???대옒?ㅼ엯?덈떎.
 * 泥?냼 ?묒뾽 ?곗씠?곕? ?섑??낅땲??
 *
 * `@Entity`?????대옒?ㅺ? JPA ?뷀떚?곗엫???섑??낅땲??
 * `@Data`??Lombok ?대끂?뚯씠?섏쑝濡? `@Getter`, `@Setter`, `@EqualsAndHashCode`, `@ToString`???먮룞?쇰줈 ?앹꽦?⑸땲??
 */
@Entity
@Data
public class CleaningData {

    /**
     * ?뷀떚?곗쓽 湲곕낯 ??Primary Key)?낅땲??
     * `@Id`?????꾨뱶媛 ?뷀떚?곗쓽 ?앸퀎?먯엫???섑??낅땲??
     * `@GeneratedValue(strategy = GenerationType.IDENTITY)`??湲곕낯 ???앹꽦???곗씠?곕쿋?댁뒪???꾩엫?⑸땲??(?? MySQL??AUTO_INCREMENT).
     */
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long cleaningId;

    private LocalDateTime startTime;

    private LocalDateTime endTime;

    private String location;

    private Long duration; // in minutes

    private Double areaCleaned; // in square meters

    private Double waterUsage; // in liters

    private Double powerUsage; // in kWh
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\entity\Industry.java
---
//package com.codehows.taelimbe.entity;
//
//import jakarta.persistence.*;
//import lombok.*;
//
//@Entity
//@Table(name = "industry")
//@NoArgsConstructor
//@AllArgsConstructor
//@Getter
//@Setter
//@Builder
//public class Industry {
//
//    @Id
//    @GeneratedValue(strategy = GenerationType.IDENTITY)
//    @Column(name = "industry_id")
//    private Long industryId;
//
//    @Column(name = "industry_name", length = 255)
//    private String industryName;
//
//}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\entity\Report.java
---
//package com.codehows.taelimbe.entity;
//
//import jakarta.persistence.*;
//import lombok.*;
//
//import java.time.LocalDateTime;
//
//@Entity
//@Table(name = "report")
//@Getter
//@Setter
//@NoArgsConstructor
//@AllArgsConstructor
//@Builder
//public class Report {
//
//    @Id
//    @GeneratedValue(strategy = GenerationType.IDENTITY)
//    @Column(name = "report_id")
//    private Long reportId;
//
//    @Column(name = "status")
//    private Integer status;
//
//    @Column(name = "start_time")
//    private LocalDateTime startTime;
//
//    @Column(name = "end_time")
//    private LocalDateTime endTime;
//
//    @Column(name = "clean_time")
//    private Float cleanTime;
//
//    @Column(name = "task_area")
//    private Float taskArea;
//
//    @Column(name = "clean_area")
//    private Float cleanArea;
//
//    @Column(name = "mode")
//    private Integer mode;
//
//    @Column(name = "cost_battery")
//    private Long costBattery;
//
//    @Column(name = "cost_water")
//    private Long costWater;
//
//    @Column(name = "map_name", length = 255)
//    private String mapName;
//
//    @Column(name = "map_url", length = 255)
//    private String mapUrl;
//
//    @ManyToOne
//    @JoinColumn(name = "robot_id")
//    private Robot robot;
//
//}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\entity\Robot.java
---
//package com.codehows.taelimbe.entity;
//
//import jakarta.persistence.*;
//import lombok.*;
//
//@Entity
//@Table(name = "robot")
//@Getter
//@Setter
//@NoArgsConstructor
//@AllArgsConstructor
//@Builder
//public class Robot {
//
//    @Id
//    @GeneratedValue(strategy = GenerationType.IDENTITY)
//    @Column(name = "robot_id")
//    private Long robotId;
//
//    @Column(name = "sn", length = 20, nullable = false)
//    private String sn;
//
//    @Column(name = "mac", length = 17, nullable = false)
//    private String mac;
//
//    @Enumerated(EnumType.STRING)
//    @Column(name = "product_code", nullable = false)
//    private ProductCode productCode;
//
//    @Column(name = "soft_version", length = 255)
//    private String softVersion;
//
//    @Enumerated(EnumType.STRING)
//    @Column(name = "work_status")
//    private WorkStatus workStatus;
//
//    @Column(name = "nickname", length = 255)
//    private String nickname;
//
//    @Column(name = "battery")
//    private Long battery;
//
//    @Column(name = "online_yn")
//    private Boolean onlineYn;
//
//    @ManyToOne
//    @JoinColumn(name = "store_id")
//    private Store store;
//
//    public enum ProductCode {
//        CC1, MT1
//    }
//
//    public enum WorkStatus {
//        WAIT, WORK, CHARGE, OFFLINE
//    }
//
//}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\entity\Store.java
---
//package com.codehows.taelimbe.entity;
//
//import jakarta.persistence.*;
//import lombok.*;
//
//@Entity
//@Table(name = "store")
//@NoArgsConstructor
//@AllArgsConstructor
//@Getter
//@Setter
//@Builder
//public class Store {
//
//    @Id
//    @GeneratedValue(strategy = GenerationType.IDENTITY)
//    @Column(name = "store_id")
//    private Long storeId;
//
//    @Column(name = "shop_id")
//    private Long shopId;
//
//    @Column(name = "shop_name", length = 20)
//    private String shopName;
//
//    @ManyToOne
//    @JoinColumn(name = "industry_id")
//    private Industry industry;
//
//}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\entity\User.java
---
//package com.codehows.taelimbe.entity;
//
//import com.codehows.taelimbe.constant.Role;
//import com.codehows.taelimbe.dto.UserDto;
//import jakarta.persistence.*;
//import lombok.*;
////import org.springframework.security.crypto.password.PasswordEncoder;
//
//@Entity
//@Table(name = "user")
//@Getter
//@Setter
//@NoArgsConstructor
//@AllArgsConstructor
//@Builder
//public class User {
//
//    @Id
//    @GeneratedValue(strategy = GenerationType.IDENTITY)
//    @Column(name = "user_id")
//    private Long userId;
//
//    @Column(name = "id", length = 20, unique = true, nullable = false)
//    private String id;
//
//    @Column(name = "pw", length = 50, nullable = false)
//    private String pw;
//
//    @Column(name = "name", length = 20, nullable = false)
//    private String name;
//
//    @Column(name = "address", length = 20, nullable = false)
//    private String address;
//
//    @Column(name = "email", length = 50, nullable = false)
//    private String email;
//
//    @Enumerated(EnumType.STRING)
//    @Column(name = "role", nullable = false)
//    private Role role;
//
//    @ManyToOne
//    @JoinColumn(name = "store_id")
//    private Store store;
//
////    public static User createUser(UserDto dto, Store store, PasswordEncoder encoder) {
////        return User.builder()
////                .id(dto.getId())
////                .pw(encoder.encode(dto.getPw()))  // ?뷀샇??
////                .name(dto.getName())
////                .address(dto.getAddress())
////                .email(dto.getEmail())
////                .role(dto.getRole())
////                .store(store)  // Store ?뷀떚??二쇱엯
////                .build();
////    }
//
//}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\langchain\Agent.java
---
package com.codehows.taelimbe.langchain;

import dev.langchain4j.service.*;
import dev.langchain4j.service.spring.AiService;

/**
 * LangChain4j??AI ?쒕퉬?ㅻ? ?뺤쓽?섎뒗 ?명꽣?섏씠?ㅼ엯?덈떎.
 * ???명꽣?섏씠?ㅻ? ?듯빐 AI 紐⑤뜽怨??곹샇?묒슜?섎ŉ, ???湲곕줉 愿由? ?쒖뒪??硫붿떆吏 ?ㅼ젙, ?ㅽ듃由щ컢 ?묐떟 ?깆쓣 泥섎━?⑸땲??
 *
 * `@AiService` ?대끂?뚯씠?섏쓣 ?듯빐 LangChain4j媛 ?고??꾩뿉 ???명꽣?섏씠?ㅼ쓽 援ы쁽泥대? ?먮룞?쇰줈 ?앹꽦?⑸땲??
 */
@AiService
public interface Agent {

    /**
     * AI ?먯씠?꾪듃???쒖뒪??硫붿떆吏瑜??뺤쓽?⑸땲??
     * ??硫붿떆吏??AI????븷, 吏?쒖궗?? ?쒖빟 議곌굔 ?깆쓣 ?ㅼ젙?섏뿬 AI???됰룞???덈궡?⑸땲??
     * ?ш린?쒕뒗 AI媛 "??뷀븷 ???덇퀬 ?꾧뎄瑜??ъ슜?섏뿬 吏덈Ц???듯븷 ???덈뒗 ?좎슜???댁떆?ㅽ꽩???꾩쓣 紐낆떆?⑸땲??
     */
    @SystemMessage("""
            ?뱀떊? ??뷀븷 ???덇퀬, ?ㅼ뼇???꾧뎄瑜??쒖슜?섏뿬 ?뺥솗?섍퀬 ?좎슜???듬????쒓났?⑸땲??
            ?꾨옒 ?댁슜 以묒뿉???뺤떎???듬????놁쑝硫? 遺덊븘?뷀븯寃??뺣낫瑜??섏뼱?볦? 留먭퀬
            "?듬??쒕┫ ???녿뒗 ?뺣낫?낅땲??"?쇨퀬 媛꾨떒??留먰븯??떆??
            """)
    /**
     * ?ъ슜?먯쓽 硫붿떆吏瑜?諛쏆븘 ?ㅽ듃由щ컢 諛⑹떇?쇰줈 AI???묐떟??諛섑솚?섎뒗 硫붿꽌?쒖엯?덈떎.
     *
     * @param message ?ъ슜?먯쓽 ?낅젰 硫붿떆吏?낅땲?? `@UserMessage` ?대끂?뚯씠?섏쓣 ?듯빐
     *                ???뚮씪誘명꽣媛 AI?먭쾶 ?꾨떖???ъ슜??硫붿떆吏?꾩쓣 ?섑??낅땲??
     * @param memoryId 媛???붾? 怨좎쑀?섍쾶 ?앸퀎?섎뒗 ID?낅땲?? `@MemoryId` ?대끂?뚯씠?섏쓣 ?듯빐 LangChain4j媛
     *                 ??ID瑜??ъ슜?섏뿬 ?대떦 ??붿쓽 湲곕줉(ChatMemory)??愿由ы븯?꾨줉 ?⑸땲??
     *                 ?대? ?듯빐 硫?고꽩 ??붽? 媛?ν빐吏묐땲??
     * @return AI???묐떟???댁? ?좏겙 ?ㅽ듃由?`TokenStream`)??諛섑솚?⑸땲??
     *         `TokenStream`???ъ슜?섎㈃ AI???묐떟???ㅼ떆媛꾩쑝濡??좏겙 ?⑥쐞濡?諛쏆쓣 ???덉뒿?덈떎.
     */
    TokenStream chat(@UserMessage String message, @MemoryId Object memoryId);
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\langchain\config\AgentConfig.java
---
package com.codehows.taelimbe.langchain.config;

import com.codehows.taelimbe.langchain.Agent;
import com.codehows.taelimbe.langchain.tools.ChatTools;
import com.codehows.taelimbe.langchain.tools.ReportTools;
import dev.langchain4j.memory.chat.ChatMemoryProvider;
import dev.langchain4j.model.chat.StreamingChatLanguageModel;
import dev.langchain4j.rag.content.retriever.ContentRetriever;
import dev.langchain4j.service.AiServices;
import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
@RequiredArgsConstructor
public class AgentConfig {
    /**
     * 理쒖쥌?곸쑝濡?AI ?쒕퉬?ㅻ? ?앹꽦?섏뿬 Bean?쇰줈 ?깅줉?⑸땲??
     * ??`Agent`???꾩뿉???뺤쓽??紐⑤뱺 而댄룷?뚰듃(梨꾪똿 紐⑤뜽, ?꾧뎄, ???硫붾え由? 肄섑뀗痢?寃?됯린)瑜??듯빀?섏뿬
     * AI ?쒕퉬?ㅼ쓽 ?듭떖 濡쒖쭅???쒓났?⑸땲??
     *
     * @param streamingChatLanguageModel ?ㅽ듃由щ컢 梨꾪똿 紐⑤뜽 (?댁쟾???뺤쓽??鍮덉쓣 二쇱엯諛쏆쓬)
     * @param tools ?ъ슜???뺤쓽 ?꾧뎄 (?댁쟾???뺤쓽??鍮덉쓣 二쇱엯諛쏆쓬)
     * @param chatMemoryProvider ???硫붾え由??쒓났??(?댁쟾???뺤쓽??鍮덉쓣 二쇱엯諛쏆쓬)
     * @param contentRetriever RAG 肄섑뀗痢?寃?됯린 (?댁쟾???뺤쓽??鍮덉쓣 二쇱엯諛쏆쓬)
     * @return LangChain4j???섑빐 ?숈쟻?쇰줈 ?앹꽦??`Agent` ?명꽣?섏씠?ㅼ쓽 援ы쁽泥?
     */
    @Bean
    public Agent reportAgent(StreamingChatLanguageModel streamingChatLanguageModel, ReportTools tools, ChatMemoryProvider chatMemoryProvider, ContentRetriever contentRetriever) {
        return AiServices.builder(Agent.class)
                .streamingChatLanguageModel(streamingChatLanguageModel)
                .tools(tools) // AI媛 ?ъ슜?????덈뒗 ?꾧뎄?ㅼ쓣 ?깅줉?⑸땲??
                .chatMemoryProvider(chatMemoryProvider) // ???硫붾え由??쒓났?먮? ?깅줉?⑸땲??
//                .contentRetriever(contentRetriever) // RAG瑜??꾪븳 肄섑뀗痢?寃?됯린瑜??깅줉?⑸땲??
                .build();
    }

    @Bean
    public Agent chatAgent(StreamingChatLanguageModel streamingChatLanguageModel, ChatTools tools, ChatMemoryProvider chatMemoryProvider, ContentRetriever contentRetriever) {
        return AiServices.builder(Agent.class)
                .streamingChatLanguageModel(streamingChatLanguageModel)
                .tools(tools) // AI媛 ?ъ슜?????덈뒗 ?꾧뎄?ㅼ쓣 ?깅줉?⑸땲??
                .chatMemoryProvider(chatMemoryProvider) // ???硫붾え由??쒓났?먮? ?깅줉?⑸땲??
                .contentRetriever(contentRetriever) // RAG瑜??꾪븳 肄섑뀗痢?寃?됯린瑜??깅줉?⑸땲??
                .build();
    }
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\langchain\config\GeminiLLMFactory.java
---
package com.codehows.taelimbe.langchain.config;

import com.codehows.taelimbe.langchain.models.GeminiEmbeddingModel;
import com.codehows.taelimbe.langchain.models.GeminiStreamingChatModel;
import com.google.genai.Client;
import dev.langchain4j.model.chat.StreamingChatLanguageModel;
import dev.langchain4j.model.embedding.EmbeddingModel;
import lombok.RequiredArgsConstructor;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

/**
 * Google Gemini LLM???꾪븳 `LLMFactory` 援ы쁽泥댁엯?덈떎.
 * ???⑺넗由щ뒗 `com.google.genai.Client`瑜??ъ슜?섏뿬 Gemini ?ㅽ듃由щ컢 梨꾪똿 紐⑤뜽怨??꾨쿋??紐⑤뜽???앹꽦?⑸땲??
 * `@Component` ?대끂?뚯씠?섏쓣 ?듯빐 Spring 而⑦뀒?대꼫???섑빐 愿由щ릺??鍮덉쑝濡??깅줉?⑸땲??
 * `@RequiredArgsConstructor`??Lombok ?대끂?뚯씠?섏쑝濡? final ?꾨뱶??????앹꽦?먮? ?먮룞?쇰줈 ?앹꽦?섏뿬 ?섏〈??二쇱엯???⑹씠?섍쾶 ?⑸땲??
 */
@Component
@RequiredArgsConstructor
public class GeminiLLMFactory implements LLMFactory {

    // `com.google.genai` ?대씪?댁뼵??二쇱엯
    private final Client geminiClient;

    // application.properties?먯꽌 Gemini 梨꾪똿 紐⑤뜽 ?대쫫??二쇱엯諛쏆뒿?덈떎.
    @Value("${gemini.model.chat}")
    private String chatModelName;

    // application.properties?먯꽌 Gemini ?꾨쿋??紐⑤뜽 ?대쫫??二쇱엯諛쏆뒿?덈떎.
    @Value("${gemini.model.embedding}")
    private String embeddingModelName;

    /**
     * Gemini ?ㅽ듃由щ컢 梨꾪똿 紐⑤뜽???앹꽦?섏뿬 諛섑솚?⑸땲??
     * `GeminiStreamingChatModel`??鍮뚮뜑瑜??ъ슜?섏뿬 紐⑤뜽??援ъ꽦?⑸땲??
     *
     * @return `GeminiStreamingChatModel` ?몄뒪?댁뒪
     */
    @Override
    public StreamingChatLanguageModel createStreamingChatModel() {
        return GeminiStreamingChatModel.builder()
                .geminiClient(geminiClient)
                .modelName(chatModelName)
                .build();
    }

    /**
     * Gemini ?꾨쿋??紐⑤뜽???앹꽦?섏뿬 諛섑솚?⑸땲??
     * `GeminiEmbeddingModel`???앹꽦?먮? ?ъ슜?섏뿬 紐⑤뜽??援ъ꽦?⑸땲??
     *
     * @return `GeminiEmbeddingModel` ?몄뒪?댁뒪
     */
    @Override
    public EmbeddingModel createEmbeddingModel() {
        return new GeminiEmbeddingModel(geminiClient, embeddingModelName);
    }
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\langchain\config\LangChainConfig.java
---
package com.codehows.taelimbe.langchain.config;

import com.codehows.taelimbe.langchain.converters.LocalDateTimeAdapter;
import com.google.genai.Client;
import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import dev.langchain4j.data.segment.TextSegment;
import dev.langchain4j.memory.chat.ChatMemoryProvider;
import dev.langchain4j.memory.chat.MessageWindowChatMemory;
import dev.langchain4j.model.chat.StreamingChatLanguageModel;
import dev.langchain4j.model.embedding.EmbeddingModel;
import dev.langchain4j.rag.content.retriever.ContentRetriever;
import dev.langchain4j.rag.content.retriever.EmbeddingStoreContentRetriever;
import dev.langchain4j.store.embedding.EmbeddingStore;
import dev.langchain4j.store.embedding.milvus.MilvusEmbeddingStore;
import dev.langchain4j.store.memory.chat.InMemoryChatMemoryStore;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import java.time.LocalDateTime;

/**
 * LangChain4j? 愿?⑤맂 紐⑤뱺 Bean ?ㅼ젙???대떦?섎뒗 ?대옒?ㅼ엯?덈떎.
 * AI 紐⑤뜽, ?꾨쿋?? 踰≫꽣 ??μ냼, ???硫붾え由???AI ?쒕퉬?ㅼ쓽 ?듭떖 援ъ꽦?붿냼瑜??ㅼ젙?⑸땲??
 * `@Configuration` ?대끂?뚯씠?섏? ???대옒?ㅺ? Spring???ㅼ젙 ?대옒?ㅼ엫???섑??낅땲??
 */
@Configuration
public class LangChainConfig {

    // Gemini API ?? LLMFactory?먯꽌 ?ъ슜?섍린 ?꾪빐 ?④꺼?〓땲??
    @Value("${gemini.api.key}")
    private String geminiApiKey;

    @Value("${langchain.chat.max-messages}")
    private Integer chatMaxMessages;

    // Milvus 踰≫꽣 ??μ냼 ?ㅼ젙???꾪븳 ?꾨줈?쇳떚
    @Value("${milvus.host}")
    private String milvusHost;

    @Value("${milvus.port}")
    private Integer milvusPort;

    @Value("${milvus.collection-name}")
    private String milvusCollectionName;

    @Value("${langchain.rag.max-results}")
    private Integer langChainRagMaxResults;

    @Value("${langchain.rag.min-score}")
    private Double langChainRagMinScore;

    @Value("${milvus.embedding.dimension}")
    private Integer embeddingDimension;

    /**
     * Gson ?몄뒪?댁뒪瑜?Spring Bean?쇰줈 ?깅줉?⑸땲??
     * `LocalDateTimeAdapter`瑜??깅줉?섏뿬 `LocalDateTime` 媛앹껜瑜?ISO 8601 ?뺤떇?쇰줈
     * 吏곷젹????쭅?ы솕?????덈룄濡?援ъ꽦?⑸땲??
     *
     * @return 援ъ꽦??`Gson` ?몄뒪?댁뒪
     */
    @Bean
    public Gson gson() {
        return new GsonBuilder()
                .registerTypeAdapter(LocalDateTime.class, new LocalDateTimeAdapter())
                .create();
    }

    /**
     * `com.google.genai` ?대씪?댁뼵?몃? Bean?쇰줈 ?깅줉?⑸땲??
     * ???대씪?댁뼵?몃뒗 Gemini 紐⑤뜽怨쇱쓽 吏곸젒?곸씤 ?듭떊???대떦?⑸땲?ㅳ?
     * `@Bean` ?대끂?뚯씠?섏? ??硫붿꽌?쒓? 諛섑솚?섎뒗 媛앹껜瑜?Spring 而⑦뀒?대꼫??鍮덉쑝濡??깅줉?섎룄濡?吏?쒗빀?덈떎.
     *
     * @return `com.google.genai.Client` ?몄뒪?댁뒪
     */
    @Bean
    public Client geminiClient() {
        return Client.builder()
                .apiKey(geminiApiKey)
                .build();
    }

    /**
     * LLMFactory ?명꽣?섏씠?ㅼ쓽 援ы쁽泥대? Bean?쇰줈 ?깅줉?⑸땲??
     * ?ш린?쒕뒗 GeminiLLMFactory瑜??ъ슜?⑸땲??
     *
     * @param geminiClient `com.google.genai` ?대씪?댁뼵??(?댁쟾???뺤쓽??鍮덉쓣 二쇱엯諛쏆쓬)
     * @return `LLMFactory` ?몄뒪?댁뒪
     */
    @Bean
    public LLMFactory llmFactory(Client geminiClient) {
        return new GeminiLLMFactory(geminiClient);
    }

    /**
     * ?ㅽ듃由щ컢 梨꾪똿 ?몄뼱 紐⑤뜽??Bean?쇰줈 ?깅줉?⑸땲??
     * `LLMFactory`瑜??듯빐 紐⑤뜽???앹꽦?⑸땲??
     *
     * @param llmFactory LLMFactory (?댁쟾???뺤쓽??鍮덉쓣 二쇱엯諛쏆쓬)
     * @return `StreamingChatLanguageModel` ?몄뒪?댁뒪
     */
    @Bean
    public StreamingChatLanguageModel streamingChatLanguageModel(LLMFactory llmFactory) {
        return llmFactory.createStreamingChatModel();
    }

    /**
     * ?꾨쿋??紐⑤뜽??Bean?쇰줈 ?깅줉?⑸땲??
     * `LLMFactory`瑜??듯빐 紐⑤뜽???앹꽦?⑸땲??
     *
     * @param llmFactory LLMFactory (?댁쟾???뺤쓽??鍮덉쓣 二쇱엯諛쏆쓬)
     * @return `EmbeddingModel` ?몄뒪?댁뒪
     */
    @Bean
    public EmbeddingModel embeddingModel(LLMFactory llmFactory) {
        return llmFactory.createEmbeddingModel();
    }

    /**
     * Milvus ?꾨쿋????μ냼瑜?Bean?쇰줈 ?깅줉?⑸땲??
     * ?꾨쿋?⑸맂 踰≫꽣 ?곗씠?곕? ??ν븯怨?寃?됲븯?????ъ슜?⑸땲??
     *
     * @return `EmbeddingStore` ?몄뒪?댁뒪
     */
    @Bean
    public EmbeddingStore<TextSegment> embeddingStore() {
        return MilvusEmbeddingStore.builder()
                .host(milvusHost)
                .port(milvusPort)
                .collectionName(milvusCollectionName)
                .dimension(embeddingDimension) // Gemini ?꾨쿋??紐⑤뜽??李⑥썝 ??(text-embedding-004 湲곗?)
                .build();
    }

    /**
     * ?꾨쿋????μ냼瑜??쒖슜?섎뒗 `ContentRetriever`瑜?Bean?쇰줈 ?깅줉?⑸땲??
     * RAG(Retrieval-Augmented Generation)???듭떖 ?붿냼濡? ?ъ슜??吏덈Ц怨?愿?⑤맂 臾몄꽌瑜?踰≫꽣 ??μ냼?먯꽌 李얠븘 AI 紐⑤뜽???쒓났?⑸땲??
     *
     * @param embeddingStore ?꾨쿋????μ냼 (?댁쟾???뺤쓽??鍮덉쓣 二쇱엯諛쏆쓬)
     * @param embeddingModel ?꾨쿋??紐⑤뜽 (?댁쟾???뺤쓽??鍮덉쓣 二쇱엯諛쏆쓬)
     * @return `ContentRetriever` ?몄뒪?댁뒪
     */
    @Bean
    public ContentRetriever contentRetriever(EmbeddingStore<TextSegment> embeddingStore, EmbeddingModel embeddingModel) {
        return EmbeddingStoreContentRetriever.builder()
                .embeddingStore(embeddingStore)
                .embeddingModel(embeddingModel)
                .maxResults(langChainRagMaxResults) // 理쒕? 2媛쒖쓽 愿?⑥꽦 ?믪? 寃곌낵瑜?寃?됲빀?덈떎.
                .minScore(langChainRagMinScore) // 理쒖냼 ?좎궗???먯닔媛 0.5 ?댁긽??寃곌낵留?諛섑솚?⑸땲??
                .build();
    }

    /**
     * ???硫붾え由??쒓났??`ChatMemoryProvider`)瑜?Bean?쇰줈 ?깅줉?⑸땲??
     * ?ъ슜?먮퀎 ???湲곕줉??愿由ы븯??硫?고꽩 ??붾? 媛?ν븯寃??⑸땲??
     * `MessageWindowChatMemory`??理쒓렐 N媛쒖쓽 硫붿떆吏瑜?湲곗뼲?섎뒗 ?덈룄??湲곕컲 硫붾え由ъ엯?덈떎.
     *
     * @return `ChatMemoryProvider` ?몄뒪?댁뒪
     */
    @Bean
    public ChatMemoryProvider chatMemoryProvider() {
        return memoryId -> MessageWindowChatMemory.builder()
                .id(memoryId) // ???ID瑜?湲곕컲?쇰줈 硫붾え由щ? 愿由ы빀?덈떎.
                .maxMessages(chatMaxMessages) // 理쒓렐 20媛쒖쓽 硫붿떆吏瑜?湲곗뼲?⑸땲??
                .chatMemoryStore(new InMemoryChatMemoryStore()) // 硫붾え由???μ쓣 ?꾪븳 ?몃찓紐⑤━ ?ㅽ넗?대? ?ъ슜?⑸땲??
                .build();
    }

}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\langchain\config\LLMFactory.java
---
package com.codehows.taelimbe.langchain.config;

import dev.langchain4j.model.chat.StreamingChatLanguageModel;
import dev.langchain4j.model.embedding.EmbeddingModel;

/**
 * ?ㅼ뼇??LLM(Large Language Model) ?쒓났?먮줈遺???ㅽ듃由щ컢 梨꾪똿 紐⑤뜽怨??꾨쿋??紐⑤뜽???앹꽦?섍린 ?꾪븳 ?⑺넗由??명꽣?섏씠?ㅼ엯?덈떎.
 * ???명꽣?섏씠?ㅻ? ?듯빐 ?뱀젙 LLM 援ы쁽泥댁뿉 ????섏〈?깆쓣 以꾩씠怨?
 * ?덈줈??LLM ?쒓났?먮? ?쎄쾶 ?듯빀?????덈룄濡??뺤옣?깆쓣 ?쒓났?⑸땲??
 */
public interface LLMFactory {

    /**
     * ?ㅽ듃由щ컢 梨꾪똿 ?몄뼱 紐⑤뜽???앹꽦?섏뿬 諛섑솚?⑸땲??
     *
     * @return ?ㅽ듃由щ컢 梨꾪똿 ?몄뼱 紐⑤뜽???몄뒪?댁뒪
     */
    StreamingChatLanguageModel createStreamingChatModel();

    /**
     * ?꾨쿋??紐⑤뜽???앹꽦?섏뿬 諛섑솚?⑸땲??
     *
     * @return ?꾨쿋??紐⑤뜽???몄뒪?댁뒪
     */
    EmbeddingModel createEmbeddingModel();
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\langchain\converters\JsonConverter.java
---
package com.codehows.taelimbe.langchain.converters;

import com.google.gson.JsonArray;
import com.google.gson.JsonElement;
import com.google.gson.JsonObject;
import com.google.gson.JsonPrimitive;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * JSON 媛앹껜? Java 而щ젆??媛꾩쓽 蹂?섏쓣 ?대떦?섎뒗 ?좏떥由ы떚 ?대옒?ㅼ엯?덈떎.
 * Google??GSON ?쇱씠釉뚮윭由щ? ?ъ슜?섏뿬 JSON 吏곷젹????쭅?ы솕瑜??섑뻾?⑸땲??
 */
public class JsonConverter {

    /**
     * GSON `JsonObject`瑜?`Map<String, Object>`濡?蹂?섑빀?덈떎.
     * JSON 媛앹껜????媛??띿쓣 Java Map?쇰줈 留ㅽ븨?⑸땲??
     *
     * @param jsonObject 蹂?섑븷 `JsonObject`
     * @return 蹂?섎맂 `Map<String, Object>`
     */
    public static Map<String, Object> jsonToMap(JsonObject jsonObject) {
        Map<String, Object> map = new HashMap<>();
        // JsonObject??紐⑤뱺 ?뷀듃由щ? ?쒗쉶?섎ŉ Map??異붽??⑸땲??
        for (Map.Entry<String, JsonElement> entry : jsonObject.entrySet()) {
            map.put(entry.getKey(), jsonElementToObject(entry.getValue()));
        }
        return map;
    }

    /**
     * GSON `JsonArray`瑜?`List<Object>`濡?蹂?섑빀?덈떎.
     * JSON 諛곗뿴???붿냼?ㅼ쓣 Java List濡?留ㅽ븨?⑸땲??
     *
     * @param jsonArray 蹂?섑븷 `JsonArray`
     * @return 蹂?섎맂 `List<Object>`
     */
    public static List<Object> jsonToList(JsonArray jsonArray) {
        List<Object> list = new ArrayList<>();
        // JsonArray??紐⑤뱺 ?붿냼瑜??쒗쉶?섎ŉ List??異붽??⑸땲??
        for (JsonElement element : jsonArray) {
            list.add(jsonElementToObject(element));
        }
        return list;
    }

    /**
     * GSON `JsonElement`瑜??곸젅??Java 媛앹껜(Map, List, Primitive ???濡?蹂?섑빀?덈떎.
     * ??硫붿꽌?쒕뒗 ?ш??곸쑝濡??몄텧?섏뼱 以묒꺽??JSON 援ъ“瑜?泥섎━?????덉뒿?덈떎.
     *
     * @param jsonElement 蹂?섑븷 `JsonElement`
     * @return 蹂?섎맂 Java 媛앹껜 (Map, List, Boolean, Number, String ?먮뒗 null)
     * @throws IllegalArgumentException 吏?먰븯吏 ?딅뒗 `JsonElement` ??낆씤 寃쎌슦 諛쒖깮
     */
    private static Object jsonElementToObject(JsonElement jsonElement) {
        if (jsonElement.isJsonObject()) {
            // JsonObject??寃쎌슦 Map?쇰줈 蹂?섑빀?덈떎.
            return jsonToMap(jsonElement.getAsJsonObject());
        } else if (jsonElement.isJsonArray()) {
            // JsonArray??寃쎌슦 List濡?蹂?섑빀?덈떎.
            return jsonToList(jsonElement.getAsJsonArray());
        } else if (jsonElement.isJsonPrimitive()) {
            // JsonPrimitive??寃쎌슦 湲곕낯 ???Boolean, Number, String)?쇰줈 蹂?섑빀?덈떎.
            JsonPrimitive primitive = jsonElement.getAsJsonPrimitive();
            if (primitive.isBoolean()) {
                return primitive.getAsBoolean();
            } else if (primitive.isNumber()) {
                return primitive.getAsNumber();
            } else {
                return primitive.getAsString();
            }
        } else if (jsonElement.isJsonNull()) {
            // JsonNull??寃쎌슦 null??諛섑솚?⑸땲??
            return null;
        } else {
            // 洹??몄쓽 ?????녿뒗 ??낆씤 寃쎌슦 ?덉쇅瑜?諛쒖깮?쒗궢?덈떎.
            throw new IllegalArgumentException("Unsupported JsonElement type: " + jsonElement);
        }
    }
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\langchain\converters\LocalDateTimeAdapter.java
---
package com.codehows.taelimbe.langchain.converters;

import com.google.gson.*;

import java.lang.reflect.Type;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

/**
 * `LocalDateTime` 媛앹껜瑜?JSON?쇰줈 吏곷젹?뷀븯嫄곕굹 JSON?먯꽌 ??쭅?ы솕?섍린 ?꾪븳 GSON ?대뙌???대옒?ㅼ엯?덈떎.
 * ISO 8601 ?뺤떇(?? "2024-01-01T12:30:00")?쇰줈 蹂?섏쓣 泥섎━?⑸땲??
 */
public class LocalDateTimeAdapter implements JsonSerializer<LocalDateTime>, JsonDeserializer<LocalDateTime> {
    private static final DateTimeFormatter formatter = DateTimeFormatter.ISO_LOCAL_DATE_TIME;

    @Override
    public JsonElement serialize(LocalDateTime src, Type typeOfSrc, JsonSerializationContext context) {
        return new JsonPrimitive(src.format(formatter));
    }

    @Override
    public LocalDateTime deserialize(JsonElement json, Type typeOfT, JsonDeserializationContext context) throws JsonParseException {
        return LocalDateTime.parse(json.getAsString(), formatter);
    }
}
---
C:\tealim-be\src\main\java\com\codehows\taelimbe\langchain\converters\MessageConverter.java
---
package com.codehows.taelimbe.langchain.converters;

import com.google.genai.types.Content;
import com.google.genai.types.Part;
import com.google.gson.JsonObject;
import com.google.gson.JsonParser;
import dev.langchain4j.data.message.*;
import lombok.extern.slf4j.Slf4j;

import java.util.Collections;
import java.util.List;
import java.util.stream.Collectors;

/**
 * LangChain4j??ChatMessage瑜?`com.google.genai`??Content 媛앹껜濡?蹂?섑븯???좏떥由ы떚 ?대옒?ㅼ엯?덈떎.
 */
@Slf4j
public class MessageConverter {
    /**
     * ChatMessage 由ъ뒪?몃? Content 由ъ뒪?몃줈 蹂?섑빀?덈떎.
     * @param messages LangChain4j??ChatMessage 由ъ뒪??
     * @return `com.google.genai`??Content 由ъ뒪??
     */
    public static List<Content> toGoogleAiMessages(List<ChatMessage> messages) {
        return messages.stream()
                .map(MessageConverter::toGoogleAiMessage)
                .collect(Collectors.toList());
    }

    /**
     * ?⑥씪 ChatMessage瑜?Content 媛앹껜濡?蹂?섑빀?덈떎.
     * @param message LangChain4j??ChatMessage
     * @return `com.google.genai`??Content 媛앹껜
     */
    private static Content toGoogleAiMessage(ChatMessage message) {
        String role = toGoogleAiRole(message);
        List<Part> parts = toGoogleAiParts(message);

        return Content.builder()
                .role(role)
                .parts(parts)
                .build();
    }

    /**
     * ChatMessage????낆뿉 ?곕씪 `com.google.genai`????븷(role)??寃곗젙?⑸땲??
     * @param message LangChain4j??ChatMessage
     * @return `com.google.genai`????븷 臾몄옄??("user" ?먮뒗 "model")
     */
    private static String toGoogleAiRole(ChatMessage message) {
        if (message instanceof UserMessage || message instanceof ToolExecutionResultMessage) {
            return "user";
        } else if (message instanceof AiMessage || message instanceof SystemMessage) {
            return "model";
        } else {
            throw new IllegalArgumentException("Unknown message type: " + message);
        }
    }

    /**
     * ChatMessage???댁슜??`com.google.genai`??Part 由ъ뒪?몃줈 蹂?섑빀?덈떎.
     * @param message LangChain4j??ChatMessage
     * @return `com.google.genai`??Part 由ъ뒪??
     */
    private static List<Part> toGoogleAiParts(ChatMessage message) {
        if (message instanceof UserMessage) {
            return Collections.singletonList(Part.fromText(((UserMessage) message).singleText()));
        }

        if (message instanceof SystemMessage) {
            // SystemMessage??UserMessage泥섎읆 ?띿뒪?몃줈 泥섎━
            return Collections.singletonList(Part.fromText(((SystemMessage) message).text()));
        }

        if (message instanceof AiMessage aiMessage) {
            if (aiMessage.hasToolExecutionRequests()) {
                List<Part> parts = aiMessage.toolExecutionRequests().stream()
                        .map(toolExecutionRequest -> {
                            try {
                                String argumentsJson = toolExecutionRequest.arguments();
                                JsonObject jsonObject = JsonParser.parseString(argumentsJson).getAsJsonObject();
                                return Part.fromFunctionCall(
                                        toolExecutionRequest.name(),
                                        JsonConverter.jsonToMap(jsonObject));
                            } catch (Exception e) {
                                // 濡쒓렇 異쒕젰 諛?湲곕낯 fallback 泥섎━
                                log.error("Invalid JSON in toolExecutionRequest arguments: {}", toolExecutionRequest.arguments(), e);
                                return Part.fromFunctionCall(toolExecutionRequest.name(), Collections.emptyMap());
                            }
                        })
                        .collect(Collectors.toList());
                // ?띿뒪?멸? ?덈뒗 寃쎌슦 ?띿뒪???뚰듃??異붽?
                if (aiMessage.text() != null && !aiMessage.text().isEmpty()) {
                    parts.addFirst(Part.fromText(aiMessage.text()));
                }
                return parts;
            } else {
                return Collections.singletonList(Part.fromText(aiMessage.text()));
            }
        }

        if (message instanceof ToolExecutionResultMessage toolExecutionResultMessage) {
            return Collections.singletonList(
                    Part.fromFunctionResponse(
                            toolExecutionResultMessage.toolName(),
                            Collections.singletonMap("content", toolExecutionResultMessage.text()))
            );
        }

        throw new IllegalArgumentException("Unknown message type: " + message);
    }
}


---
C:\tealim-be\src\main\java\com\codehows\taelimbe\langchain\converters\ToolConverter.java
---
package com.codehows.taelimbe.langchain.converters;

import com.google.genai.types.FunctionDeclaration;
import com.google.genai.types.Schema;
import com.google.genai.types.Tool;
import dev.langchain4j.agent.tool.ToolParameters;
import dev.langchain4j.agent.tool.ToolSpecification;

import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

/**
 * LangChain4j??`ToolSpecification` 媛앹껜瑜?`com.google.genai` ?쇱씠釉뚮윭由ъ뿉???ъ슜?섎뒗 `Tool` 媛앹껜濡?蹂?섑븯???좏떥由ы떚 ?대옒?ㅼ엯?덈떎.
 * Google Gemini API??紐⑤뜽???몄텧?????덈뒗 ?꾧뎄?ㅼ쓣 `FunctionDeclaration` ?뺥깭濡??뺤쓽?섏뿬 諛쏆뒿?덈떎.
 * ??而⑤쾭?곕뒗 LangChain4j???꾧뎄 紐낆꽭瑜?Gemini???⑥닔 ?좎뼵 ?뺤떇??留욊쾶 留ㅽ븨?⑸땲??
 */
public class ToolConverter {

    /**
     * LangChain4j??`ToolSpecification` 由ъ뒪?몃? `com.google.genai`??`Tool` 由ъ뒪?몃줈 蹂?섑빀?덈떎.
     * Gemini API??`Tool` 媛앹껜 ?댁뿉 `FunctionDeclaration` 由ъ뒪?몃? ?ы븿?섎뒗 援ъ“瑜?媛吏묐땲??
     *
     * @param toolSpecifications 蹂?섑븷 LangChain4j `ToolSpecification` 由ъ뒪??
     * @return 蹂?섎맂 `com.google.genai` `Tool` 由ъ뒪?? ?꾧뎄 紐낆꽭媛 ?놁쑝硫?null??諛섑솚?⑸땲??
     */
    public static List<Tool> toGoogleAiTools(List<ToolSpecification> toolSpecifications) {
        if (toolSpecifications == null || toolSpecifications.isEmpty()) {
            return List.of(); // ?꾧뎄 紐낆꽭媛 ?놁쑝硫?null??諛섑솚?섏뿬 API ?붿껌?먯꽌 ?꾧뎄 ?꾨뱶瑜??앸왂?섎룄濡??⑸땲??
        }
        return List.of(
                Tool.builder()
                        .functionDeclarations(toFunctionDeclarations(toolSpecifications)) // ?꾧뎄 紐낆꽭瑜??⑥닔 ?좎뼵?쇰줈 蹂?섑븯???ы븿
                        .build()
        );
    }

    /**
     * LangChain4j??`ToolSpecification` 由ъ뒪?몃? `com.google.genai`??`FunctionDeclaration` 由ъ뒪?몃줈 蹂?섑빀?덈떎.
     *
     * @param toolSpecifications 蹂?섑븷 LangChain4j `ToolSpecification` 由ъ뒪??
     * @return 蹂?섎맂 `com.google.genai` `FunctionDeclaration` 由ъ뒪??
     */
    private static List<FunctionDeclaration> toFunctionDeclarations(List<ToolSpecification> toolSpecifications) {
        return toolSpecifications.stream()
                .map(toolSpecification -> FunctionDeclaration.builder()
                        .name(toolSpecification.name()) // ?꾧뎄???대쫫???ㅼ젙?⑸땲??
                        .description(toolSpecification.description()) // ?꾧뎄???ㅻ챸???ㅼ젙?⑸땲??
                        .parameters(toSchema(toolSpecification.parameters())) // ?꾧뎄???뚮씪誘명꽣 ?ㅽ궎留덈? 蹂?섑븯???ㅼ젙?⑸땲??
                        .build())
                .collect(Collectors.toList());
    }

    /**
     * LangChain4j??`ToolParameters` 媛앹껜瑜?`com.google.genai`??`Schema` 媛앹껜濡?蹂?섑빀?덈떎.
     * `ToolParameters`???꾧뎄???낅젰 ?뚮씪誘명꽣?????JSON ?ㅽ궎留??뺤쓽瑜??ы븿?⑸땲??
     *
     * @param toolParameters 蹂?섑븷 LangChain4j `ToolParameters`
     * @return 蹂?섎맂 `com.google.genai` `Schema` 媛앹껜. ?뚮씪誘명꽣媛 ?놁쑝硫?null??諛섑솚?⑸땲??
     */
    private static Schema toSchema(ToolParameters toolParameters) {
        if (toolParameters == null) {
            return null; // ?뚮씪誘명꽣媛 ?놁쑝硫?null??諛섑솚?⑸땲??
        }

        // LangChain4j??ToolParameters??Map<String, Object> ?뺥깭??JSON ?ㅽ궎留덈? 媛吏묐땲??
        // ?대? Gemini API??Schema.Builder瑜??ъ슜?섏뿬 援ъ꽦?⑸땲??
        Schema.Builder builder = Schema.builder();
        // ?ㅽ궎留덉쓽 'type' ?꾨뱶瑜??ㅼ젙?⑸땲?? ?쇰컲?곸쑝濡?"object"?낅땲??
        builder.type(toolParameters.type().toUpperCase());

        // ?ㅽ궎留덉쓽 'properties' ?꾨뱶瑜??ㅼ젙?⑸땲?? 媛??뚮씪誘명꽣???대쫫怨??대떦 ?ㅽ궎留덈? ?ы븿?⑸땲??
        if (toolParameters.properties() != null && !toolParameters.properties().isEmpty()) {
            Map<String, Schema> propertiesMap = new HashMap<>();
            for (Map.Entry<String, Map<String, Object>> entry : toolParameters.properties().entrySet()) {
                // 媛??뚮씪誘명꽣???ㅽ궎留덈? ?ш??곸쑝濡?蹂?섑븯??異붽??⑸땲??
                propertiesMap.put(entry.getKey(), mapToSchema(entry.getValue()));
            }
            builder.properties(propertiesMap);
        }

        // ?ㅽ궎留덉쓽 'required' ?꾨뱶瑜??ㅼ젙?⑸땲?? ?꾩닔 ?뚮씪誘명꽣 紐⑸줉?낅땲??
        if (toolParameters.required() != null && !toolParameters.required().isEmpty()) {
            builder.required(toolParameters.required());
        }
        
        return builder.build();
    }

    /**
     * Map ?뺥깭??JSON ?ㅽ궎留덈? `com.google.genai`??`Schema` 媛앹껜濡??ш??곸쑝濡?蹂?섑빀?덈떎.
     * ??硫붿꽌?쒕뒗 `toSchema(ToolParameters)`?먯꽌 以묒꺽???ㅽ궎留덈? 泥섎━?섍린 ?꾪빐 ?몄텧?⑸땲??
     *
     * @param map ?ㅽ궎留??뺣낫瑜??닿퀬 ?덈뒗 Map
     * @return 蹂?섎맂 `com.google.genai` `Schema` 媛앹껜
     */
    @SuppressWarnings("unchecked") // Map?????罹먯뒪?낆뿉 ???寃쎄퀬瑜??듭젣?⑸땲??
    private static Schema mapToSchema(Map<String, Object> map) {
        Schema.Builder builder = Schema.builder();
        if (map.containsKey("type")) {
            builder.type(map.get("type").toString().toUpperCase());
        }
        if (map.containsKey("description")) {
            builder.description(map.get("description").toString());
        }
        if (map.containsKey("enum")) {
            builder.enum_(((List<String>) map.get("enum")));
        }
        if (map.containsKey("properties")) {
            Map<String, Schema> propertiesMap = new HashMap<>();
            Map<String, Map<String, Object>> properties = (Map<String, Map<String, Object>>) map.get("properties");
            for (Map.Entry<String, Map<String, Object>> entry : properties.entrySet()) {
                propertiesMap.put(entry.getKey(), mapToSchema(entry.getValue()));
            }
            builder.properties(propertiesMap);
        }
        if (map.containsKey("required")) {
            builder.required(((List<String>) map.get("required")));
        }
        if (map.containsKey("items")) {
            builder.items(mapToSchema((Map<String, Object>) map.get("items")));
        }
        return builder.build();
    }
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\langchain\embaddings\EmbeddingStoreManager.java
---
package com.codehows.taelimbe.langchain.embaddings;

import io.milvus.client.MilvusServiceClient;
import io.milvus.param.*;
import io.milvus.param.collection.CreateCollectionParam;
import io.milvus.param.collection.DropCollectionParam;
import io.milvus.param.collection.FieldType;
import io.milvus.param.collection.LoadCollectionParam;
import io.milvus.param.index.CreateIndexParam;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import static io.milvus.grpc.DataType.*;

/**
 * Milvus ?꾨쿋????μ냼???앸챸二쇨린瑜?愿由ы븯??而댄룷?뚰듃?낅땲??
 * ???대옒?ㅻ뒗 Milvus 而щ젆?섏쓽 ?앹꽦, ??젣, ?몃뜳?? 濡쒕뵫怨?媛숈? ?묒뾽???섑뻾?섎ŉ,
 * LangChain4j??`EmbeddingStore` ?명꽣?섏씠?ㅼ뿉 吏곸젒 ?몄텧?섏? ?딆? 湲곕뒫???쒓났?⑸땲??
 * `@Component` ?대끂?뚯씠?섏쓣 ?듯빐 Spring 而⑦뀒?대꼫???섑빐 愿由щ릺??鍮덉쑝濡??깅줉?⑸땲??
 * `@Slf4j`??Lombok ?대끂?뚯씠?섏쑝濡? 濡쒓퉭???꾪븳 `log` 媛앹껜瑜??먮룞?쇰줈 ?앹꽦?⑸땲??
 */
@Component
@Slf4j
public class EmbeddingStoreManager {

    // application.properties?먯꽌 Milvus ?몄뒪?몃? 二쇱엯諛쏆뒿?덈떎.
    @Value("${milvus.host}")
    private String milvusHost;

    // application.properties?먯꽌 Milvus ?ы듃瑜?二쇱엯諛쏆뒿?덈떎.
    @Value("${milvus.port}")
    private Integer milvusPort;

    // application.properties?먯꽌 Milvus 而щ젆???대쫫??二쇱엯諛쏆뒿?덈떎.
    @Value("${milvus.collection-name}")
    private String milvusCollectionName;

    // application.properties?먯꽌 Milvus ?꾨쿋??紐⑤뜽??李⑥썝 ?섎? 二쇱엯諛쏆뒿?덈떎.
    @Value("${milvus.embedding.dimension}")
    private Integer embeddingDimension;

    /**
     * Milvus 踰≫꽣 ??μ냼瑜??ъ꽕??reset)?⑸땲??
     * ??硫붿꽌?쒕뒗 ?ㅼ쓬 ?④퀎瑜??섑뻾?⑸땲??
     * 1. Milvus ?대씪?댁뼵?몄뿉 ?곌껐?⑸땲??
     * 2. 湲곗〈 而щ젆?섏씠 ?덈떎硫???젣?⑸땲??
     * 3. LangChain4j??`MilvusEmbeddingStore`媛 湲곕??섎뒗 ?ㅽ궎留덈줈 ?덈줈??而щ젆?섏쓣 ?앹꽦?⑸땲??
     *    - `id`: Primary Key, VarChar ???(UUID ??μ슜)
     *    - `text`: ?먮낯 ?띿뒪?? VarChar ???
     *    - `metadata`: 硫뷀??곗씠?? JSON ???
     *    - `vector`: ?꾨쿋??踰≫꽣, FloatVector ???(李⑥썝? `embeddingDimension` ?ъ슜)
     * 4. `vector` ?꾨뱶???몃뜳?ㅻ? ?앹꽦?섏뿬 ?⑥쑉?곸씤 踰≫꽣 寃?됱쓣 媛?ν븯寃??⑸땲??
     * 5. 而щ젆?섏쓣 濡쒕뱶?섏뿬 荑쇰━ 以鍮꾨? 留덉묩?덈떎.
     * 6. Milvus ?대씪?댁뼵???곌껐???レ뒿?덈떎.
     *
     * @throws RuntimeException Milvus ?묒뾽 以??덇린移??딆? ?ㅻ쪟媛 諛쒖깮??寃쎌슦
     */
    public void reset() {
        log.info("Milvus 而щ젆???ъ꽕???쒕룄: '{}'", milvusCollectionName);

        try {
            // Milvus ?쒕퉬???대씪?댁뼵?몄뿉 ?곌껐?⑸땲??
            MilvusServiceClient milvusClient = new MilvusServiceClient(
                    ConnectParam.newBuilder()
                            .withHost(milvusHost)
                            .withPort(milvusPort)
                            .build()
            );
            log.debug("Milvus???곌껐?? {}:{}", milvusHost, milvusPort);

            // 湲곗〈 而щ젆?섏쓣 ??젣?⑸땲?? (而щ젆?섏씠 ?놁뼱???ㅻ쪟 諛쒖깮?섏? ?딆쓬)
            DropCollectionParam dropReq = DropCollectionParam.newBuilder()
                    .withCollectionName(milvusCollectionName)
                    .build();
            milvusClient.dropCollection(dropReq);
            log.info("湲곗〈 Milvus 而щ젆??'{}' ??젣 ?꾨즺 (議댁옱?덈떎硫?.", milvusCollectionName);

            // ?덈줈??而щ젆?섏쓣 ?앹꽦?⑸땲??
            CreateCollectionParam collectionParam = CreateCollectionParam.newBuilder()
                    .withCollectionName(milvusCollectionName)
                    // 'id' ?꾨뱶: 怨좎쑀 ?앸퀎?? VarChar ??? Primary Key
                    .addFieldType(FieldType.newBuilder()
                            .withName("id")
                            .withDataType(VarChar)
                            .withMaxLength(36) // UUID 臾몄옄??湲몄씠??留욎땄
                            .withPrimaryKey(true)
                            .withAutoID(false)
                            .build())
                    // 'text' ?꾨뱶: ?먮낯 ?띿뒪?? VarChar ???
                    .addFieldType(FieldType.newBuilder()
                            .withName("text")
                            .withDataType(VarChar)
                            .withMaxLength(65535) // 湲??띿뒪????μ쓣 ?꾪빐 理쒕? 湲몄씠 ?ㅼ젙
                            .build())
                    // 'metadata' ?꾨뱶: 異붽? 硫뷀??곗씠?? JSON ???
                    .addFieldType(FieldType.newBuilder()
                            .withName("metadata")
                            .withDataType(JSON)
                            .build())
                    // 'vector' ?꾨뱶: ?꾨쿋??踰≫꽣, FloatVector ??? 李⑥썝 ?ㅼ젙
                    .addFieldType(FieldType.newBuilder()
                            .withName("vector")
                            .withDataType(FloatVector)
                            .withDimension(embeddingDimension) // 二쇱엯諛쏆? 媛??ъ슜
                            .build())
                    .build();

            milvusClient.createCollection(collectionParam);
            log.info("?덈줈??Milvus 而щ젆??'{}' ?앹꽦 ?꾨즺.", milvusCollectionName);

            // 'vector' ?꾨뱶???몃뜳?ㅻ? ?앹꽦?⑸땲?? (COSINE ?좎궗??痢≪젙, FLAT ?몃뜳?????
            CreateIndexParam indexParam = CreateIndexParam.newBuilder()
                    .withCollectionName(milvusCollectionName)
                    .withFieldName("vector")
                    .withIndexType(IndexType.FLAT) // 媛꾨떒??FLAT ?몃뜳??(?洹쒕え ?곗씠?곗뀑?먯꽌??IVF_FLAT ??怨좊젮)
                    .withMetricType(MetricType.COSINE) // 肄붿궗???좎궗??痢≪젙
                    .build();

            milvusClient.createIndex(indexParam);
            log.info("Milvus 而щ젆??'{}'???몃뜳???앹꽦 ?꾨즺.", milvusCollectionName);

            // 而щ젆?섏쓣 濡쒕뱶?섏뿬 荑쇰━ 以鍮꾨? 留덉묩?덈떎.
            LoadCollectionParam request = LoadCollectionParam.newBuilder()
                    .withCollectionName(milvusCollectionName)
                    .build();
            milvusClient.loadCollection(request);
            log.info("Milvus 而щ젆??'{}' 濡쒕뱶 ?꾨즺.", milvusCollectionName);

            // Milvus ?대씪?댁뼵???곌껐???レ뒿?덈떎.
            milvusClient.close();

            log.info("Milvus 而щ젆??'{}' ?ъ꽕???꾨줈?몄뒪 ?깃났?곸쑝濡??꾨즺.", milvusCollectionName);

        } catch (Exception e) {
            log.error("Milvus 而щ젆??'{}' ?ъ꽕??以??덇린移??딆? ?ㅻ쪟 諛쒖깮: {}", milvusCollectionName, e.getMessage(), e);
            throw new RuntimeException("Milvus 而щ젆???ъ꽕???ㅽ뙣: " + milvusCollectionName, e);
        }
    }
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\langchain\embaddings\SentenceTextSplitterStrategy.java
---
package com.codehows.taelimbe.langchain.embaddings;

import lombok.RequiredArgsConstructor;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import java.util.ArrayList;
import java.util.List;
import java.util.StringTokenizer;

/**
 * ?띿뒪?몃? 臾몄옣 ?⑥쐞濡?遺꾪븷?섍퀬, 媛??멸렇癒쇳듃媛 理쒕? ?좏겙 ?섎? ?섏? ?딅룄濡?議곗젙?섎뒗 ?꾨왂 援ы쁽泥댁엯?덈떎.
 * ??援ы쁽泥대뒗 媛꾨떒??臾몄옣 遺꾪븷 洹쒖튃怨?`StringTokenizer`瑜??ъ슜????듭쟻???좏겙 怨꾩궛??湲곕컲?쇰줈 ?⑸땲??
 */
@Component
@RequiredArgsConstructor
public class SentenceTextSplitterStrategy implements TextSplitterStrategy {

    @Value("${maxTokensPerSegment}")
    private int maxTokensPerSegment=250;

    /**
     * 二쇱뼱吏??띿뒪?몃? 臾몄옣 ?⑥쐞濡?遺꾪븷?섍퀬, 媛??멸렇癒쇳듃媛 理쒕? ?좏겙 ?섎? ?섏? ?딅룄濡?議곗젙?⑸땲??
     *
     * @param text 遺꾪븷???먮낯 ?띿뒪??
     * @return 遺꾪븷???띿뒪???멸렇癒쇳듃?ㅼ쓽 由ъ뒪??
     */
    @Override
    public List<String> split(String text) {
        List<String> segments = new ArrayList<>();

        // ???臾몄옣 ?⑥쐞濡?遺꾪븷 ('.', '?' ??湲곗?). ?ㅼ젣 ?꾨줈?뺤뀡 ?섍꼍?먯꽌?????뺢탳??臾몄옣 遺꾨━湲곕? ?ъ슜?섎뒗 寃껋씠 醫뗭뒿?덈떎.
        String[] sentences = text.split("(?<=[.!?])\\s+");

        StringBuilder currentSegment = new StringBuilder();
        int currentTokenCount = 0;

        for (String sentence : sentences) {
            int sentenceTokenCount = countTokens(sentence);

            // ?꾩옱 ?멸렇癒쇳듃??臾몄옣??異붽??덉쓣 ??理쒕? ?좏겙 ?섎? 珥덇낵?섎뒗 寃쎌슦
            if (currentTokenCount + sentenceTokenCount > maxTokensPerSegment) {
                if (!currentSegment.isEmpty()) {
                    // ?꾩옱源뚯????멸렇癒쇳듃瑜?由ъ뒪?몄뿉 異붽??섍퀬 珥덇린?뷀빀?덈떎.
                    segments.add(currentSegment.toString().trim());
                    currentSegment.setLength(0);
                    currentTokenCount = 0;
                }
            }

            // 臾몄옣???꾩옱 ?멸렇癒쇳듃??異붽??섍퀬 ?좏겙 ?섎? ?낅뜲?댄듃?⑸땲??
            currentSegment.append(sentence).append(" ");
            currentTokenCount += sentenceTokenCount;
        }

        // 猷⑦봽 醫낅즺 ??留덉?留??멸렇癒쇳듃媛 ?⑥븘?덈떎硫?由ъ뒪?몄뿉 異붽??⑸땲??
        if (!currentSegment.isEmpty()) {
            segments.add(currentSegment.toString().trim());
        }

        return segments;
    }

    /**
     * 二쇱뼱吏??띿뒪?몄쓽 ?좏겙 ?섎? ??듭쟻?쇰줈 異붿젙?⑸땲??
     * ?ш린?쒕뒗 怨듬갚??湲곗??쇰줈 ?⑥뼱 ?섎? ?몃뒗 諛⑹떇?쇰줈 援ы쁽?섏뿀?듬땲??
     * ?ㅼ젣 LLM???좏겙??諛⑹떇怨쇰뒗 ?ㅻ? ???덉쑝誘濡? ?뺥솗???좏겙 怨꾩궛???꾩슂?섎떎硫?
     * ?대떦 LLM???좏겙???쇱씠釉뚮윭由щ? ?ъ슜?섎뒗 寃껋씠 醫뗭뒿?덈떎.
     *
     * @param text ?좏겙 ?섎? 異붿젙???띿뒪??
     * @return ?띿뒪?몄쓽 ??듭쟻???좏겙 ??
     */
    private int countTokens(String text) {
        StringTokenizer tokenizer = new StringTokenizer(text);
        return tokenizer.countTokens();
    }
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\langchain\embaddings\TextSplitterStrategy.java
---
package com.codehows.taelimbe.langchain.embaddings;

import java.util.List;

/**
 * ?띿뒪?몃? ?묒? ?멸렇癒쇳듃(議곌컖)濡?遺꾪븷?섎뒗 ?꾨왂???뺤쓽?섎뒗 ?명꽣?섏씠?ㅼ엯?덈떎.
 * ???명꽣?섏씠?ㅻ? 援ы쁽?섏뿬 ?ㅼ뼇???띿뒪??遺꾪븷 諛⑹떇???쒓났?????덉뒿?덈떎.
 * ?덈? ?ㅼ뼱, 臾몄옣 ?⑥쐞 遺꾪븷, ?좏겙 ??湲곕컲 遺꾪븷 ?깆씠 ?덉뒿?덈떎.
 */
public interface TextSplitterStrategy {

    /**
     * 二쇱뼱吏??띿뒪?몃? ?뺤쓽???꾨왂???곕씪 ?щ윭 媛쒖쓽 ?띿뒪???멸렇癒쇳듃濡?遺꾪븷?⑸땲??
     *
     * @param text 遺꾪븷???먮낯 ?띿뒪??
     * @return 遺꾪븷???띿뒪???멸렇癒쇳듃?ㅼ쓽 由ъ뒪??
     */
    List<String> split(String text);
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\langchain\models\GeminiEmbeddingModel.java
---
package com.codehows.taelimbe.langchain.models;

import com.google.genai.Client;
import com.google.genai.types.EmbedContentConfig;
import com.google.genai.types.EmbedContentResponse;
import dev.langchain4j.data.embedding.Embedding;
import dev.langchain4j.data.segment.TextSegment;
import dev.langchain4j.model.embedding.EmbeddingModel;
import dev.langchain4j.model.output.Response;
import lombok.RequiredArgsConstructor;

import java.util.Collections;
import java.util.List;
import java.util.stream.Collectors;

/**
 * LangChain4j??`EmbeddingModel` ?명꽣?섏씠?ㅻ? `com.google.genai` ?대씪?댁뼵?몃? ?ъ슜?섏뿬 援ы쁽??而ㅼ뒪? ?대옒?ㅼ엯?덈떎.
 * ???대옒?ㅻ뒗 LangChain4j ?꾨젅?꾩썙?ш? Google???쒕꽕由?Gemini ?대씪?댁뼵?몃? ?듯빐 ?꾨쿋?⑹쓣 ?앹꽦?????덈룄濡??섎뒗 ?대뙌????븷???⑸땲??
 * `@RequiredArgsConstructor`??Lombok ?대끂?뚯씠?섏쑝濡? final ?꾨뱶??????앹꽦?먮? ?먮룞?쇰줈 ?앹꽦?섏뿬 ?섏〈??二쇱엯???⑹씠?섍쾶 ?⑸땲??
 */
@RequiredArgsConstructor
public class GeminiEmbeddingModel implements EmbeddingModel {

    // Google Gemini API ?대씪?댁뼵??二쇱엯
    private final Client geminiClient;
    // ?ъ슜??Gemini ?꾨쿋??紐⑤뜽???대쫫
    private final String modelName;

    /**
     * ?⑥씪 ?띿뒪???멸렇癒쇳듃瑜??꾨쿋?⑺빀?덈떎.
     * ??硫붿꽌?쒕뒗 ?대??곸쑝濡?`embedAll` 硫붿꽌?쒕? ?몄텧?섏뿬 ?⑥씪 ??ぉ 由ъ뒪?몃? 泥섎━?⑸땲??
     *
     * @param textSegment ?꾨쿋?⑺븷 ?띿뒪???멸렇癒쇳듃
     * @return ?꾨쿋??寃곌낵瑜??ы븿?섎뒗 `Response` 媛앹껜
     */
    @Override
    public Response<Embedding> embed(TextSegment textSegment) {
        // `embedAll`???ъ슜?섏뿬 ?⑥씪 ?멸렇癒쇳듃瑜??꾨쿋?⑺븯怨? 寃곌낵 由ъ뒪?몄쓽 泥?踰덉㎏ ?꾨쿋?⑹쓣 諛섑솚?⑸땲??
        return Response.from(embedAll(Collections.singletonList(textSegment)).content().getFirst());
    }

    /**
     * ?щ윭 ?띿뒪???멸렇癒쇳듃瑜???踰덉뿉 ?꾨쿋?⑺빀?덈떎.
     * `com.google.genai` ?쇱씠釉뚮윭由щ뒗 ?꾩옱 諛곗튂 ?꾨쿋?⑹쓣 吏곸젒 吏?먰븯吏 ?딆쑝誘濡?
     * 媛??띿뒪?몃? ?쒖감?곸쑝濡??꾨쿋???붿껌??蹂대깄?덈떎.
     *
     * @param textSegments ?꾨쿋?⑺븷 ?띿뒪???멸렇癒쇳듃 由ъ뒪??
     * @return ?꾨쿋??寃곌낵 由ъ뒪?몃? ?ы븿?섎뒗 `Response` 媛앹껜
     * @throws RuntimeException ?꾨쿋???앹꽦 以??ㅻ쪟 諛쒖깮 ??
     */
    @Override
    public Response<List<Embedding>> embedAll(List<TextSegment> textSegments) {
        // ?띿뒪???멸렇癒쇳듃 由ъ뒪?몄뿉???띿뒪?몃쭔 異붿텧?⑸땲??
        List<String> texts = textSegments.stream()
                .map(TextSegment::text)
                .toList();

        // 媛??띿뒪?몄뿉 ???Gemini API瑜??몄텧?섏뿬 ?꾨쿋?⑹쓣 ?앹꽦?⑸땲??
        List<Embedding> embeddings = texts.stream()
                .map(text -> {
                    try {
                        // `geminiClient.models.embedContent`瑜??몄텧?섏뿬 ?꾨쿋?⑹쓣 ?붿껌?⑸땲??
                        EmbedContentResponse response = geminiClient.models.embedContent(modelName, text, EmbedContentConfig.builder().build());
                        // Gemini ?묐떟??LangChain4j??`Embedding` 媛앹껜濡?蹂?섑빀?덈떎.
                        return toLangChainEmbedding(response);
                    } catch (Exception e) {
                        // ?꾨쿋???ㅽ뙣 ???고????덉쇅瑜?諛쒖깮?쒗궢?덈떎.
                        throw new RuntimeException("Failed to embed text: " + text, e);
                    }
                })
                .collect(Collectors.toList());

        return Response.from(embeddings);
    }

    /**
     * `com.google.genai`??`EmbedContentResponse`瑜?LangChain4j??`Embedding` 媛앹껜濡?蹂?섑빀?덈떎.
     *
     * @param response `com.google.genai` ?대씪?댁뼵?몃줈遺??諛쏆? ?꾨쿋???묐떟
     * @return LangChain4j??`Embedding` 媛앹껜
     * @throws RuntimeException ?묐떟???꾨쿋?⑹씠 ?녾굅???좏슚?섏? ?딆? 寃쎌슦 諛쒖깮
     */
    private Embedding toLangChainEmbedding(EmbedContentResponse response) {
        // ?묐떟?먯꽌 ?꾨쿋??踰≫꽣 媛믪쓣 異붿텧?⑸땲??
        List<Float> embeddingValues = response.embeddings().orElse(Collections.emptyList()).stream()
                .findFirst() // 泥?踰덉㎏ ?꾨쿋?⑹쓣 媛?몄샃?덈떎.
                .orElseThrow(() -> new RuntimeException("No embedding found in response")) // ?꾨쿋?⑹씠 ?놁쑝硫??덉쇅 諛쒖깮
                .values().orElse(Collections.emptyList()); // 踰≫꽣 媛?由ъ뒪?몃? 媛?몄샃?덈떎.
        
        // List<Float>瑜?float[] 諛곗뿴濡?蹂?섑빀?덈떎.
        float[] floatArray = new float[embeddingValues.size()];
        for (int i = 0; i < embeddingValues.size(); i++) {
            floatArray[i] = embeddingValues.get(i);
        }
        // float[] 諛곗뿴濡?LangChain4j??`Embedding` 媛앹껜瑜??앹꽦?섏뿬 諛섑솚?⑸땲??
        return Embedding.from(floatArray);
    }
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\langchain\models\GeminiStreamingChatModel.java
---
package com.codehows.taelimbe.langchain.models;

import com.codehows.taelimbe.langchain.converters.MessageConverter;
import com.codehows.taelimbe.langchain.converters.ToolConverter;
import com.google.genai.Client;
import com.google.genai.types.*;
import com.google.gson.Gson;
import dev.langchain4j.agent.tool.ToolExecutionRequest;
import dev.langchain4j.agent.tool.ToolSpecification;
import dev.langchain4j.data.message.AiMessage;
import dev.langchain4j.data.message.ChatMessage;
import dev.langchain4j.model.StreamingResponseHandler;
import dev.langchain4j.model.chat.StreamingChatLanguageModel;
import dev.langchain4j.model.output.Response;
import lombok.Builder;
import lombok.RequiredArgsConstructor;

import java.util.Collections;
import java.util.List;
import java.util.concurrent.atomic.AtomicReference;

/**
 * LangChain4j??`StreamingChatLanguageModel` ?명꽣?섏씠?ㅻ? `com.google.genai` ?대씪?댁뼵?몃? ?ъ슜?섏뿬 援ы쁽??而ㅼ뒪? ?대옒?ㅼ엯?덈떎.
 * ???대옒?ㅻ뒗 LangChain4j ?꾨젅?꾩썙?ш? Google???쒕꽕由?Gemini ?대씪?댁뼵?몃? ?듯빐 ?ㅽ듃由щ컢 梨꾪똿 諛??⑥닔 ?몄텧???섑뻾?????덈룄濡??섎뒗 ?대뙌????븷???⑸땲??
 * `@RequiredArgsConstructor`??Lombok ?대끂?뚯씠?섏쑝濡? final ?꾨뱶??????앹꽦?먮? ?먮룞?쇰줈 ?앹꽦?섏뿬 ?섏〈??二쇱엯???⑹씠?섍쾶 ?⑸땲??
 * `@Builder`??Lombok ?대끂?뚯씠?섏쑝濡? 鍮뚮뜑 ?⑦꽩???ъ슜?섏뿬 媛앹껜瑜??앹꽦?????덈룄濡??⑸땲??
 */
@RequiredArgsConstructor
@Builder
public class GeminiStreamingChatModel implements StreamingChatLanguageModel {

    // Google Gemini API ?대씪?댁뼵??二쇱엯
    private final Client geminiClient;
    // ?ъ슜??Gemini 梨꾪똿 紐⑤뜽???대쫫
    private final String modelName;
    // JSON 吏곷젹????쭅?ы솕瑜??꾪븳 GSON ?몄뒪?댁뒪
    private final Gson gson = new Gson();

    /**
     * LangChain4j 硫붿떆吏 由ъ뒪?몄? ?꾧뎄 ?ㅽ럺??諛쏆븘 ?ㅽ듃由щ컢 諛⑹떇?쇰줈 ?묐떟???앹꽦?⑸땲??
     * ??硫붿꽌?쒕뒗 Gemini API??`generateContentStream`???몄텧?섏뿬 ?ㅼ떆媛꾩쑝濡??묐떟??泥섎━?⑸땲??
     *
     * @param messages LangChain4j??`ChatMessage` 由ъ뒪??(???湲곕줉)
     * @param toolSpecifications LangChain4j??`ToolSpecification` 由ъ뒪??(AI媛 ?ъ슜?????덈뒗 ?꾧뎄 紐낆꽭)
     * @param handler ?ㅽ듃由щ컢 ?묐떟??泥섎━??`StreamingResponseHandler<AiMessage>`
     */
    @Override
    public void generate(List<ChatMessage> messages, List<ToolSpecification> toolSpecifications, StreamingResponseHandler<AiMessage> handler) {
        List<Content> googleAiMessages = MessageConverter.toGoogleAiMessages(messages);
        List<Tool> googleAiTools = ToolConverter.toGoogleAiTools(toolSpecifications);

        GenerateContentConfig config = GenerateContentConfig.builder()
                .tools(googleAiTools)
                .build();

        AtomicReference<StringBuilder> contentBuilder = new AtomicReference<>(new StringBuilder());
        AtomicReference<ToolExecutionRequest> toolExecutionRequestRef = new AtomicReference<>(null);

        System.out.println("=====[Agent Calling]=====");
        geminiClient.models.generateContentStream(modelName, googleAiMessages, config)
        .forEach(response -> {
            if (response.candidates().isPresent()) {
                Candidate candidate = response.candidates().orElse(Collections.emptyList()).getFirst();
                candidate.content().flatMap(Content::parts).orElse(Collections.emptyList()).forEach(part -> {
                try {
                    if (part.text().isPresent()) {
                        String token = part.text().get();
                        System.out.println(token);
                        contentBuilder.get().append(token);
                        handler.onNext(token);
                    } else if (part.functionCall().isPresent()) {
                        FunctionCall functionCall = part.functionCall().get();
                        if (functionCall.name().isPresent() && functionCall.args().isPresent()) {
                            System.out.println("=====[Tool Calling]=====");
                            System.out.println("=====[Tool Name: " + functionCall.name().get() + "]=====");
                            System.out.println("=====[Tool Args: " + functionCall.args().get() + "]=====");
                            String rawArgs = gson.toJson(functionCall.args().orElse(Collections.emptyMap()));
                            ToolExecutionRequest toolExecutionRequest = ToolExecutionRequest.builder()
                                    .name(functionCall.name().orElse(""))
                                    .arguments(rawArgs)
                                    .build();
                            toolExecutionRequestRef.set(toolExecutionRequest);
                        }
                    }
                } catch (Exception e) {
                    System.err.println("Exception while processing streaming content: " + e.getMessage());
                }
                });
            }
        });
        // ?ㅽ듃由щ컢 ?꾨즺 ???묐떟 泥섎━
        if (toolExecutionRequestRef.get() != null) {
            handler.onComplete(Response.from(AiMessage.from(toolExecutionRequestRef.get())));
        } else {
            handler.onComplete(Response.from(AiMessage.from(contentBuilder.get().toString())));
        }
    }

    /**
     * LangChain4j 硫붿떆吏 由ъ뒪?몃? 諛쏆븘 ?ㅽ듃由щ컢 諛⑹떇?쇰줈 ?묐떟???앹꽦?⑸땲??
     * ??硫붿꽌?쒕뒗 ?꾧뎄 ?ъ슜???녿뒗 寃쎌슦???몄텧?⑸땲??
     * ?대??곸쑝濡?`toolSpecifications`媛 鍮?由ъ뒪?몄씤 `generate` 硫붿꽌?쒕? ?몄텧?⑸땲??
     *
     * @param messages LangChain4j??`ChatMessage` 由ъ뒪??
     * @param handler ?ㅽ듃由щ컢 ?묐떟??泥섎━???몃뱾??
     */
    @Override
    public void generate(List<ChatMessage> messages, StreamingResponseHandler<AiMessage> handler) {
        // ?꾧뎄 紐낆꽭媛 ?녿뒗 寃쎌슦, 鍮?由ъ뒪?몃? ?꾨떖?섏뿬 湲곗〈 `generate` 硫붿꽌?쒕? ?몄텧?⑸땲??
        generate(messages, Collections.emptyList(), handler);
    }
}
---
C:\tealim-be\src\main\java\com\codehows\taelimbe\langchain\tools\ChatTools.java
---
package com.codehows.taelimbe.langchain.tools;

import com.google.gson.Gson;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Component;

@Component
@RequiredArgsConstructor
public class ChatTools {
    private final Gson gson;
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\langchain\tools\ReportTools.java
---
package com.codehows.taelimbe.langchain.tools;

import com.codehows.taelimbe.config.UserContextHolder;
import com.codehows.taelimbe.dto.CleaningDataDTO;
import com.codehows.taelimbe.service.CleaningDataService;
import com.google.gson.*;
import dev.langchain4j.agent.tool.Tool;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Component;

import java.util.List;

/**
 * AI ?먯씠?꾪듃媛 ?ъ슜?????덈뒗 而ㅼ뒪? ?꾧뎄?ㅼ쓣 ?뺤쓽?섎뒗 ?대옒?ㅼ엯?덈떎.
 * `@Component` ?대끂?뚯씠?섏쓣 ?듯빐 Spring 而⑦뀒?대꼫???섑빐 愿由щ릺??鍮덉쑝濡??깅줉?⑸땲??
 * `@RequiredArgsConstructor`??Lombok ?대끂?뚯씠?섏쑝濡? final ?꾨뱶??????앹꽦?먮? ?먮룞?쇰줈 ?앹꽦?섏뿬 ?섏〈??二쇱엯???⑹씠?섍쾶 ?⑸땲??
 */
@Component
@RequiredArgsConstructor
public class ReportTools {

    // CleaningDataService瑜?二쇱엯諛쏆븘 泥?냼 蹂닿퀬??愿??鍮꾩쫰?덉뒪 濡쒖쭅???섑뻾?⑸땲??
    private final CleaningDataService cleaningDataService;
    // LangChainConfig?먯꽌 鍮덉쑝濡??깅줉??Gson ?몄뒪?댁뒪瑜?二쇱엯諛쏆뒿?덈떎.
    private final Gson gson;

    /**
     * 吏?뺣맂 ?좎쭨 踰붿쐞 ?댁쓽 泥?냼 ?곗씠?곕? ?섏씠吏뺥븯??議고쉶?섍퀬 ?붿빟 蹂닿퀬?쒕? ?앹꽦?⑸땲??
     * ??硫붿꽌?쒕뒗 AI ?먯씠?꾪듃???섑빐 '?좎쭨蹂?泥?냼 蹂닿퀬??議고쉶'? 媛숈? ?먯뿰???붿껌???덉쓣 ???몄텧?????덉뒿?덈떎.
     *
     * `@Tool` ?대끂?뚯씠?섏? ??硫붿꽌?쒓? AI ?먯씠?꾪듃媛 ?몄텧?????덈뒗 ?꾧뎄?꾩쓣 LangChain4j???뚮┰?덈떎.
     * ?대끂?뚯씠?섏쓽 媛믪? ?꾧뎄???ㅻ챸???쒓났?섎ŉ, ?대뒗 AI 紐⑤뜽???꾧뎄瑜??몄젣, ?대뼸寃??ъ슜?댁빞 ?좎? 寃곗젙?섎뒗 ???꾩???以띾땲??
     *
     * @param startDate 議고쉶 ?쒖옉 ?좎쭨 (YYYY-MM-DD ?뺤떇)
     * @param endDate   議고쉶 醫낅즺 ?좎쭨 (YYYY-MM-DD ?뺤떇)
     * @return ?섏씠吏뺣맂 泥?냼 ?곗씠???붿빟 蹂닿퀬??臾몄옄??(JSON ?뺤떇)
     */
    @Tool("吏?뺣맂 湲곌컙 ?숈븞??泥?냼 ?곗씠?곕? ?섏씠吏뺥븯??媛?몄샃?덈떎.")
    public String getCleaningReport(String startDate, String endDate) {
        // TODO: 異뷀썑 ?꾪뙆??Security Context ?먯꽌 ?좎? ?뺣낫 異붿텧
        //  ?ㅼ젣 ?좎? ?꾩씠?붾줈 ?몄텧 媛?ν븳 踰붿쐞 ?ㅼ젙 濡쒖쭅 異붽?
        // String username = SecurityContextHolder.getContext().getAuthentication().getName();
        String currentUser = UserContextHolder.getUserName(); // ?꾩옱 ?ъ슜???대쫫??媛?몄샃?덈떎??
        System.out.println("Current user: " + currentUser); // ?ъ슜???대쫫??肄섏넄??異쒕젰 (?붾쾭源낆슜)

        // CleaningDataService瑜??듯빐 吏?뺣맂 湲곌컙???섏씠吏뺣맂 泥?냼 ?곗씠?곕? 議고쉶?⑸땲??
        List<CleaningDataDTO> reportData = cleaningDataService.getCleaningReport(startDate, endDate);
        
        // 議고쉶??泥?냼 ?곗씠???섏씠吏瑜?JSON 臾몄옄?대줈 蹂?섑븯??諛섑솚?⑸땲?ㅳ?
        // ??JSON?먮뒗 ?곗씠??紐⑸줉肉먮쭔 ?꾨땲??珥??섏씠吏 ?? ?꾩껜 ??ぉ ???깆쓽 ?섏씠吏??뺣낫媛 ?ы븿?⑸땲??
        return gson.toJson(reportData);
    }
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\repository\CleaningDataRepository.java
---
package com.codehows.taelimbe.repository;

import com.codehows.taelimbe.entity.CleaningData;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.time.LocalDateTime;
import java.util.List;

/**
 * `CleaningData` ?뷀떚?곗뿉 ????곗씠?곕쿋?댁뒪 ?묎렐??泥섎━?섎뒗 JPA 由ы룷吏?좊━ ?명꽣?섏씠?ㅼ엯?덈떎.
 * `@Repository` ?대끂?뚯씠?섏? ???명꽣?섏씠?ㅺ? ?곗씠???묎렐 怨꾩링??而댄룷?뚰듃?꾩쓣 ?섑??낅땲??
 * `JpaRepository<CleaningData, Long>`???곸냽諛쏆븘 `CleaningData` ?뷀떚??湲곕낯 ????낆? `Long`)?????
 * 湲곕낯?곸씤 CRUD(Create, Read, Update, Delete) 諛??섏씠吏? ?뺣젹 湲곕뒫???먮룞?쇰줈 ?쒓났諛쏆뒿?덈떎.
 */
@Repository
public interface CleaningDataRepository extends JpaRepository<CleaningData, Long> {

    /**
     * ?뱀젙 ?쒖옉 ?쒓컙怨?醫낅즺 ?쒓컙 踰붿쐞 ?댁뿉 ?덈뒗 泥?냼 ?곗씠?곕? ?섏씠吏뺥븯??議고쉶?⑸땲??
     * Spring Data JPA??荑쇰━ 硫붿꽌??湲곕뒫???쒖슜?섏뿬 硫붿꽌???대쫫留뚯쑝濡?荑쇰━媛 ?먮룞?쇰줈 ?앹꽦?⑸땲??
     *
     * @param start 議고쉶 ?쒖옉 `LocalDateTime`
     * @param end 議고쉶 醫낅즺 `LocalDateTime`
     * @return ?대떦 ?쒓컙 踰붿쐞 ?댁쓽 `CleaningData` ?뷀떚???섏씠吏
     */
    List<CleaningData> findByStartTimeBetween(LocalDateTime start, LocalDateTime end);
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\repository\StoreRepository.java
---
//package com.codehows.taelimbe.repository;
//
//import com.codehows.taelimbe.entity.Store;
//import org.springframework.data.jpa.repository.JpaRepository;
//
//public interface StoreRepository extends JpaRepository<Store, Long> {
//}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\repository\UserRepository.java
---
//package com.codehows.taelimbe.repository;
//
//import com.codehows.taelimbe.entity.User;
//import org.springframework.data.jpa.repository.JpaRepository;
//
//public interface UserRepository extends JpaRepository<User, Long> {
//}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\service\AgentService.java
---
package com.codehows.taelimbe.service;

import com.codehows.taelimbe.config.UserContextHolder;
import com.codehows.taelimbe.dto.ChatPromptRequest;
import com.codehows.taelimbe.langchain.Agent;
import dev.langchain4j.model.input.Prompt;
import dev.langchain4j.model.input.PromptTemplate;
import dev.langchain4j.service.TokenStream;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.core.task.TaskExecutor;
import org.springframework.scheduling.annotation.Async;
import org.springframework.stereotype.Service;
import org.springframework.web.servlet.mvc.method.annotation.SseEmitter;

import java.io.IOException;
import java.util.Map;
import java.util.UUID;

/**
 * AI ?먯씠?꾪듃??????濡쒖쭅??罹≪뒓?뷀븯???쒕퉬???대옒?ㅼ엯?덈떎.
 * `AgentController`??蹂듭옟?깆쓣 以꾩씠怨? ???泥섎━? 愿?⑤맂 紐⑤뱺 濡쒖쭅???닿납?먯꽌 愿由ы빀?덈떎.
 * `@Service` ?대끂?뚯씠?섏? ???대옒?ㅺ? 鍮꾩쫰?덉뒪 怨꾩링??而댄룷?뚰듃?꾩쓣 ?섑??낅땲??
 * `@RequiredArgsConstructor`??Lombok ?대끂?뚯씠?섏쑝濡? final ?꾨뱶??????앹꽦?먮? ?먮룞?쇰줈 ?앹꽦?섏뿬 ?섏〈??二쇱엯???⑹씠?섍쾶 ?⑸땲??
 * `@Slf4j`??Lombok ?대끂?뚯씠?섏쑝濡? 濡쒓퉭???꾪븳 `log` 媛앹껜瑜??먮룞?쇰줈 ?앹꽦?⑸땲??
 */
@Service
@RequiredArgsConstructor
@Slf4j
public class AgentService {

    // LangChain4j Agent ?명꽣?섏씠?ㅼ쓽 援ы쁽泥대? 二쇱엯諛쏆뒿?덈떎.
    @Qualifier("reportAgent")
    private final Agent reportAgent;

    @Qualifier("chatAgent")
    private final Agent chatAgent;

    // 鍮꾨룞湲??묒뾽???꾪븳 ?ㅻ젅?????二쇱엯諛쏆뒿?덈떎.
    @Qualifier("taskExecutor")
    private final TaskExecutor taskExecutor;

    /**
     * ?ъ슜?먯쓽 硫붿떆吏瑜?諛쏆븘 AI? ??뷀븯怨? ?묐떟???ㅽ듃由щ컢?쇰줈 ?대씪?댁뼵?몄뿉寃??꾩넚?⑸땲??
     * ??硫붿꽌?쒕뒗 `SseEmitter`瑜??ъ슜?섏뿬 Server-Sent Events (SSE) 諛⑹떇?쇰줈 ?ㅼ떆媛??묐떟??泥섎━?⑸땲??
     *
     * @param req ?ъ슜??硫붿떆吏? ???ID瑜??ы븿?섎뒗 ?붿껌 DTO
     * @return `SseEmitter` 媛앹껜. ?대씪?댁뼵?몄뿉寃??대깽?몃? ?ㅽ듃由щ컢?섎뒗 ???ъ슜?⑸땲??
     */
    public SseEmitter chat(ChatPromptRequest req, String username) {
        SseEmitter emitter = new SseEmitter(Long.MAX_VALUE);
        // ?꾩옱 ?ㅻ젅?쒖뿉 ?ъ슜???대쫫???ㅼ젙?섏뿬, ?꾧뎄 ?몄텧 ?깆뿉???ъ슜??而⑦뀓?ㅽ듃瑜??쒖슜?????덈룄濡??⑸땲??
        UserContextHolder.setUserName(username);
        // ???ID媛 ?붿껌???ы븿?섏뼱 ?덉? ?딅떎硫??덈줈??ID瑜??앹꽦?⑸땲??
        String convId = (req.getConversationId() == null || req.getConversationId().isBlank())
                ? UUID.randomUUID().toString()
                : req.getConversationId();
        createEmitter(emitter, convId, chatAgent, req.getMessage());
        return emitter;
    }

    public SseEmitter report(ChatPromptRequest req, String username) {
        SseEmitter emitter = new SseEmitter(Long.MAX_VALUE);
        // ?꾩옱 ?ㅻ젅?쒖뿉 ?ъ슜???대쫫???ㅼ젙?섏뿬, ?꾧뎄 ?몄텧 ?깆뿉???ъ슜??而⑦뀓?ㅽ듃瑜??쒖슜?????덈룄濡??⑸땲??
        UserContextHolder.setUserName(username);
        // ???ID媛 ?붿껌???ы븿?섏뼱 ?덉? ?딅떎硫??덈줈??ID瑜??앹꽦?⑸땲??
        String convId = (req.getConversationId() == null || req.getConversationId().isBlank())
                ? UUID.randomUUID().toString()
                : req.getConversationId();
        PromptTemplate template = PromptTemplate.from("""
                  ?쒓났諛쏆? ?곗씠?곗뀑??遺꾩꽍?섏뿬, ?꾩껜 ?붿빟怨??곸꽭 蹂닿퀬?쒕? 紐⑤몢 ?ы븿?섎뒗 留덊겕?ㅼ슫 ?뺤떇??由ы룷?몃? ?앹꽦?섏꽭??\\n\\
                  由ы룷?몃뒗 ?ㅼ쓬 ??ぉ???ы븿?댁빞 ?⑸땲??\\n\\
                  \\n\\
                  # 珥앷큵 ?붿빟\\n\\
                  - ?곗씠?곗쓽 ?듭떖 ?몄궗?댄듃? 寃곕줎 ?붿빟\\n\\
                  \\n\\
                  # ?곸꽭 遺꾩꽍\\n\\
                  - ?뱀뀡蹂??곸꽭 遺꾩꽍\\n\\
                  - ?쒖? 由ъ뒪?? ?꾩슂??洹몃옒??留곹겕 ?ы븿 媛??\n\\
                  \\n\\
                  # 寃곕줎 諛??쒖뼵\\n\\
                  - ?곗씠??湲곕컲??寃곕줎怨??ν썑 議곗튂/異붿쿇 ?ы빆\\n\\
                  \\n\\
                  **李멸퀬**:\\n\\
                  - ??긽 Markdown ?뺤떇 ?ъ슜 (?ㅻ뜑, 由ъ뒪?? ?? 肄붾뱶釉붾줉 ??\\n\\
                  - ?붿빟? 二쇱슂 ?ъ씤?몃? 媛꾧껐?섍쾶\\n\\
                  - ?곸꽭 遺꾩꽍? ??ぉ蹂꾨줈 援ъ껜???댁슜???ы븿\\n\\
                  \\n\\
                  ?댁젣 ?ㅼ쓬??吏덈Ц???듬??댁＜?몄슂.\\n\\
                  {{question}}
                """); // ?ㅼ젙 媛??ъ슜
        Prompt prompt = template.apply(Map.of("question", req.getMessage()));
        createEmitter(emitter, convId, reportAgent, prompt.text());
        return emitter;
    }

    @Async("taskExecutor")
    protected void createEmitter(
            SseEmitter emitter,
            String convId,
            Agent agent,
            String prompt) {
        try {
            // Agent??chat 硫붿꽌?쒕? ?몄텧?섏뿬 Gemini 紐⑤뜽怨??곹샇?묒슜?⑸땲??
            // ?ㅽ듃由щ컢 諛⑹떇?쇰줈 ?묐떟??諛쏆쑝硫? 媛??좏겙???대씪?댁뼵?몄뿉寃??꾩넚?⑸땲??
            TokenStream tokenStream = agent.chat(prompt, convId);
            // 泥??묐떟?쇰줈 ???ID瑜??꾩넚?⑸땲??
            emitter.send(SseEmitter.event().name("conversationId").data(convId));
            // ?ㅽ듃由щ컢 ?묐떟??媛??좏겙??泥섎━?⑸땲??
            tokenStream.onNext(token -> {
                try {
                    // 媛??좏겙??SSE ?대깽?몃줈 ?대씪?댁뼵?몄뿉寃??꾩넚?⑸땲??
                    emitter.send(SseEmitter.event().data(token));
                } catch (IOException e) {
                    // ?좏겙 ?꾩넚 以??ㅻ쪟 諛쒖깮 ??emitter瑜??ㅻ쪟? ?④퍡 ?꾨즺?⑸땲??
                    log.error("SSE ?좏겙 ?꾩넚 以??ㅻ쪟 諛쒖깮: {}", e.getMessage());
                    emitter.completeWithError(e);
                }
            })
            // ?ㅽ듃由щ컢 ?꾨즺 ??emitter瑜??꾨즺?⑸땲??
            .onComplete(response -> emitter.complete())
            // ?ㅽ듃由щ컢 以??ㅻ쪟 諛쒖깮 ??emitter瑜??ㅻ쪟? ?④퍡 ?꾨즺?⑸땲??
            .onError(emitter::completeWithError)
            // ?ㅽ듃由щ컢???쒖옉?⑸땲??
            .start();
        } catch (Exception e) {
            // ?덉쇅 諛쒖깮 ??emitter瑜??ㅻ쪟? ?④퍡 ?꾨즺?⑸땲??
            log.error("梨꾪똿 泥섎━ 以??ㅻ쪟 諛쒖깮: {}", e.getMessage(), e);
        }finally {
            // ?붿껌 泥섎━ ?꾨즺 ???ㅻ젅??濡쒖뺄????λ맂 ?ъ슜???뺣낫瑜??쒓굅?⑸땲??
            UserContextHolder.clear();
            emitter.complete();
        }
    }
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\service\CleaningDataService.java
---
package com.codehows.taelimbe.service;

import com.codehows.taelimbe.dto.CleaningDataDTO;
import com.codehows.taelimbe.repository.CleaningDataRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.LocalTime;
import java.util.List;

/**
 * 泥?냼 ?곗씠??愿??鍮꾩쫰?덉뒪 濡쒖쭅??泥섎━?섎뒗 ?쒕퉬???대옒?ㅼ엯?덈떎.
 * `@Service` ?대끂?뚯씠?섏? ???대옒?ㅺ? 鍮꾩쫰?덉뒪 怨꾩링??而댄룷?뚰듃?꾩쓣 ?섑??대ŉ,
 * Spring 而⑦뀒?대꼫???섑빐 愿由щ릺??鍮덉쑝濡??깅줉?⑸땲??
 * `@RequiredArgsConstructor`??Lombok ?대끂?뚯씠?섏쑝濡? final ?꾨뱶??????앹꽦?먮? ?먮룞?쇰줈 ?앹꽦?섏뿬 ?섏〈??二쇱엯???⑹씠?섍쾶 ?⑸땲??
 */
@Service
@RequiredArgsConstructor
public class CleaningDataService {
    // 泥?냼 ?곗씠?곗뿉 ????곗씠?곕쿋?댁뒪 ?묎렐???대떦?섎뒗 JpaRepository ?명꽣?섏씠??
    // Spring Data JPA???섑빐 ?먮룞?쇰줈 援ы쁽泥닿? ?앹꽦?섏뼱 二쇱엯?⑸땲??
    private final CleaningDataRepository repository;

    /**
     * 吏?뺣맂 ?쒖옉?쇨낵 醫낅즺???ъ씠??泥?냼 ?곗씠?곕? ?섏씠吏뺥븯??議고쉶?⑸땲??
     * ?쒖옉???먮뒗 醫낅즺?쇱씠 ?쒓났?섏? ?딆쑝硫?湲곕낯媛믪쓣 ?ъ슜?⑸땲??
     *
     * @param startDate 議고쉶 ?쒖옉 ?좎쭨 (YYYY-MM-DD ?뺤떇??臾몄옄??. null ?먮뒗 鍮꾩뼱?덉쑝硫??꾩옱 ?좎쭨濡쒕???1二쇱씪 ?꾩쑝濡??ㅼ젙?⑸땲??
     * @param endDate   議고쉶 醫낅즺 ?좎쭨 (YYYY-MM-DD ?뺤떇??臾몄옄??. null ?먮뒗 鍮꾩뼱?덉쑝硫??꾩옱 ?좎쭨濡??ㅼ젙?⑸땲??
     * @return ?대떦 湲곌컙 ?댁쓽 `CleaningDataDTO` ?섏씠吏
     */
    public List<CleaningDataDTO> getCleaningReport(String startDate, String endDate) {
        // ?쒖옉?쇱씠 null?닿굅??鍮꾩뼱?덈뒗 寃쎌슦, ?꾩옱 ?좎쭨濡쒕???1二쇱씪 ?꾩쑝濡?湲곕낯媛믪쓣 ?ㅼ젙?⑸땲??
        if (startDate == null || startDate.isEmpty()) {
            startDate = LocalDate.now().minusWeeks(1).toString();
        }
        // 醫낅즺?쇱씠 null?닿굅??鍮꾩뼱?덈뒗 寃쎌슦, ?꾩옱 ?좎쭨濡?湲곕낯媛믪쓣 ?ㅼ젙?⑸땲??
        if (endDate == null || endDate.isEmpty()) {
            endDate = LocalDate.now().toString();
        }

        // 臾몄옄???뺥깭???쒖옉?쇱쓣 `LocalDate` 媛앹껜濡??뚯떛?섍퀬, ?대떦 ?좎쭨???쒖옉 ?쒓컙(00:00:00)?쇰줈 `LocalDateTime`???앹꽦?⑸땲??
        LocalDateTime startDateTime = LocalDate.parse(startDate).atStartOfDay();
        // 臾몄옄???뺥깭??醫낅즺?쇱쓣 `LocalDate` 媛앹껜濡??뚯떛?섍퀬, ?대떦 ?좎쭨??留덉?留??쒓컙(23:59:59.999999999)?쇰줈 `LocalDateTime`???앹꽦?⑸땲??
        LocalDateTime endDateTime = LocalDate.parse(endDate).atTime(LocalTime.MAX);

        // 議고쉶???곗씠???섏씠吏瑜?DTO ?섏씠吏濡?蹂?섑븯??諛섑솚?⑸땲??
        return repository.findByStartTimeBetween(startDateTime, endDateTime)
                .stream()
                .map(CleaningDataDTO::create)
                .toList();
    }
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\service\EmbeddingService.java
---
package com.codehows.taelimbe.service;

import com.codehows.taelimbe.langchain.embaddings.EmbeddingStoreManager;
import com.codehows.taelimbe.langchain.embaddings.TextSplitterStrategy;
import dev.langchain4j.data.embedding.Embedding;
import dev.langchain4j.data.segment.TextSegment;
import dev.langchain4j.model.embedding.EmbeddingModel;
import dev.langchain4j.model.output.Response;
import dev.langchain4j.store.embedding.EmbeddingStore;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.core.task.TaskExecutor;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.concurrent.CompletableFuture;

/**
 * ?띿뒪???꾨쿋??諛?踰≫꽣 ??μ냼 愿由щ? ?대떦?섎뒗 ?쒕퉬?ㅼ엯?덈떎.
 * `@Service` ?대끂?뚯씠?섏? ???대옒?ㅺ? 鍮꾩쫰?덉뒪 怨꾩링??而댄룷?뚰듃?꾩쓣 ?섑??대ŉ,
 * Spring 而⑦뀒?대꼫???섑빐 愿由щ릺??鍮덉쑝濡??깅줉?⑸땲??
 * `@RequiredArgsConstructor`??Lombok ?대끂?뚯씠?섏쑝濡? final ?꾨뱶??????앹꽦?먮? ?먮룞?쇰줈 ?앹꽦?섏뿬 ?섏〈??二쇱엯???⑹씠?섍쾶 ?⑸땲??
 * `@Slf4j`??Lombok ?대끂?뚯씠?섏쑝濡? 濡쒓퉭???꾪븳 `log` 媛앹껜瑜??먮룞?쇰줈 ?앹꽦?⑸땲??
 */
@Service
@RequiredArgsConstructor
@Slf4j
public class EmbeddingService {

    // ?띿뒪?몃? ?꾨쿋??踰≫꽣濡?蹂?섑븯??紐⑤뜽??二쇱엯諛쏆뒿?덈떎.
    private final EmbeddingModel embeddingModel;
    // ?앹꽦???꾨쿋??踰≫꽣瑜???ν븯怨?寃?됲븯???ㅽ넗?대? 二쇱엯諛쏆뒿?덈떎.
    private final EmbeddingStore<TextSegment> embeddingStore;
    // ?꾨쿋???ㅽ넗?댁쓽 珥덇린??諛?愿由?湲곕뒫???쒓났?섎뒗 留ㅻ땲?瑜?二쇱엯諛쏆뒿?덈떎.
    private final EmbeddingStoreManager embeddingStoreManager;
    // ?띿뒪??遺꾪븷 ?꾨왂??二쇱엯諛쏆뒿?덈떎.
    private final TextSplitterStrategy textSplitterStrategy;

    // 鍮꾨룞湲??묒뾽???꾪븳 ?ㅻ젅?????二쇱엯諛쏆뒿?덈떎.
    @Qualifier("taskExecutor")
    private final TaskExecutor taskExecutor;

    /**
     * 二쇱뼱吏??띿뒪?몃? ?꾨쿋?⑺븯??踰≫꽣 ??μ냼??異붽??⑸땲??
     * ??硫붿꽌?쒕뒗 RAG(Retrieval-Augmented Generation)瑜??꾪븳 吏??湲곕컲??援ъ텞?섎뒗 ???ъ슜?⑸땲??
     * ?묒뾽? 鍮꾨룞湲곗쟻?쇰줈 ?ㅽ뻾?섏뼱 ?몄텧 ?ㅻ젅?쒕? 釉붾줈?뱁븯吏 ?딆뒿?덈떎.
     *
     * @param text ?꾨쿋?⑺븯怨???ν븷 ?띿뒪??
     * @return 鍮꾨룞湲??묒뾽???꾨즺瑜??섑??대뒗 `CompletableFuture<Void>`
     */
    public CompletableFuture<Void> embedAndStore(String text) {
        return CompletableFuture.runAsync(() -> {
            log.info("?띿뒪???꾨쿋??諛?????쒖옉: '{}'", text);

            // 1. ?띿뒪??遺꾪븷 ?꾨왂???ъ슜?섏뿬 ?띿뒪?몃? ?묒? `TextSegment`?ㅻ줈 遺꾪븷?⑸땲??
            List<TextSegment> segments = textSplitterStrategy.split(text).stream().map(TextSegment::from).toList();

            // 2. `EmbeddingModel`???ъ슜?섏뿬 媛?`TextSegment`瑜??꾨쿋??踰≫꽣濡?蹂?섑빀?덈떎.
            Response<List<Embedding>> embedding = embeddingModel.embedAll(segments);

            // 3. ?꾨쿋?⑸맂 `TextSegment`? ?대떦 ?꾨쿋??踰≫꽣瑜?`EmbeddingStore`??異붽??⑸땲??
            embeddingStore.addAll(embedding.content(), segments);

            log.info("?띿뒪???꾨쿋??諛?????꾨즺.");
        }, taskExecutor); // 吏?뺣맂 `taskExecutor` ?ㅻ젅????먯꽌 ?ㅽ뻾
    }

    /**
     * 湲곗〈 踰≫꽣 ??μ냼??紐⑤뱺 ?곗씠?곕? ??젣?섍퀬, 二쇱뼱吏??띿뒪?몃줈 ?덈줈 ?꾨쿋?⑺븯????ν빀?덈떎.
     * 吏??湲곕컲???꾩쟾??珥덇린?뷀븯怨??덈줈???곗씠?곕줈 援먯껜?????ъ슜?⑸땲??
     * ?묒뾽? 鍮꾨룞湲곗쟻?쇰줈 ?ㅽ뻾?섏뼱 ?몄텧 ?ㅻ젅?쒕? 釉붾줈?뱁븯吏 ?딆뒿?덈떎.
     *
     * @param text ?덈줈 ?꾨쿋?⑺븯怨???ν븷 ?띿뒪??
     * @return 鍮꾨룞湲??묒뾽???꾨즺瑜??섑??대뒗 `CompletableFuture<Void>`
     */
    public CompletableFuture<Void> resetAndEmbed(String text) {
        return CompletableFuture.runAsync(() -> {
            log.info("?꾨쿋???ㅽ넗???ъ꽕??諛????띿뒪???꾨쿋???쒖옉.");

            // 1. `EmbeddingStoreManager`瑜??ъ슜?섏뿬 Milvus 而щ젆?섏쓣 ?ъ꽕????젣 ???ъ깮???⑸땲??
            embeddingStoreManager.reset();

            // 2. ?덈줈???띿뒪?몃줈 ?꾨쿋??諛???μ쓣 ?섑뻾?⑸땲??
            embedAndStore(text);

            log.info("?꾨쿋???ㅽ넗???ъ꽕??諛????띿뒪???꾨쿋???꾨즺.");
        }, taskExecutor); // 吏?뺣맂 `taskExecutor` ?ㅻ젅????먯꽌 ?ㅽ뻾
    }
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\service\GeneralShopService.java
---
package com.codehows.taelimbe.service;

import com.codehows.taelimbe.client.PuduAPIClient;
import lombok.RequiredArgsConstructor;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.web.util.UriComponentsBuilder;

@RequiredArgsConstructor
@Service
public class GeneralShopService {

    private final PuduAPIClient puduAPIClient;

    public ResponseEntity<String> getShopList(int limit, int offset) {
        try {
            System.out.println("====== 留ㅼ옣 紐⑸줉 議고쉶 ?쒖옉 ======");
            System.out.println("Limit: " + limit);
            System.out.println("Offset: " + offset);

            String url = UriComponentsBuilder.fromHttpUrl(puduAPIClient.getBaseUrl())
                    .path("/data-open-platform-service/v1/api/shop")
                    .queryParam("limit", limit)
                    .queryParam("offset", offset)
                    .toUriString();

            System.out.println("Target URL: " + url);
            return puduAPIClient.callPuduAPI(url, "GET");

        } catch (Exception e) {
            System.err.println("Error: " + e.getMessage());
            e.printStackTrace();
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                    .body("{\"error\": \"" + e.getMessage() + "\"}");
        }
    }

    public ResponseEntity<String> getRobotList(int limit, int offset, Long shop_id, String[] product_code) {
        try {
            System.out.println("====== 濡쒕큸 紐⑸줉 議고쉶 ?쒖옉 ======");
            System.out.println("Limit: " + limit);
            System.out.println("Offset: " + offset);

            UriComponentsBuilder builder = UriComponentsBuilder.fromHttpUrl(puduAPIClient.getBaseUrl())
                    .path("/data-open-platform-service/v1/api/robot")
                    .queryParam("limit", limit)
                    .queryParam("offset", offset);

            if (shop_id != null) {
                builder.queryParam("shop_id", shop_id);
            }

            if (product_code != null && product_code.length > 0) {
                for (String code : product_code) {
                    builder.queryParam("product_code", code);
                }
            }

            String url = builder.toUriString();
            System.out.println("Target URL: " + url);
            return puduAPIClient.callPuduAPI(url, "GET");

        } catch (Exception e) {
            System.err.println("Error: " + e.getMessage());
            e.printStackTrace();
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                    .body("{\"error\": \"" + e.getMessage() + "\"}");
        }
    }
}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\service\ReportService.java
---
package com.codehows.taelimbe.service;

import com.codehows.taelimbe.client.PuduAPIClient;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.web.util.UriComponentsBuilder;

import java.util.Optional;

@Service
public class ReportService {

    private final PuduAPIClient puduAPIClient;

    public ReportService(PuduAPIClient puduAPIClient) {
        this.puduAPIClient = puduAPIClient;
    }

    public ResponseEntity<String> getCleanReportList(long start_time, long end_time,
                                                     int offset, int limit, int timezone_offset,
                                                     Long shop_id) {
        try {
            System.out.println("====== Cleaning Report 紐⑸줉 議고쉶 ?쒖옉 ======");

            String url = UriComponentsBuilder.fromHttpUrl(puduAPIClient.getBaseUrl())
                    .path("/data-board/v1/log/clean_task/query_list")
                    .queryParam("start_time", start_time)
                    .queryParam("end_time", end_time)
                    .queryParam("offset", offset)
                    .queryParam("limit", limit)
                    .queryParam("timezone_offset", timezone_offset)
                    .queryParam("shop_id", shop_id)
                    .toUriString();

            System.out.println("Target URL: " + url);
            return puduAPIClient.callPuduAPI(url, "GET");

        } catch (Exception e) {
            e.printStackTrace();
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                    .body("{\"error\": \"" + e.getMessage() + "\"}");
        }
    }

    public ResponseEntity<String> getCleanReportDetail(String sn, String report_id,
                                                       long start_time, long end_time,
                                                       int timezone_offset, Long shop_id) {
        try {
            System.out.println("====== Cleaning Report ?곸꽭 議고쉶 ?쒖옉 ======");

            UriComponentsBuilder builder = UriComponentsBuilder.fromHttpUrl(puduAPIClient.getBaseUrl())
                    .path("/data-board/v1/log/clean_task/query")
                    .queryParam("sn", sn)
                    .queryParam("report_id", report_id)
                    .queryParam("start_time", start_time)
                    .queryParam("end_time", end_time)
                    .queryParam("timezone_offset", timezone_offset);

            if (shop_id != null) {
                builder.queryParam("shop_id", shop_id);
            }

            String url = builder.toUriString();
            System.out.println("Target Detail URL: " + url);
            return puduAPIClient.callPuduAPI(url, "GET");

        } catch (Exception e) {
            e.printStackTrace();
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                    .body("{\"error\": \"" + e.getMessage() + "\"}");
        }
    }
}
---
C:\tealim-be\src\main\java\com\codehows\taelimbe\service\RobotRobotService.java
---
package com.codehows.taelimbe.service;

import com.codehows.taelimbe.client.PuduAPIClient;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.node.ObjectNode;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.web.util.UriComponentsBuilder;

import java.net.URLEncoder;

@Service
public class RobotRobotService {

    private final PuduAPIClient puduAPIClient;
    private final ObjectMapper objectMapper;
    private static final String ENCODING = "UTF-8";

    public RobotRobotService(PuduAPIClient puduAPIClient, ObjectMapper objectMapper) {
        this.puduAPIClient = puduAPIClient;
        this.objectMapper = objectMapper;
    }

    public ResponseEntity<String> getRobotDetail(String sn) {
        try {
            System.out.println("====== 濡쒕큸 ?곸꽭 議고쉶 ?쒖옉 ======");
            System.out.println("SN: " + sn);

            String url = UriComponentsBuilder.fromHttpUrl(puduAPIClient.getBaseUrl())
                    .path("/cleanbot-service/v1/api/open/robot/detail")
                    .queryParam("sn", sn)
                    .toUriString();

            System.out.println("Target URL: " + url);
            return puduAPIClient.callPuduAPI(url, "GET");

        } catch (Exception e) {
            System.err.println("Error: " + e.getMessage());
            e.printStackTrace();
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                    .body("{\"error\": \"" + e.getMessage() + "\"}");
        }
    }

    public ResponseEntity<?> getRobotFullInfo(String sn, long shop_id, Long start_time, Long end_time,
                                              int timezone_offset, int limit) {
        try {
            System.out.println("====== 濡쒕큸 ?꾩껜 ?뺣낫 議고쉶 ?쒖옉 ======");
            System.out.println("SN: " + sn);
            System.out.println("Shop ID: " + shop_id);
            System.out.println("Start Time: " + start_time);
            System.out.println("End Time: " + end_time);
            System.out.println("Timezone Offset: " + timezone_offset);
            System.out.println("Limit: " + limit);

            // 1. 濡쒕큸 ?곸꽭 ?뺣낫 議고쉶
            ResponseEntity<String> robotResponse = getRobotDetail(sn);
            String robotJson = robotResponse.getBody();

            // 2. 異⑹쟾 ?뺣낫 議고쉶
            // start_time, end_time??null?대㈃ 湲곕낯媛믪쑝濡?24?쒓컙 ???ㅼ젙
            long st = (start_time != null) ? start_time : System.currentTimeMillis() / 1000 - 86400;
            long et = (end_time != null) ? end_time : System.currentTimeMillis() / 1000;

            String chargingUrl = UriComponentsBuilder.fromHttpUrl(puduAPIClient.getBaseUrl())
                    .path("/data-board/v1/log/charge/query_list")
                    .queryParam("start_time", st)
                    .queryParam("end_time", et)
                    .queryParam("offset", 0)
                    .queryParam("limit", limit)
                    .queryParam("timezone_offset", timezone_offset)
                    .queryParam("shop_id", shop_id)
                    .toUriString();

            System.out.println("Charging URL: " + chargingUrl);
            ResponseEntity<String> chargingResponse = puduAPIClient.callPuduAPI(chargingUrl, "GET");
            String chargingJson = chargingResponse.getBody();

            // 3. ?곗씠??寃고빀
            ObjectNode combinedData = combineRobotData(robotJson, chargingJson);

            return ResponseEntity.ok(combinedData);

        } catch (Exception e) {
            System.err.println("Error: " + e.getMessage());
            e.printStackTrace();
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                    .body("{\"error\": \"" + e.getMessage() + "\"}");
        }
    }

    /**
     * 濡쒕큸 ?뺣낫? 異⑹쟾 ?뺣낫瑜?寃고빀
     *
     * 異뷀썑 ?ㅻⅨ ?쒕퉬?ㅼ뿉?쒕룄 媛숈? 濡쒖쭅???꾩슂?섎㈃
     * DataCombiningService濡?遺꾨━ ?덉젙
     */
    private ObjectNode combineRobotData(String robotJson, String chargingJson) throws Exception {
        JsonNode robotNode = objectMapper.readTree(robotJson);
        JsonNode chargingNode = objectMapper.readTree(chargingJson);

        ObjectNode result = objectMapper.createObjectNode();

        // 濡쒕큸 ?뺣낫 異붿텧
        if (robotNode.has("data")) {
            JsonNode data = robotNode.get("data");
            result.put("sn", data.get("sn").asText());
            result.put("mac", data.get("mac").asText());
            result.put("nickname", data.get("nickname").asText());
            result.put("online", data.get("online").asInt());
            result.put("battery", data.get("battery").asInt());
            result.put("robotStatus", data.get("status").asInt());
        }

        // 異⑹쟾 ?뺣낫 異붿텧
        if (chargingNode.has("data")) {
            JsonNode data = chargingNode.get("data");
            if (data.isArray() && data.size() > 0) {
                JsonNode firstRecord = data.get(0);
                result.put("modelName", firstRecord.get("model_name").asText());
                result.put("softwareVersion", firstRecord.get("software_version").asText());
            }
        }

        return result;
    }
}
---
C:\tealim-be\src\main\java\com\codehows\taelimbe\service\StatisticalLogService.java
---
package com.codehows.taelimbe.service;

import com.codehows.taelimbe.client.PuduAPIClient;
import lombok.RequiredArgsConstructor;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.web.util.UriComponentsBuilder;

@RequiredArgsConstructor
@Service
public class StatisticalLogService {

    private final PuduAPIClient puduAPIClient;

    public ResponseEntity<String> getChargingRecordList(long start_time, long end_time,
                                                        int offset, int limit, int timezone_offset,
                                                        Long shop_id) {
        try {
            System.out.println("====== Charging Record 紐⑸줉 議고쉶 ?쒖옉 ======");
            System.out.println("Start Time: " + start_time);
            System.out.println("End Time: " + end_time);
            System.out.println("Offset: " + offset);
            System.out.println("Limit: " + limit);

            UriComponentsBuilder builder = UriComponentsBuilder.fromHttpUrl(puduAPIClient.getBaseUrl())
                    .path("/data-board/v1/log/charge/query_list")
                    .queryParam("start_time", start_time)
                    .queryParam("end_time", end_time)
                    .queryParam("offset", offset)
                    .queryParam("limit", limit)
                    .queryParam("timezone_offset", timezone_offset);

            if (shop_id != null) {
                builder.queryParam("shop_id", shop_id);
            }

            String url = builder.toUriString();
            System.out.println("Target URL: " + url);
            return puduAPIClient.callPuduAPI(url, "GET");

        } catch (Exception e) {
            System.err.println("Error: " + e.getMessage());
            e.printStackTrace();
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                    .body("{\"error\": \"" + e.getMessage() + "\"}");
        }
    }

    public ResponseEntity<String> getBatteryHealthList(long start_time, long end_time,
                                                       int offset, int limit, int timezone_offset,
                                                       Long shop_id, String sn,
                                                       Integer min_cycle, Integer max_cycle,
                                                       Integer min_full_capacity, Integer max_full_capacity) {
        try {
            System.out.println("====== Battery Health 紐⑸줉 議고쉶 ?쒖옉 ======");
            System.out.println("Start Time: " + start_time);
            System.out.println("End Time: " + end_time);
            System.out.println("Offset: " + offset);
            System.out.println("Limit: " + limit);

            UriComponentsBuilder builder = UriComponentsBuilder.fromHttpUrl(puduAPIClient.getBaseUrl())
                    .path("/data-board/v1/log/battery/query_list")
                    .queryParam("start_time", start_time)
                    .queryParam("end_time", end_time)
                    .queryParam("offset", offset)
                    .queryParam("limit", limit)
                    .queryParam("timezone_offset", timezone_offset);

            // ?좏깮 ?뚮씪誘명꽣??
            if (shop_id != null) builder.queryParam("shop_id", shop_id);
            if (sn != null && !sn.isEmpty()) builder.queryParam("sn", sn);
            if (min_cycle != null) builder.queryParam("min_cycle", min_cycle);
            if (max_cycle != null) builder.queryParam("max_cycle", max_cycle);
            if (min_full_capacity != null) builder.queryParam("min_full_capacity", min_full_capacity);
            if (max_full_capacity != null) builder.queryParam("max_full_capacity", max_full_capacity);

            String url = builder.toUriString();

            System.out.println("Battery Health Target URL: " + url);

            return puduAPIClient.callPuduAPI(url, "GET");

        } catch (Exception e) {
            System.err.println("Error: " + e.getMessage());
            e.printStackTrace();

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                    .body("{\"error\": \"" + e.getMessage() + "\"}");
        }
    }

}
---
C:\tealim-be\src\main\java\com\codehows\taelimbe\service\UserService.java
---
//package com.codehows.taelimbe.service;
//
//import com.codehows.taelimbe.dto.UserDto;
//import com.codehows.taelimbe.entity.Store;
//import com.codehows.taelimbe.entity.User;
//import com.codehows.taelimbe.repository.StoreRepository;
//import com.codehows.taelimbe.repository.UserRepository;
//import lombok.RequiredArgsConstructor;
//import org.springframework.security.crypto.password.PasswordEncoder;
//import org.springframework.stereotype.Service;
//
//@Service
//@RequiredArgsConstructor
//public class UserService {
//
//    private final UserRepository userRepository;
//    private final StoreRepository storeRepository;
//    private final PasswordEncoder passwordEncoder;
//
//    public User registerUser(UserDto dto) {
//        Store store = storeRepository.findById(dto.getStoreId())
//                .orElseThrow(() -> new IllegalArgumentException("留ㅼ옣 ?뺣낫 ?놁쓬"));
//
//        User user = User.createUser(dto, store, passwordEncoder);
//        return userRepository.save(user);
//    }
//}

---
C:\tealim-be\src\main\java\com\codehows\taelimbe\service\detail\DataCombiningService.java
---
package com.codehows.taelimbe.service.detail;

import com.codehows.taelimbe.dto.RobotFullInfoDTO;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.stereotype.Service;

@Service
public class DataCombiningService {

    private final ObjectMapper objectMapper;

    public DataCombiningService(ObjectMapper objectMapper) {
        this.objectMapper = objectMapper;
    }

    public RobotFullInfoDTO combineRobotData(String robotJson, String chargingJson) throws Exception {
        JsonNode robotNode = objectMapper.readTree(robotJson);
        JsonNode chargingNode = objectMapper.readTree(chargingJson);

        RobotFullInfoDTO robotFullInfo = new RobotFullInfoDTO();

        // robotJson?먯꽌 異붿텧
        if (robotNode.has("data")) {
            JsonNode data = robotNode.get("data");
            robotFullInfo.setSn(data.get("sn").asText());
            robotFullInfo.setMac(data.get("mac").asText());
            robotFullInfo.setNickname(data.get("nickname").asText());
            robotFullInfo.setOnline(data.get("online").asInt());
            robotFullInfo.setBattery(data.get("battery").asInt());
            robotFullInfo.setRobotStatus(data.get("status").asInt());
        }

        // chargingJson?먯꽌 異붿텧
        if (chargingNode.has("data")) {
            JsonNode data = chargingNode.get("data");
            if (data.isArray() && data.size() > 0) {
                JsonNode firstRecord = data.get(0);
                robotFullInfo.setModelName(firstRecord.get("model_name").asText());
                robotFullInfo.setSoftwareVersion(firstRecord.get("software_version").asText());
            }
        }

        return robotFullInfo;
    }
}
---
C:\tealim-be\src\main\java\com\codehows\taelimbe\service\detail\DataProcessingService.java
---
package com.codehows.taelimbe.service.detail;

import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.stereotype.Service;

@Service
public class DataProcessingService {

    private final ObjectMapper objectMapper;

    public DataProcessingService(ObjectMapper objectMapper) {
        this.objectMapper = objectMapper;
    }

    public <T> T parseJson(String json, Class<T> clazz) throws Exception {
        return objectMapper.readValue(json, clazz);
    }

    public String toJsonString(Object object) throws Exception {
        return objectMapper.writeValueAsString(object);
    }

    // ?꾩슂??異붽? 泥섎━ 濡쒖쭅?ㅼ쓣 ?ш린??異붽?
}

---
C:\tealim-be\src\main\resources\data.sql
---
-- CleaningData ?뚯씠釉붿뿉 ?섑뵆 ?곗씠?곕? ?쎌엯?섎뒗 SQL ?ㅽ겕由쏀듃?낅땲??
-- ???곗씠?곕뒗 ?좏뵆由ъ??댁뀡 ?쒖옉 ??H2 ?곗씠?곕쿋?댁뒪??濡쒕뱶?⑸땲??

INSERT INTO cleaning_data (start_time, end_time, location, duration, area_cleaned, water_usage, power_usage) VALUES
('2024-05-01 09:00:00', '2024-05-01 10:00:00', 'Office A', 60, 100.5, 50.2, 10.1),
('2024-05-01 10:30:00', '2024-05-01 11:30:00', 'Office B', 60, 120.0, 60.0, 12.5),
('2024-05-02 14:00:00', '2024-05-02 15:30:00', 'Meeting Room 1', 90, 50.0, 25.0, 5.0),
('2024-05-03 08:00:00', '2024-05-03 09:00:00', 'Office C', 60, 110.0, 55.0, 11.0),
('2024-05-03 09:30:00', '2024-05-03 10:30:00', 'Office D', 60, 95.0, 48.0, 9.5),
('2024-05-04 11:00:00', '2024-05-04 12:00:00', 'Lobby', 60, 150.0, 70.0, 15.0),
('2024-05-05 13:00:00', '2024-05-05 14:00:00', 'Restroom 1', 60, 30.0, 15.0, 3.0),
('2024-05-06 09:00:00', '2024-05-06 10:00:00', 'Office A', 60, 100.5, 50.2, 10.1),
('2024-05-06 10:30:00', '2024-05-06 11:30:00', 'Office B', 60, 120.0, 60.0, 12.5),
('2024-05-07 14:00:00', '2024-05-07 15:30:00', 'Meeting Room 1', 90, 50.0, 25.0, 5.0),
('2024-05-08 08:00:00', '2024-05-08 09:00:00', 'Office C', 60, 110.0, 55.0, 11.0),
('2024-05-08 09:30:00', '2024-05-08 10:30:00', 'Office D', 60, 95.0, 48.0, 9.5),
('2024-05-09 11:00:00', '2024-05-09 12:00:00', 'Lobby', 60, 150.0, 70.0, 15.0),
('2024-05-10 13:00:00', '2024-05-10 14:00:00', 'Restroom 1', 60, 30.0, 15.0, 3.0),
('2024-05-11 09:00:00', '2024-05-11 10:00:00', 'Office A', 60, 100.5, 50.2, 10.1),
('2024-05-11 10:30:00', '2024-05-11 11:30:00', 'Office B', 60, 120.0, 60.0, 12.5),
('2024-05-12 14:00:00', '2024-05-12 15:30:00', 'Meeting Room 1', 90, 50.0, 25.0, 5.0),
('2024-05-13 08:00:00', '2024-05-13 09:00:00', 'Office C', 60, 110.0, 55.0, 11.0),
('2024-05-13 09:30:00', '2024-05-13 10:30:00', 'Office D', 60, 95.0, 48.0, 9.5),
('2024-05-14 11:00:00', '2024-05-14 12:00:00', 'Lobby', 60, 150.0, 70.0, 15.0),
('2024-05-15 13:00:00', '2024-05-15 14:00:00', 'Restroom 1', 60, 30.0, 15.0, 3.0);
---
C:\tealim-be\src\main\resources\schema.sql
---
-- CleaningData ?뚯씠釉붿쓽 ?ㅽ궎留덈? ?뺤쓽?섎뒗 SQL ?ㅽ겕由쏀듃?낅땲??
-- ???ㅽ겕由쏀듃??H2 ?곗씠?곕쿋?댁뒪?먯꽌 CleaningData ?뷀떚?곗뿉 留ㅽ븨?섎뒗 ?뚯씠釉붿쓣 ?앹꽦?⑸땲??

CREATE TABLE IF NOT EXISTS cleaning_data (
    cleaning_id BIGINT AUTO_INCREMENT PRIMARY KEY, -- 泥?냼 ?묒뾽??怨좎쑀 ID (?먮룞 利앷?, 湲곕낯 ??
    start_time TIMESTAMP NOT NULL,                 -- 泥?냼 ?묒뾽 ?쒖옉 ?쒓컙 (?꾩닔)
    end_time TIMESTAMP NOT NULL,                   -- 泥?냼 ?묒뾽 醫낅즺 ?쒓컙 (?꾩닔)
    location VARCHAR(255) NOT NULL,                -- 泥?냼 ?묒뾽 ?꾩튂 (?꾩닔)
    duration BIGINT,                               -- 泥?냼 ?묒뾽 ?뚯슂 ?쒓컙 (遺??⑥쐞)
    area_cleaned DOUBLE,                           -- 泥?냼??硫댁쟻 (?쒓낢誘명꽣 ?⑥쐞)
    water_usage DOUBLE,                            -- 泥?냼???ъ슜??臾쇱쓽 ??(由ы꽣 ?⑥쐞)
    power_usage DOUBLE                             -- 泥?냼???ъ슜???꾨젰??(kWh ?⑥쐞)
);
