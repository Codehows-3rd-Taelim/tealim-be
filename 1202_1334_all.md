
# C:\tealim-be\src\main\java\com\codehows\taelimbe\robot\service\RobotService.java
`java

package com.codehows.taelimbe.robot.service;

import com.codehows.taelimbe.client.PuduAPIClient;
import com.codehows.taelimbe.robot.dto.RobotSyncRequestDTO;
import com.codehows.taelimbe.robot.dto.RobotDTO;
import com.codehows.taelimbe.robot.entity.Robot;
import com.codehows.taelimbe.store.entity.Store;
import com.codehows.taelimbe.robot.repository.RobotRepository;
import com.codehows.taelimbe.store.repository.StoreRepository;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.util.UriComponentsBuilder;

import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

@Service
@RequiredArgsConstructor
public class RobotService {

    private final PuduAPIClient puduAPIClient;
    private final RobotRepository robotRepository;
    private final StoreRepository storeRepository;
    private final ObjectMapper mapper = new ObjectMapper();

    /**
     * ?뱀젙 留ㅼ옣??濡쒕큸??Pudu API?먯꽌 議고쉶?섏뿬 DB??????낅뜲?댄듃
     * @param req 留ㅼ옣 ID ?ы븿 ?붿껌 ?뺣낫
     * @return ??λ맂 濡쒕큸 媛쒖닔
     */
    @Transactional
    public int syncRobots(RobotSyncRequestDTO req) {

        Store store = storeRepository.findById(req.getStoreId())
                .orElseThrow(() -> new IllegalArgumentException("Store not found"));

        Long shopId = store.getShopId();

        List<RobotDTO> robots = getRobotListByShop(shopId);

        int cnt = 0;
        for (RobotDTO dto : robots) {
            saveRobot(dto, store);
            cnt++;
        }

        return cnt;
    }

    /**
     * DB????λ맂 紐⑤뱺 留ㅼ옣??濡쒕큸??Pudu API?먯꽌 議고쉶?섏뿬 ?숆린??
     * 愿由ъ옄媛 ?꾩껜 留ㅼ옣??濡쒕큸 ?뺣낫瑜???踰덉뿉 ?낅뜲?댄듃?????ъ슜
     * @return ??λ맂 ?꾩껜 濡쒕큸 媛쒖닔
     */
    @Transactional
    public int syncAllStoresRobots() {

        List<Store> stores = storeRepository.findAll();

        System.out.println("\n===== Sync All Stores Robots =====");
        System.out.println("Total Stores: " + stores.size());

        int totalCount = 0;

        for (Store store : stores) {
            System.out.println("\n--- Processing Store: " + store.getStoreId() + " ---");

            try {
                int count = syncRobots(RobotSyncRequestDTO.builder()
                        .storeId(store.getStoreId())
                        .build());
                totalCount += count;
                System.out.println("Store " + store.getStoreId() + " Synced: " + count + " robots");
            } catch (Exception e) {
                System.out.println("Error syncing store " + store.getStoreId() + ": " + e.getMessage());
                e.printStackTrace();
            }
        }

        System.out.println("\n===== All Stores Robot Sync Complete =====");
        System.out.println("Total Synced: " + totalCount);
        System.out.println("==========================================\n");

        return totalCount;
    }

    /**
     * DB?먯꽌 ?뱀젙 留ㅼ옣??濡쒕큸 紐⑸줉??議고쉶
     * @param storeId 留ㅼ옣 ID
     * @return ?대떦 留ㅼ옣???랁븳 濡쒕큸 紐⑸줉
     */
    public List<RobotDTO> getRobotListFromDB(Long storeId) {

        return robotRepository.findAllByStore_StoreId(storeId)
                .stream()
                .map(this::convertToDto)
                .collect(Collectors.toList());
    }

    /**
     * DB??濡쒕큸 ?뺣낫? API??理쒖떊 ?곹깭 ?뺣낫瑜?蹂묓빀?섏뿬 議고쉶
     * @param sn 濡쒕큸 ?쒕━??踰덊샇
     * @param storeId 留ㅼ옣 ID
     * @return 蹂묓빀??濡쒕큸 ?뺣낫
     */
    public RobotDTO getRobotInfoByStoreId(String sn, Long storeId) {

        Store store = storeRepository.findById(storeId)
                .orElseThrow(() -> new IllegalArgumentException("Store not found"));

        Long shopId = store.getShopId();

        RobotDTO api = getRobotInfo(sn, shopId);
        Robot robot = robotRepository.findBySn(sn).orElse(null);

        if (robot == null) return api;

        RobotDTO dto = convertToDto(robot);

        dto.setBattery(api.getBattery());
        dto.setOnline(api.isOnline());
        dto.setStatus(api.getStatus());
        dto.setProductCode(api.getProductCode());
        dto.setSoftVersion(api.getSoftVersion());

        return dto;
    }

    /**
     * 濡쒕큸 ?뺣낫瑜?DB??????먮뒗 ?낅뜲?댄듃
     * @param dto ??ν븷 濡쒕큸 ?뺣낫
     * @param store 濡쒕큸???랁븳 留ㅼ옣
     * @return ??λ맂 濡쒕큸 ?뷀떚??
     */
    @Transactional
    public Robot saveRobot(RobotDTO dto, Store store) {

        Robot robot = robotRepository.findBySn(dto.getSn())
                .orElseGet(() -> new Robot(dto.getSn(), dto.getMac(), store));

        robot.updateRobotInfo(
                dto.getNickname(),
                dto.isOnline(),
                dto.getBattery(),
                dto.getStatus(),
                dto.getProductCode(),
                dto.getSoftVersion()
        );

        robot.changeStore(store);

        return robotRepository.save(robot);
    }

    /**
     * Pudu API?먯꽌 濡쒕큸??紐⑤뱺 ?뺣낫瑜?議고쉶?섏뿬 DTO濡?蹂??
     * @param sn 濡쒕큸 ?쒕━??踰덊샇
     * @param shopId ??ID
     * @return 議고쉶??濡쒕큸 ?뺣낫
     */
    public RobotDTO getRobotInfo(String sn, Long shopId) {

        String mac = null;
        String nickname = null;
        boolean online = false;
        int battery = 0;
        int status = 0;
        String productCode = null;
        String softVersion = null;

        JsonNode base = fetchRobotBySn(sn, shopId);
        if (base != null) mac = base.path("mac").asText(null);

        JsonNode detail = fetchRobotDetail(sn);
        if (detail != null) {
            nickname = detail.path("nickname").asText(null);
            battery = detail.path("battery").asInt();
            online = detail.path("online").asBoolean();
            status = detail.path("cleanbot").path("clean").path("status").asInt();
        }

        JsonNode charge = fetchLatestChargeLog(sn, shopId);
        if (charge != null) {
            productCode = charge.path("product_code").asText(null);
            softVersion = charge.path("soft_version").asText(null);
        }

        return RobotDTO.builder()
                .sn(sn)
                .mac(mac)
                .nickname(nickname)
                .online(online)
                .battery(battery)
                .status(status)
                .productCode(productCode)
                .softVersion(softVersion)
                .build();
    }

    /**
     * ?듭뿉 ?랁븳 紐⑤뱺 濡쒕큸 紐⑸줉??Pudu API?먯꽌 議고쉶
     * @param shopId ??ID
     * @return 濡쒕큸 ?뺣낫 由ъ뒪??
     */
    public List<RobotDTO> getRobotListByShop(Long shopId) {

        List<JsonNode> list = fetchRobotListAll(shopId);
        List<RobotDTO> result = new ArrayList<>();

        for (JsonNode node : list) {
            String sn = node.path("sn").asText();
            result.add(getRobotInfo(sn, shopId));
        }

        return result;
    }

    /**
     * Pudu API?먯꽌 ?듭쓽 紐⑤뱺 濡쒕큸 紐⑸줉 議고쉶 (湲곕낯 ?뺣낫)
     * @param shopId ??ID
     * @return 濡쒕큸 JSON ?몃뱶 由ъ뒪??
     */
    private List<JsonNode> fetchRobotListAll(Long shopId) {

        List<JsonNode> list = new ArrayList<>();

        try {
            String url = UriComponentsBuilder.fromHttpUrl(puduAPIClient.getBaseUrl())
                    .path("/data-open-platform-service/v1/api/robot")
                    .queryParam("limit", 100)
                    .queryParam("offset", 0)
                    .queryParam("shop_id", shopId)
                    .toUriString();

            ResponseEntity<String> res = puduAPIClient.callPuduAPI(url, "GET");

            JsonNode arr = mapper.readTree(res.getBody()).path("data").path("list");

            if (arr.isArray()) arr.forEach(list::add);

        } catch (Exception ignored) {}

        return list;
    }

    /**
     * Pudu API?먯꽌 ?쒕━??踰덊샇濡??뱀젙 濡쒕큸 議고쉶
     * @param sn 濡쒕큸 ?쒕━??踰덊샇
     * @param shopId ??ID
     * @return 濡쒕큸 JSON ?몃뱶
     */
    private JsonNode fetchRobotBySn(String sn, Long shopId) {

        try {
            String url = UriComponentsBuilder.fromHttpUrl(puduAPIClient.getBaseUrl())
                    .path("/data-open-platform-service/v1/api/robot")
                    .queryParam("limit", 100)
                    .queryParam("offset", 0)
                    .queryParam("shop_id", shopId)
                    .toUriString();

            ResponseEntity<String> res = puduAPIClient.callPuduAPI(url, "GET");

            JsonNode nodes = mapper.readTree(res.getBody()).path("data").path("list");

            for (JsonNode n : nodes) {
                if (sn.equals(n.path("sn").asText())) return n;
            }

        } catch (Exception ignored) {}

        return null;
    }

    /**
     * Pudu API?먯꽌 濡쒕큸???곸꽭 ?뺣낫 議고쉶 (蹂꾩묶, 諛고꽣由? ?⑤씪???곹깭 ??
     * @param sn 濡쒕큸 ?쒕━??踰덊샇
     * @return 濡쒕큸 ?곸꽭 ?뺣낫 JSON ?몃뱶
     */
    private JsonNode fetchRobotDetail(String sn) {

        try {
            String url = UriComponentsBuilder.fromHttpUrl(puduAPIClient.getBaseUrl())
                    .path("/cleanbot-service/v1/api/open/robot/detail")
                    .queryParam("sn", sn)
                    .toUriString();

            ResponseEntity<String> res = puduAPIClient.callPuduAPI(url, "GET");

            return mapper.readTree(res.getBody()).path("data");

        } catch (Exception ignored) {}

        return null;
    }

    /**
     * Pudu API?먯꽌 濡쒕큸??理쒖떊 異⑹쟾 濡쒓렇 議고쉶 (?쒗뭹 肄붾뱶, ?뚰봽?몄썾??踰꾩쟾 ??
     * @param sn 濡쒕큸 ?쒕━??踰덊샇
     * @param shopId ??ID
     * @return 理쒖떊 異⑹쟾 濡쒓렇 JSON ?몃뱶
     */
    private JsonNode fetchLatestChargeLog(String sn, Long shopId) {

        long end = System.currentTimeMillis() / 1000;
        long start = end - 60L * 60 * 24 * 90;

        try {
            String url = UriComponentsBuilder.fromHttpUrl(puduAPIClient.getBaseUrl())
                    .path("/data-board/v1/log/charge/query_list")
                    .queryParam("start_time", start)
                    .queryParam("end_time", end)
                    .queryParam("limit", 1)
                    .queryParam("offset", 0)
                    .queryParam("shop_id", shopId)
                    .toUriString();

            ResponseEntity<String> res = puduAPIClient.callPuduAPI(url, "GET");

            JsonNode arr = mapper.readTree(res.getBody()).path("data").path("list");

            if (arr.isArray() && arr.size() > 0) return arr.get(0);

        } catch (Exception ignored) {}

        return null;
    }

    /**
     * DB?먯꽌 ?쒕━??踰덊샇濡?濡쒕큸 議고쉶
     * @param sn 濡쒕큸 ?쒕━??踰덊샇
     * @return 濡쒕큸 ?뺣낫 DTO
     */
    public RobotDTO getRobotBySn(String sn) {
        return robotRepository.findBySn(sn)
                .map(this::convertToDto)
                .orElseThrow(() -> new IllegalArgumentException("Robot not found"));
    }

    /**
     * 濡쒕큸 ?뷀떚?곕? DTO濡?蹂??
     * @param robot 濡쒕큸 ?뷀떚??
     * @return 蹂?섎맂 濡쒕큸 DTO
     */
    private RobotDTO convertToDto(Robot robot) {

        return RobotDTO.builder()
                .robotId(robot.getRobotId())
                .sn(robot.getSn())
                .mac(robot.getMac())
                .nickname(robot.getNickname())
                .online(robot.getOnline())
                .battery(robot.getBattery())
                .status(robot.getStatus())
                .productCode(robot.getProductCode())
                .softVersion(robot.getSoftVersion())
                .storeId(robot.getStore().getStoreId())
                .build();
    }
}

`


# C:\tealim-be\src\main\java\com\codehows\taelimbe\robot\repository\RobotRepository.java
`java

package com.codehows.taelimbe.robot.repository;

import com.codehows.taelimbe.robot.entity.Robot;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.List;
import java.util.Optional;

public interface RobotRepository extends JpaRepository<Robot, Long> {

    Optional<Robot> findBySn(String sn);
    Optional<Robot> findByMac(String mac);

    // Store.storeId = storeId
    List<Robot> findAllByStore_StoreId(Long storeId);



}


`


# C:\tealim-be\src\main\java\com\codehows\taelimbe\robot\entity\Robot.java
`java

package com.codehows.taelimbe.robot.entity;

import com.codehows.taelimbe.store.entity.Store;
import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;

@Entity
@Table(name = "robot")
@Getter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Robot {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "robot_id")
    private Long robotId;

    @Column(nullable = false, unique = true)
    private String sn;

    @Column(nullable = false, unique = true)
    private String mac;

    private String nickname;
    private Boolean online;
    private Integer battery;
    private Integer status;
    private String productCode;
    private String softVersion;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "store_id")
    private Store store;

    // ================= Constructor for Required Fields =================
    public Robot(String sn, String mac, Store store) {
        this.sn = sn;
        this.mac = mac;
        this.store = store;
    }

    // ================= Update Methods =================
    public void updateRobotInfo(String nickname, boolean online, int battery,
                                int status, String productCode, String softVersion) {
        this.nickname = nickname;
        this.online = online;
        this.battery = battery;
        this.status = status;
        this.productCode = productCode;
        this.softVersion = softVersion;
    }

    public void changeStore(Store store) {
        this.store = store;
    }
}


`


# C:\tealim-be\src\main\java\com\codehows\taelimbe\robot\dto\RobotSyncRequestDTO.java
`java

package com.codehows.taelimbe.robot.dto;

import jakarta.validation.constraints.*;
import lombok.*;

@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class RobotSyncRequestDTO {

    @NotNull(message = "storeId???꾩닔?낅땲??)
    @Positive(message = "storeId???묒닔?ъ빞 ?⑸땲??)
    private Long storeId;
}

`


# C:\tealim-be\src\main\java\com\codehows\taelimbe\robot\dto\RobotDTO.java
`java

package com.codehows.taelimbe.robot.dto;

import lombok.*;

@Getter
@NoArgsConstructor
@AllArgsConstructor
@Builder
@Setter
public class RobotDTO {

    private Long robotId;
    private String sn;
    private String mac;

    private String nickname;
    private boolean online;
    private Integer battery;
    private Integer status;

    private String productCode;
    private String softVersion;

    private Long storeId;
}


`


# C:\tealim-be\src\main\java\com\codehows\taelimbe\robot\controller\RobotController.java
`java

package com.codehows.taelimbe.robot.controller;

import com.codehows.taelimbe.robot.dto.RobotSyncRequestDTO;
import com.codehows.taelimbe.robot.dto.RobotDTO;
import com.codehows.taelimbe.robot.service.RobotService;
import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import java.util.List;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/robot")
public class RobotController {

    private final RobotService robotService;

    /**
     * ?뱀젙 留ㅼ옣??濡쒕큸 ?숆린??
     * ?붿껌??留ㅼ옣 ID???대떦?섎뒗 濡쒕큸??Pudu API?먯꽌 議고쉶?섏뿬 DB??????낅뜲?댄듃
     * @param req storeId ?ы븿 ?붿껌 ?뺣낫
     * @return ??λ맂 濡쒕큸 媛쒖닔
     */
    @PostMapping("/sync")
    public ResponseEntity<String> syncRobots(@Valid @RequestBody RobotSyncRequestDTO req) {
        int count = robotService.syncRobots(req);
        return ResponseEntity.ok(count + "媛?濡쒕큸 ????낅뜲?댄듃 ?꾨즺");
    }

    /**
     * 紐⑤뱺 留ㅼ옣??濡쒕큸 ?숆린??
     * DB????λ맂 紐⑤뱺 留ㅼ옣??濡쒕큸??Pudu API?먯꽌 議고쉶?섏뿬 ??踰덉뿉 ?숆린??
     * 愿由ъ옄媛 ?꾩껜 濡쒕큸 ?뺣낫瑜??낅뜲?댄듃?????ъ슜
     * @return ??λ맂 ?꾩껜 濡쒕큸 媛쒖닔
     */
    @PostMapping("/sync-all-stores")
    public ResponseEntity<String> syncAllStoresRobots() {
        int count = robotService.syncAllStoresRobots();
        return ResponseEntity.ok(count + "媛?濡쒕큸 ????낅뜲?댄듃 ?꾨즺 (紐⑤뱺 留ㅼ옣)");
    }

    /**
     * ?쒕━??踰덊샇濡?濡쒕큸 議고쉶
     * DB?먯꽌 ?뱀젙 ?쒕━??踰덊샇??濡쒕큸 ?뺣낫瑜?議고쉶
     * @param sn 濡쒕큸 ?쒕━??踰덊샇
     * @return 濡쒕큸 ?뺣낫
     */
    @GetMapping("/{sn}")
    public ResponseEntity<RobotDTO> getRobot(@PathVariable String sn) {
        return ResponseEntity.ok(robotService.getRobotBySn(sn));
    }

    /**
     * 留ㅼ옣蹂?濡쒕큸 紐⑸줉 議고쉶
     * ?뱀젙 留ㅼ옣???랁븳 紐⑤뱺 濡쒕큸 紐⑸줉??DB?먯꽌 議고쉶
     * @param storeId 留ㅼ옣 ID
     * @return ?대떦 留ㅼ옣??濡쒕큸 紐⑸줉
     */
    @GetMapping("/list")
    public ResponseEntity<List<RobotDTO>> getAllRobots(@RequestParam Long storeId) {
        return ResponseEntity.ok(robotService.getRobotListFromDB(storeId));
    }
}

`


# C:\tealim-be\src\main\java\com\codehows\taelimbe\report\controller\ReportController.java
`java

package com.codehows.taelimbe.report.controller;

import com.codehows.taelimbe.report.dto.*;
import com.codehows.taelimbe.report.service.ReportService;
import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import java.util.List;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/report")
public class ReportController {

    private final ReportService reportService;

    // ========== 1. ?⑥씪 留ㅼ옣 ?숆린??==========

    /**
     * ?뱀젙 留ㅼ옣???뱀젙 湲곌컙 Report ?숆린??
     * ?붿껌??留ㅼ옣??吏?뺣맂 湲곌컙 Report瑜?Pudu API?먯꽌 議고쉶?섏뿬 DB?????
     * ?섏씠吏?泥섎━濡???踰덉뿉 20媛쒖뵫 ?먮룞 議고쉶
     *
     * ?ъ슜 ?덉떆: ?뱀젙 留ㅼ옣???댁젣 ?곗씠?곕쭔 ?щ룞湲고솕
     *
     * @param req 留ㅼ옣 ID, ?쒖옉/醫낅즺 ?쒓컙, ??꾩〈 ?ㅽ봽???ы븿
     * @return ??λ맂 Report 媛쒖닔
     */
    @PostMapping("/sync/store/time-range")
    public ResponseEntity<String> syncSingleStoreByTimeRange(
            @Valid @RequestBody StoreTimeRangeSyncRequestDTO req
    ) {
        int count = reportService.syncSingleStoreByTimeRange(req);
        return ResponseEntity.ok(count + "媛?Report ????낅뜲?댄듃 ?꾨즺");
    }


    /**
     * ?뱀젙 留ㅼ옣???꾩껜 湲곌컙(185?? Report ?숆린??
     * ?ㅻ뒛 湲곗??쇰줈 怨쇨굅 185?쇨퉴吏??紐⑤뱺 Report瑜?議고쉶?섏뿬 ?숆린??
     * API ?쒗븳: 理쒕? 180?쇨퉴吏留?議고쉶 媛??
     *
     * ?ъ슜 ?덉떆: ??留ㅼ옣 珥덇린 ?명똿 ??
     *
     * @return ??λ맂 Report 媛쒖닔
     */

    @PostMapping("/sync/store/full-historical")
    public ResponseEntity<String> syncSingleStoreFullHistorical(
            @Valid @RequestBody StoreFullHistoricalSyncRequestDTO req
    ) {
        int count = reportService.syncSingleStoreFullHistorical(req.getStoreId());
        return ResponseEntity.ok(count + "媛?Report ????낅뜲?댄듃 ?꾨즺 (怨쇨굅 185??");
    }

    // ========== 2. ?꾩껜 留ㅼ옣 ?숆린??==========

    /**
     * ?꾩껜 留ㅼ옣???뱀젙 湲곌컙 Report ?숆린??
     * 紐⑤뱺 留ㅼ옣??吏?뺣맂 湲곌컙 Report瑜?Pudu API?먯꽌 議고쉶?섏뿬 DB?????
                                                                                                   *
     * ?ъ슜 ?덉떆:
     * - ?댁젣 ?섎（移??곗씠?곕쭔 ?꾩껜 留ㅼ옣 ?щ룞湲고솕
     * - 吏??二??곗씠?곕쭔 ?꾩껜 留ㅼ옣 ?щ룞湲고솕
     * - ?μ븷 蹂듦뎄 ???뱀젙 ?쒓컙? ?곗씠?곕쭔 ?щ룞湲고솕
     *
     * @param req ?쒖옉/醫낅즺 ?쒓컙, ??꾩〈 ?ㅽ봽???ы븿 (storeId ?놁쓬)
     * @return ??λ맂 ?꾩껜 Report 媛쒖닔
     */
    @PostMapping("/sync/all-stores/time-range")
    public ResponseEntity<String> syncAllStoresByTimeRange(
            @Valid @RequestBody TimeRangeSyncRequestDTO req
    ) {
        int count = reportService.syncAllStoresByTimeRange(req);
        return ResponseEntity.ok(count + "媛?Report ????낅뜲?댄듃 ?꾨즺 (紐⑤뱺 留ㅼ옣 - ?뱀젙 湲곌컙)");
    }

    /**
     * ?꾩껜 留ㅼ옣???꾩껜 湲곌컙(185?? Report ?숆린??
     * DB????λ맂 紐⑤뱺 留ㅼ옣???쒗쉶?섎㈃??媛?留ㅼ옣??怨쇨굅 185??Report瑜?議고쉶?섏뿬 ?숆린??
     *
     * ?좑툘 二쇱쓽: 留ㅼ옣??留롮쓣 寃쎌슦 ?ㅻ옒 嫄몃┫ ???덉쓬 (珥덇린 ?명똿 ?먮뒗 ?꾩껜 留덉씠洹몃젅?댁뀡??
     *
     * ?ъ슜 ?덉떆: ?쒖뒪??珥덇린 ?명똿 ???꾩껜 ?곗씠???숆린??
     *
     * @return ??λ맂 ?꾩껜 Report 媛쒖닔
     */
    @PostMapping("/sync/all-stores/full-historical")
    public ResponseEntity<String> syncAllStoresFullHistorical() {
        int count = reportService.syncAllStoresFullHistorical();
        return ResponseEntity.ok(count + "媛?Report ????낅뜲?댄듃 ?꾨즺 (紐⑤뱺 留ㅼ옣 - ?꾩껜 湲곌컙)");
    }


    // ========== 3. Report 議고쉶 ==========

    /**
     * 紐⑤뱺 Report 議고쉶
     * DB????λ맂 紐⑤뱺 Report瑜?議고쉶
     *
     * @return ?꾩껜 Report 紐⑸줉
     */
    @GetMapping("/list/all")
    public ResponseEntity<List<ReportDTO>> getAllReports() {
        return ResponseEntity.ok(reportService.getAllReports());
    }

    /**
     * Report ID濡??뱀젙 Report 議고쉶
     *
     * @param id Report ID
     * @return Report ?뺣낫 DTO
     */
    @GetMapping("/{id}")
    public ResponseEntity<ReportDTO> getReportById(@PathVariable Long id) {
        return ResponseEntity.ok(reportService.getReportById(id));
    }

    /**
     * 濡쒕큸蹂?Report 議고쉶
     * ?뱀젙 濡쒕큸(?쒕━??踰덊샇)??紐⑤뱺 Report瑜?議고쉶
     *
     * @param sn 濡쒕큸 ?쒕━??踰덊샇
     * @return ?대떦 濡쒕큸??Report 紐⑸줉
     */
    @GetMapping("/list/robot/{sn}")
    public ResponseEntity<List<ReportDTO>> getReportsByRobotSn(@PathVariable String sn) {
        return ResponseEntity.ok(reportService.getReportsByRobotSn(sn));
    }
}

`


# C:\tealim-be\src\main\java\com\codehows\taelimbe\report\dto\StoreFullHistoricalSyncRequestDTO.java
`java

package com.codehows.taelimbe.report.dto;

import jakarta.validation.constraints.NotNull;
import jakarta.validation.constraints.Positive;
import lombok.*;

@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class StoreFullHistoricalSyncRequestDTO {

    @NotNull(message = "storeId???꾩닔?낅땲??)
    @Positive(message = "storeId???묒닔?ъ빞 ?⑸땲??)
    private Long storeId;
}

`


# C:\tealim-be\src\main\java\com\codehows\taelimbe\report\service\ReportService.java
`java

package com.codehows.taelimbe.report.service;

import com.codehows.taelimbe.client.PuduAPIClient;
import com.codehows.taelimbe.report.dto.*;
import com.codehows.taelimbe.report.entity.Report;
import com.codehows.taelimbe.robot.entity.Robot;
import com.codehows.taelimbe.store.entity.Store;
import com.codehows.taelimbe.report.repository.ReportRepository;
import com.codehows.taelimbe.robot.repository.RobotRepository;
import com.codehows.taelimbe.store.repository.StoreRepository;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.util.UriComponentsBuilder;

import java.time.*;
import java.util.*;

@Service
@RequiredArgsConstructor
public class ReportService {

    private final PuduAPIClient puduAPIClient;
    private final ReportRepository reportRepository;
    private final RobotRepository robotRepository;
    private final StoreRepository storeRepository;
    private final ObjectMapper mapper = new ObjectMapper();

    // ========== 1. ?⑥씪 留ㅼ옣 ?숆린??==========

    /**
     * ?뱀젙 留ㅼ옣???뱀젙 湲곌컙 Report ?숆린??
     * 吏?뺣맂 湲곌컙??Report瑜??섏씠吏뺥븯??議고쉶 諛????
     * ??踰덉뿉 20媛쒖뵫 議고쉶?섎ŉ, ?곗씠?곌? ?놁쓣 ?뚭퉴吏 ?먮룞?쇰줈 ?섏씠吏?吏꾪뻾
     *
     * ?ъ슜 ?덉떆: ?뱀젙 留ㅼ옣???댁젣 ?곗씠?곕쭔 ?щ룞湲고솕
     *
     * @param req 留ㅼ옣 ID, ?쒖옉/醫낅즺 ?쒓컙, ??꾩〈 ?ㅽ봽???ы븿
     * @return ??λ맂 Report 媛쒖닔
     */
    @Transactional
    public int syncSingleStoreByTimeRange(StoreTimeRangeSyncRequestDTO req) {
        Store store = storeRepository.findById(req.getStoreId())
                .orElseThrow(() -> new IllegalArgumentException("Store not found"));

        Long shopId = store.getShopId();
        int totalCount = 0;
        int offset = req.getOffset();
        boolean hasMore = true;

        System.out.println("\n===== Sync Single Store by Time Range =====");
        System.out.println("Store ID: " + req.getStoreId());
        System.out.println("Time Range: " + req.getStartTime() + " ~ " + req.getEndTime());

        while (hasMore) {
            List<Map<String, String>> list = fetchReportList(
                    req.getStartTime(),
                    req.getEndTime(),
                    shopId,
                    req.getTimezoneOffset(),
                    offset
            );

            if (list.isEmpty()) {
                hasMore = false;
                break;
            }

            for (Map<String, String> item : list) {
                ReportDTO saved = saveReportDetailWithConversion(
                        item.get("sn"),
                        item.get("report_id"),
                        req.getStartTime(),
                        req.getEndTime(),
                        req.getTimezoneOffset(),
                        shopId
                );
                if (saved != null) totalCount++;
            }

            offset += 20;
        }

        System.out.println("Total Saved: " + totalCount);
        System.out.println("============================================\n");

        return totalCount;
    }

    /**
     * ?뱀젙 留ㅼ옣???꾩껜 湲곌컙(怨쇨굅 185?? Report ?숆린??
     * ?ㅻ뒛 湲곗??쇰줈 怨쇨굅 185?쇨퉴吏??紐⑤뱺 Report瑜?議고쉶?섏뿬 ?숆린??
     * API ?쒗븳: 理쒕? 180?쇨퉴吏留?議고쉶 媛??
     *
     * ?ъ슜 ?덉떆: ??留ㅼ옣 珥덇린 ?명똿 ??
     *
     * @param storeId 留ㅼ옣 ID
     * @return ??λ맂 Report 媛쒖닔
     */
    @Transactional
    public int syncSingleStoreFullHistorical(Long storeId) {

        Store store = storeRepository.findById(storeId)
                .orElseThrow(() -> new IllegalArgumentException("Store not found"));

        Long shopId = store.getShopId();

        long endTime = LocalDate.now().atTime(LocalTime.MAX)
                .atZone(ZoneId.systemDefault())
                .toEpochSecond();

        long startTime = LocalDate.now().minusDays(185)
                .atStartOfDay()
                .atZone(ZoneId.systemDefault())
                .toEpochSecond();

        System.out.println("\n===== Sync Single Store Full Historical (Last 185 Days) =====");
        System.out.println("Store ID: " + storeId);
        System.out.println("Start Date: " + LocalDate.now().minusDays(185));
        System.out.println("End Date: " + LocalDate.now());
        System.out.println("Start Timestamp: " + startTime);
        System.out.println("End Timestamp: " + endTime);

        int totalCount = 0;
        int offset = 0;
        boolean hasMore = true;
        int pageNum = 0;

        while (hasMore) {
            pageNum++;
            System.out.println("\n--- Page " + pageNum + " (offset: " + offset + ") ---");

            List<Map<String, String>> list = fetchReportList(
                    startTime,
                    endTime,
                    shopId,
                    0,
                    offset
            );

            System.out.println("Fetched: " + list.size() + " items");

            if (list.isEmpty()) {
                System.out.println("No more data. Stopping.");
                hasMore = false;
                break;
            }

            int pageCount = 0;
            for (Map<String, String> item : list) {
                ReportDTO saved = saveReportDetailWithConversion(
                        item.get("sn"),
                        item.get("report_id"),
                        startTime,
                        endTime,
                        0,
                        shopId
                );
                if (saved != null) {
                    totalCount++;
                    pageCount++;
                }
            }

            System.out.println("Saved in this page: " + pageCount);
            offset += 20;
        }

        System.out.println("\n===== Sync Complete =====");
        System.out.println("Total Saved: " + totalCount);
        System.out.println("==========================\n");

        return totalCount;
    }

    // ========== 2. ?꾩껜 留ㅼ옣 ?숆린??==========

    /**
     * ?꾩껜 留ㅼ옣???뱀젙 湲곌컙 Report ?숆린??
     * 紐⑤뱺 留ㅼ옣??吏?뺣맂 湲곌컙 Report瑜?Pudu API?먯꽌 議고쉶?섏뿬 DB?????
     *
     * ?ъ슜 ?덉떆:
     * - ?댁젣 ?섎（移??곗씠?곕쭔 ?꾩껜 留ㅼ옣 ?щ룞湲고솕
     * - 吏??二??곗씠?곕쭔 ?꾩껜 留ㅼ옣 ?щ룞湲고솕
     * - ?μ븷 蹂듦뎄 ???뱀젙 ?쒓컙? ?곗씠?곕쭔 ?щ룞湲고솕
     *
     * @param req ?쒖옉/醫낅즺 ?쒓컙, ??꾩〈 ?ㅽ봽???ы븿 (storeId ?놁쓬)
     * @return ??λ맂 ?꾩껜 Report 媛쒖닔
     */
    @Transactional
    public int syncAllStoresByTimeRange(TimeRangeSyncRequestDTO req) {

        List<Store> stores = storeRepository.findAll();

        System.out.println("\n===== Sync All Stores by Time Range =====");
        System.out.println("Total Stores: " + stores.size());
        System.out.println("Start Time: " + req.getStartTime() + " (" +
                toLocal(req.getStartTime(), req.getTimezoneOffset()) + ")");
        System.out.println("End Time: " + req.getEndTime() + " (" +
                toLocal(req.getEndTime(), req.getTimezoneOffset()) + ")");

        int totalCount = 0;

        for (Store store : stores) {
            System.out.println("\n--- Processing Store: " + store.getStoreId() + " ---");

            try {
                StoreTimeRangeSyncRequestDTO syncReq = StoreTimeRangeSyncRequestDTO.builder()
                        .storeId(store.getStoreId())
                        .startTime(req.getStartTime())
                        .endTime(req.getEndTime())
                        .timezoneOffset(req.getTimezoneOffset())
                        .offset(0)
                        .build();

                int count = syncSingleStoreByTimeRange(syncReq);
                totalCount += count;

                System.out.println("Store " + store.getStoreId() + " Synced: " + count + " reports");

            } catch (Exception e) {
                System.out.println("Error syncing store " + store.getStoreId() + ": " + e.getMessage());
                e.printStackTrace();
            }
        }

        System.out.println("\n===== All Stores Time Range Sync Complete =====");
        System.out.println("Total Synced: " + totalCount);
        System.out.println("===============================================\n");

        return totalCount;
    }

    /**
     * ?꾩껜 留ㅼ옣???꾩껜 湲곌컙(怨쇨굅 185?? Report ?숆린??
     * DB????λ맂 紐⑤뱺 留ㅼ옣???쒗쉶?섎㈃??媛?留ㅼ옣??怨쇨굅 185??Report瑜?議고쉶?섏뿬 ?숆린??
     *
     * ?좑툘 二쇱쓽: 留ㅼ옣??留롮쓣 寃쎌슦 ?ㅻ옒 嫄몃┫ ???덉쓬 (珥덇린 ?명똿 ?먮뒗 ?꾩껜 留덉씠洹몃젅?댁뀡??
     *
     * ?ъ슜 ?덉떆: ?쒖뒪??珥덇린 ?명똿 ???꾩껜 ?곗씠???숆린??
     *
     * @return ??λ맂 ?꾩껜 Report 媛쒖닔
     */
    @Transactional
    public int syncAllStoresFullHistorical() {

        List<Store> stores = storeRepository.findAll();

        System.out.println("\n===== Sync All Stores Full Historical (Last 185 Days) =====");
        System.out.println("Total Stores: " + stores.size());

        int totalCount = 0;

        for (Store store : stores) {
            System.out.println("\n--- Processing Store: " + store.getStoreId() + " ---");

            try {
                int count = syncSingleStoreFullHistorical(store.getStoreId());
                totalCount += count;
            } catch (Exception e) {
                System.out.println("Error syncing store " + store.getStoreId() + ": " + e.getMessage());
                e.printStackTrace();
            }
        }

        System.out.println("\n===== All Stores Full Historical Sync Complete =====");
        System.out.println("Total Saved: " + totalCount);
        System.out.println("====================================================\n");

        return totalCount;
    }



    // ========== 3. Report 議고쉶 ==========

    /**
     * ?뱀젙 湲곌컙??Report瑜?DB?먯꽌 議고쉶
     * @param startDate ?쒖옉 ?좎쭨 (yyyy-MM-dd ?뺤떇)
     * @param endDate 醫낅즺 ?좎쭨 (yyyy-MM-dd ?뺤떇)
     * @return ?대떦 湲곌컙??Report 紐⑸줉
     */
    public List<ReportDTO> getReport(String startDate, String endDate) {

        if (startDate == null || startDate.isEmpty()) {
            startDate = LocalDate.now().minusWeeks(1).toString();
        }
        if (endDate == null || endDate.isEmpty()) {
            endDate = LocalDate.now().toString();
        }

        LocalDateTime startDateTime = LocalDate.parse(startDate).atStartOfDay();
        LocalDateTime endDateTime = LocalDate.parse(endDate).atTime(LocalTime.MAX);

        return reportRepository.findByStartTimeBetween(startDateTime, endDateTime)
                .stream()
                .map(ReportDTO::createReportDTO)
                .toList();
    }

    /**
     * 紐⑤뱺 ??λ맂 Report 議고쉶
     * @return ?꾩껜 Report 紐⑸줉
     */
    public List<ReportDTO> getAllReports() {
        return reportRepository.findAll().stream().map(this::toDto).toList();
    }

    /**
     * Report ID濡??뱀젙 Report 議고쉶
     *
     * @param id Report ID
     * @return Report ?뺣낫 DTO
     */
    public ReportDTO getReportById(Long id) {
        return toDto(reportRepository.findById(id)
                .orElseThrow(() -> new IllegalArgumentException("Report not found")));
    }

    /**
     * 濡쒕큸 ?쒕━??踰덊샇濡??대떦 濡쒕큸??紐⑤뱺 Report 議고쉶
     * @param sn 濡쒕큸 ?쒕━??踰덊샇
     * @return ?대떦 濡쒕큸??Report 紐⑸줉
     */
    public List<ReportDTO> getReportsByRobotSn(String sn) {
        return reportRepository.findByRobot_Sn(sn)
                .stream().map(this::toDto).toList();
    }

    // ========== Private Helper Methods ==========

    /**
     * Report ?곸꽭 ?뺣낫瑜?Pudu API?먯꽌 議고쉶?섏뿬 DB?????
     * taskId 以묐났 泥댄겕?섏뿬 以묐났?대㈃ ??ν븯吏 ?딆쓬
     *
     * @param sn 濡쒕큸 ?쒕━??踰덊샇
     * @param reportId Report ID (taskId濡??ъ슜)
     * @param start ?쒖옉 ?쒓컙
     * @param end 醫낅즺 ?쒓컙
     * @param timezoneOffset ??꾩〈 ?ㅽ봽??
     * @param shopId ??ID
     * @return ??λ맂 Report ?뺣낫 DTO
     */
    private ReportDTO saveReportDetailWithConversion(
            String sn, String reportId, long start, long end, int timezoneOffset, Long shopId
    ) {
        JsonNode detail = fetchReportDetail(sn, reportId, start, end, timezoneOffset, shopId);
        if (detail == null) {
            return null;
        }

        Long taskId = Long.parseLong(reportId);
        Optional<Report> existing = reportRepository.findByTaskId(taskId);

        if (existing.isPresent()) {
            System.out.println("Report with taskId " + taskId + " already exists. Skipping.");
            return null;
        }

        Robot robot = robotRepository.findBySn(sn)
                .orElseThrow(() -> new IllegalArgumentException("Robot not found"));

        String mapName = null;
        String mapUrl = null;

        try {
            JsonNode floorListNode = detail.path("floor_list");
            JsonNode floorList = floorListNode.isTextual()
                    ? mapper.readTree(floorListNode.asText())
                    : floorListNode;

            if (floorList.isArray() && floorList.size() > 0) {
                JsonNode first = floorList.get(0);
                mapName = first.path("map_name").asText(null);
                mapUrl = first.path("task_result_url").asText(
                        first.path("task_local_url").asText(null)
                );
            }
        } catch (Exception e) {
            e.printStackTrace();
        }

        Report report = Report.builder()
                .taskId(taskId)
                .status(detail.path("status").asInt())
                .startTime(toLocal(detail.path("start_time").asLong(), timezoneOffset))
                .endTime(toLocal(detail.path("end_time").asLong(), timezoneOffset))
                .cleanTime(detail.path("clean_time").floatValue())
                .taskArea(detail.path("task_area").floatValue())
                .cleanArea(detail.path("clean_area").floatValue())
                .mode(detail.path("mode").asInt())
                .costBattery(detail.path("cost_battery").asLong())
                .costWater(detail.path("cost_water").asLong())
                .mapName(mapName)
                .mapUrl(mapUrl)
                .robot(robot)
                .build();

        return toDto(reportRepository.save(report));
    }

    /**
     * Pudu API?먯꽌 Report 紐⑸줉???섏씠吏뺥븯??議고쉶
     * @param start ?쒖옉 ?쒓컙 (Unix timestamp)
     * @param end 醫낅즺 ?쒓컙 (Unix timestamp)
     * @param shopId ??ID
     * @param timezoneOffset ??꾩〈 ?ㅽ봽??
     * @param offset ?섏씠吏?offset
     * @return 濡쒕큸 SN怨?Report ID 留?由ъ뒪??
     */
    private List<Map<String, String>> fetchReportList(
            long start, long end, Long shopId, int timezoneOffset, int offset
    ) {
        List<Map<String, String>> result = new ArrayList<>();

        try {
            String url = UriComponentsBuilder.fromHttpUrl(puduAPIClient.getBaseUrl())
                    .path("/data-board/v1/log/clean_task/query_list")
                    .queryParam("start_time", start)
                    .queryParam("end_time", end)
                    .queryParam("shop_id", shopId)
                    .queryParam("offset", offset)
                    .queryParam("limit", 20)
                    .queryParam("timezone_offset", timezoneOffset)
                    .toUriString();

            ResponseEntity<String> res = puduAPIClient.callPuduAPI(url, "GET");
            JsonNode list = mapper.readTree(res.getBody()).path("data").path("list");

            if (list.isArray()) {
                for (JsonNode n : list) {
                    Map<String, String> map = new HashMap<>();
                    map.put("sn", n.path("sn").asText());
                    map.put("report_id", n.path("report_id").asText());
                    result.add(map);
                }
            }

        } catch (Exception e) {
            System.out.println("Exception in fetchReportList: " + e.getMessage());
            e.printStackTrace();
        }

        return result;
    }

    /**
     * Pudu API?먯꽌 ?뱀젙 Report???곸꽭 ?뺣낫 議고쉶
     * @param sn 濡쒕큸 ?쒕━??踰덊샇
     * @param reportId Report ID
     * @param start ?쒖옉 ?쒓컙
     * @param end 醫낅즺 ?쒓컙
     * @param timezoneOffset ??꾩〈 ?ㅽ봽??
     * @param shopId ??ID
     * @return Report ?곸꽭 ?뺣낫 JSON ?몃뱶
     */
    private JsonNode fetchReportDetail(
            String sn, String reportId, long start, long end, int timezoneOffset, Long shopId
    ) {
        try {
            String url = UriComponentsBuilder.fromHttpUrl(puduAPIClient.getBaseUrl())
                    .path("/data-board/v1/log/clean_task/query")
                    .queryParam("sn", sn)
                    .queryParam("report_id", reportId)
                    .queryParam("start_time", start)
                    .queryParam("end_time", end)
                    .queryParam("timezone_offset", timezoneOffset)
                    .queryParam("shop_id", shopId)
                    .toUriString();

            ResponseEntity<String> res = puduAPIClient.callPuduAPI(url, "GET");

            return mapper.readTree(res.getBody()).path("data");

        } catch (Exception ignored) {}

        return null;
    }

    /**
     * Report ?뷀떚?곕? DTO濡?蹂??
     * @param r Report ?뷀떚??
     * @return 蹂?섎맂 Report DTO
     */
    private ReportDTO toDto(Report r) {
        return ReportDTO.builder()
                .reportId(r.getReportId())
                .taskId(r.getTaskId())
                .status(r.getStatus())
                .startTime(r.getStartTime())
                .endTime(r.getEndTime())
                .cleanTime(r.getCleanTime())
                .taskArea(r.getTaskArea())
                .cleanArea(r.getCleanArea())
                .mode(r.getMode())
                .costBattery(r.getCostBattery())
                .costWater(r.getCostWater())
                .mapName(r.getMapName())
                .mapUrl(r.getMapUrl())
                .robotId(r.getRobot().getRobotId())
                .build();
    }

    /**
     * Unix timestamp瑜?LocalDateTime?쇰줈 蹂??
     */
    private LocalDateTime toLocal(long epoch, int timezoneOffset) {
        long adjusted = epoch + (timezoneOffset * 60L);
        return LocalDateTime.ofInstant(Instant.ofEpochSecond(adjusted), ZoneId.systemDefault());
    }
}

`


# C:\tealim-be\src\main\java\com\codehows\taelimbe\report\repository\ReportRepository.java
`java

package com.codehows.taelimbe.report.repository;

import com.codehows.taelimbe.report.entity.Report;
import org.springframework.data.jpa.repository.JpaRepository;

import java.time.LocalDateTime;
import java.util.List;
import java.util.Optional;

public interface ReportRepository extends JpaRepository<Report, Long> {
    List<Report> findByRobot_Sn(String sn);

    List<Report> findByStartTimeBetween(LocalDateTime start, LocalDateTime end);

    Optional<Report> findByTaskId(Long taskId);
}


`


# C:\tealim-be\src\main\java\com\codehows\taelimbe\report\entity\Report.java
`java

package com.codehows.taelimbe.report.entity;

import com.codehows.taelimbe.robot.entity.Robot;
import jakarta.persistence.*;
import lombok.*;

import java.time.LocalDateTime;

@Entity
@Table(name = "report")
@Getter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Report {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "report_id")
    private Long reportId;

    @Column(name = "task_id")
    private Long taskId;

    @Column(name = "status")
    private Integer status;

    @Column(name = "start_time")
    private LocalDateTime startTime;

    @Column(name = "end_time")
    private LocalDateTime endTime;

    @Column(name = "clean_time")
    private Float cleanTime;

    @Column(name = "task_area")
    private Float taskArea;

    @Column(name = "clean_area")
    private Float cleanArea;

    @Column(name = "mode")
    private Integer mode;

    @Column(name = "cost_battery")
    private Long costBattery;

    @Column(name = "cost_water")
    private Long costWater;

    @Column(name = "map_name", length = 255)
    private String mapName;

    @Column(name = "map_url", length = 255)
    private String mapUrl;

    @ManyToOne
    @JoinColumn(name = "robot_id")
    private Robot robot;

}


`


# C:\tealim-be\src\main\java\com\codehows\taelimbe\report\dto\TimeRangeSyncRequestDTO.java
`java

package com.codehows.taelimbe.report.dto;

import jakarta.validation.constraints.*;
import lombok.*;

/**
 * ?꾩껜 留ㅼ옣???뱀젙 湲곌컙 Report ?숆린???붿껌 DTO
 *
 * ?⑸룄:
 * - 紐⑤뱺 留ㅼ옣???댁젣/吏?쒖＜/?뱀젙 湲곌컙 ?곗씠???쇨큵 ?숆린??
 * - ?μ븷 蹂듦뎄 ???뱀젙 ?쒓컙? ?щ룞湲고솕
 *
 * ?뱀쭠:
 * - storeId ?놁쓬 (?꾩껜 留ㅼ옣 ???
 * - ?쒓컙 踰붿쐞留?吏??
 *
 * ?ъ슜 ?덉떆:
 * POST /api/report/sync/all-stores/time-range
 * {
 *   "startTime": 1733011200,
 *   "endTime": 1733097599,
 *   "timezoneOffset": 0
 * }
 */
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class TimeRangeSyncRequestDTO {

    @NotNull(message = "startTime? ?꾩닔?낅땲??)
    @Positive(message = "startTime? ?묒닔?ъ빞 ?⑸땲??)
    private Long startTime;

    @NotNull(message = "endTime? ?꾩닔?낅땲??)
    @Positive(message = "endTime? ?묒닔?ъ빞 ?⑸땲??)
    private Long endTime;

    @Builder.Default
    private Integer timezoneOffset = 0;

    @AssertTrue(message = "startTime??endTime蹂대떎 ?묒븘???⑸땲??)
    public boolean isValidTimeRange() {
        return startTime < endTime;
    }
}

`


# C:\tealim-be\src\main\java\com\codehows\taelimbe\report\dto\StoreTimeRangeSyncRequestDTO.java
`java

package com.codehows.taelimbe.report.dto;

import jakarta.validation.constraints.*;
import lombok.*;

/**
 * ?뱀젙 留ㅼ옣???뱀젙 湲곌컙 Report ?숆린???붿껌 DTO
 *
 * ?⑸룄:
 * - ?뱀젙 留ㅼ옣???댁젣/吏?쒖＜/?뱀젙 湲곌컙 ?곗씠???숆린??
 *
 * ?ъ슜 ?덉떆:
 * POST /api/report/sync/store/time-range
 * {
 *   "storeId": 1,
 *   "startTime": 1733011200,
 *   "endTime": 1733097599,
 *   "timezoneOffset": 0
 * }
 */
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class StoreTimeRangeSyncRequestDTO {

    @NotNull(message = "storeId???꾩닔?낅땲??)
    @Positive(message = "storeId???묒닔?ъ빞 ?⑸땲??)
    private Long storeId;

    @NotNull(message = "startTime? ?꾩닔?낅땲??)
    @Positive(message = "startTime? ?묒닔?ъ빞 ?⑸땲??)
    private Long startTime;

    @NotNull(message = "endTime? ?꾩닔?낅땲??)
    @Positive(message = "endTime? ?묒닔?ъ빞 ?⑸땲??)
    private Long endTime;

    @Builder.Default
    private Integer timezoneOffset = 0;

    @Builder.Default
    private Integer offset = 0;  // ?섏씠吏뺤쓣 ?꾪븳 offset (?대???

    @AssertTrue(message = "startTime??endTime蹂대떎 ?묒븘???⑸땲??)
    public boolean isValidTimeRange() {
        return startTime < endTime;
    }
}

`


# C:\tealim-be\src\main\java\com\codehows\taelimbe\report\dto\ReportDetailRequestDTO.java
`java

package com.codehows.taelimbe.report.dto;

import jakarta.validation.constraints.*;
import lombok.*;

/**
 * Report ?곸꽭 ?뺣낫 ????붿껌 DTO
 *
 * ?⑸룄:
 * - ?뱀젙 Report???곸꽭 ?뺣낫瑜?Pudu API?먯꽌 議고쉶?섏뿬 DB?????
 *
 * ?ъ슜 ?덉떆:
 * POST /api/report/detail/save
 * {
 *   "storeId": 1,
 *   "sn": "PUDU123456",
 *   "reportId": "987654321",
 *   "startTime": 1733011200,
 *   "endTime": 1733097599,
 *   "timezoneOffset": 0
 * }
 */
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ReportDetailRequestDTO {

    @NotNull(message = "storeId???꾩닔?낅땲??)
    @Positive(message = "storeId???묒닔?ъ빞 ?⑸땲??)
    private Long storeId;

    @NotBlank(message = "sn? ?꾩닔?낅땲??)
    private String sn;

    @NotBlank(message = "reportId???꾩닔?낅땲??)
    private String reportId;

    @NotNull(message = "startTime? ?꾩닔?낅땲??)
    @Positive(message = "startTime? ?묒닔?ъ빞 ?⑸땲??)
    private Long startTime;

    @NotNull(message = "endTime? ?꾩닔?낅땲??)
    @Positive(message = "endTime? ?묒닔?ъ빞 ?⑸땲??)
    private Long endTime;

    @Builder.Default
    private Integer timezoneOffset = 0;

    @AssertTrue(message = "startTime??endTime蹂대떎 ?묒븘???⑸땲??)
    public boolean isValidTimeRange() {
        return startTime < endTime;
    }
}

`


# C:\tealim-be\src\main\java\com\codehows\taelimbe\report\dto\ReportDTO.java
`java

package com.codehows.taelimbe.report.dto;

import com.codehows.taelimbe.report.entity.Report;
import com.fasterxml.jackson.annotation.JsonFormat;
import lombok.*;
import java.time.LocalDateTime;

/**
 * Report ?묐떟 DTO
 *
 * ?⑸룄:
 * - Report 議고쉶 API???묐떟 ?곗씠??
 * - Report Entity瑜??대씪?댁뼵?몃줈 ?꾨떖?????ъ슜
 *
 * 二쇱슂 ?꾨뱶:
 * - reportId: Report 怨좎쑀 ID
 * - status: Report ?곹깭
 * - startTime/endTime: 泥?냼 ?쒖옉/醫낅즺 ?쒓컙
 * - cleanTime: 泥?냼 ?뚯슂 ?쒓컙
 * - taskArea/cleanArea: ?묒뾽 硫댁쟻/泥?냼 硫댁쟻
 * - mode: 泥?냼 紐⑤뱶
 * - costBattery/costWater: 諛고꽣由?臾??뚮퉬??
 * - mapName/mapUrl: 留??대쫫/URL
 * - robotId: 濡쒕큸 ID
 */
@Getter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ReportDTO {

    private Long reportId;
    private Long taskId;
    private Integer status;

    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    private LocalDateTime startTime;

    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    private LocalDateTime endTime;

    private Float cleanTime;
    private Float taskArea;
    private Float cleanArea;

    private Integer mode;
    private Long costBattery;
    private Long costWater;

    private String mapName;
    private String mapUrl;

    private Long robotId;

    /**
     * Report Entity瑜?DTO濡?蹂?섑븯???뺤쟻 ?⑺넗由?硫붿꽌??
     * @param report Report ?뷀떚??
     * @return 蹂?섎맂 ReportDTO
     */
    public static ReportDTO createReportDTO(Report report) {
        return ReportDTO.builder()
                .reportId(report.getReportId())
                .taskId(report.getTaskId())
                .status(report.getStatus())
                .startTime(report.getStartTime())
                .endTime(report.getEndTime())
                .cleanTime(report.getCleanTime())
                .taskArea(report.getTaskArea())
                .cleanArea(report.getCleanArea())
                .mode(report.getMode())
                .costBattery(report.getCostBattery())
                .costWater(report.getCostWater())
                .mapName(report.getMapName())
                .mapUrl(report.getMapUrl())
                .robotId(report.getRobot().getRobotId())
                .build();
    }
}

`

